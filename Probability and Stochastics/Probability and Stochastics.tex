\documentclass[fontset=none]{Notes}

\makeatletter
\DeclareRobustCommand{\em}{%
  \@nomath\em \if b\expandafter\@car\f@series\@nil
  \normalfont \else \bfseries \fi}
\makeatother

\usepackage{tikz-cd,wrapstuff}
\usepackage{fixdif,siunitx,tikz,nicematrix}
\usetikzlibrary{matrix,calc}

\input{font.def}

\usepackage[subscriptcorrection,nofontinfo,mtpbb,mtpfrak]{mtpro2}

\tikzcdset{
  arrow style=tikz,
  diagrams={>={Straight Barb[scale=0.8]}}
}

\allowdisplaybreaks[1]

\newlength{\mymathln}
\newcommand{\aligninside}[2]{
  \settowidth{\mymathln}{#2}
  \mathmakebox[\mymathln]{#1}
}

\DeclareMathOperator\Spec{Spec}
\DeclareMathOperator\im{im}
\DeclareMathOperator\nil{nil}
\DeclareMathOperator\rad{rad}
\DeclareMathOperator\Ann{Ann}
\DeclareMathOperator\Max{Max}
\DeclareMathOperator\GL{GL}
\DeclareMathOperator\End{End}
\DeclareMathOperator\Int{Int}
\DeclareMathOperator\Tor{Tor}
\DeclareMathOperator\Frac{Frac}
\DeclareMathOperator\Tr{Tr}
\DeclareMathOperator\Hom{Hom}
\DeclareMathOperator\Leb{Leb}
\DeclareMathOperator\supp{supp}
\DeclareMathOperator\Id{Id}
\DeclareMathOperator\rk{rank}
\DeclareMathOperator\var{var}
\DeclareMathOperator\cov{cov}
\DeclareMathOperator\card{card}
\DeclareMathOperator\coker{coker}
\DeclareMathOperator\vol{vol}
\undef\Re
\undef\Im 
\DeclareMathOperator\Re{Re}
\DeclareMathOperator\Im{Im}

\newcommand{\ideal}[1]{\mathfrak{#1}}
\newcommand{\mat}[1]{\mathbold{#1}}
\newcommand{\matup}[1]{\mathbf{#1}}
\newcommand{\uline}{\underline{\hphantom{X}}}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\ulim}[1][]{\lim_{#1}\mathrel{\uparrow}}
\newcommand{\dlim}[1][]{\lim_{#1}\mathrel{\downarrow}}
\newcommand{\indicator}[1]{\mathbold 1_{#1}}
\newcommand{\alev}[1]{\text{$#1$ a.e.}}
\newcommand{\alsu}[1]{\text{$#1$ a.s.}}
\newcommand{\norm}[1]{\left\Vert#1\right\Vert}

\newcommand{\idf}{\mathbold 1}

\usepackage{enumitem}

\setlist[enumerate]{nosep}

%\DeclareMathAlphabet\mathcal{OMS}{cmsy}{m}{n}

\newlength\stextwidth
\newcommand\makesamewidth[3][c]{%
  \settowidth{\stextwidth}{#2}%
  \makebox[\stextwidth][#1]{#3}%
}



\begin{document}

\frontmatter

\tableofcontents

\mainmatter


\part{测度论}

\include{chapters/ch1/measurable space}

\include{chapters/ch2/integral}

\include{chapters/ch3/construction of measure}

\include{chapters/ch4/L^p space}

\include{chapters/ch5/product measure}

\part{概率论}

\include{chapters/ch8/probability}

\include{chapters/ch9/independence}

\include{chapters/ch10/convergence}

\include{chapters/ch11/conditioning}

\part{随机过程}

\chapter{鞅论}

鞅是随机过程的一种重要类型。一个(离散时间)鞅指的是一列可积的实值
随机变量 $(X_n)_{n\in \mathbb{Z}_+}$，对于每个 $n$，在已知 $X_0,\dots,X_n$
下 $X_{n+1}$ 的条件期望等于 $X_n$。从直觉上来说，我们可以考虑一个公平游戏中
玩家的财富：在已知时间 $n$ 之前的所有事件的情况下，$n+1$ 时刻的财富平均值
仍然等于 $n$ 时刻的财富。鞅在高等概率论中有十分重要的地位。

\section{定义和例子}

我们考虑概率空间 $(\Omega,\mathcal{A},\mathbb{P})$。根据定义，一个(离散时间)
随机过程指的是一列 $(\Omega,\mathcal{A},\mathbb{P})$ 上的随机变量 $(X_n)_{n\in \mathbb{Z}_+}$，
并且 $X_n$ 的取值也在同一个可测空间中。在本章，随机过程将在 $\mathbb{R}$ 中取值。

\begin{definition}
  $(\Omega,\mathcal{A},\mathbb{P})$ 上的一个滤子指的是一个递增的 $\mathcal{A}$
  的子 $\sigma$-域序列 $(\mathcal{F}_n)_{n\in \mathbb{Z}_+}$，也即
  \[
    \mathcal{F}_0\subseteq \mathcal{F}_1\subseteq \mathcal{F}_2\subseteq \cdots \subseteq \mathcal{A}.
  \]
  我们也说 $(\Omega,\mathcal{A},(\mathcal{F}_n)_{n\in \mathbb{Z}_+},\mathbb{P})$ 是
  一个过滤概率空间。
\end{definition}

参数 $n\in \mathbb{Z}_+$ 通常理解为时间。$\sigma$-域 $\mathcal{F}_n$
收集了时间 $n$ 时的信息(一个 $\mathcal{F}_n$-可测的时间理解为依赖于时间 $n$
发生的事件)。我们有记号
\[
  \mathcal{F}_\infty=\bigvee_{n\in \mathbb{Z}_+}\mathcal{F}_n=\sigma\biggl(
    \bigcup_{n\in \mathbb{Z}_+}\mathcal{F}_n
  \biggr).
\]  

\begin{example}\label{exa:filtration}
  \mbox{}
  \begin{enumerate}
    \item 如果 $(X_n)_{n\in \mathbb{Z}_+}$ 是随机过程，那么对于每个 $n$，定义
    $\mathcal{F}_n^X$ 是使得 $X_0,\dots,X_n$ 都可测的最小 $\sigma$-域：
    \[
      \mathcal{F}_n^X=\sigma(X_0,X_1,\dots,X_n).
    \]
    那么 $(\mathcal{F}_n^X)_{n\in \mathbb{Z}_+}$ 是一个滤子，称为
    $(X_n)_{n\in \mathbb{Z}_+}$ 的典范滤子。
    \item 假设 $\Omega=[0,1)$，$\mathcal{A}$ 是 Borel $\sigma$-域，$\mathbb{P}$ 是 Lebesgue 测度。
    对于每个 $n$，定义
    \[
      \mathcal{F}_n=\sigma\biggl(
        \biggl[\frac{i-1}{2^n},\frac{i}{2^n}\biggr):k=1,2,\dots,2^n
      \biggr).
    \]
    那么 $(\mathcal{F}_n)_{n\in \mathbb{Z}_+}$ 是一个滤子，被称为
    $[0,1)$ 上的 dyadic 滤子。
  \end{enumerate}
\end{example}

\begin{definition}
  一个随机过程 $(X_n)_{n\in \mathbb{Z}_+}$ 如果每个 $X_n$ 是 $\mathcal{F}_n$-可测的，
  那么我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是适应于滤子 $(\mathcal{F}_n)_{n\in \mathbb{Z}_+}$ 的。
\end{definition}

根据定义，$(X_n)_{n\in \mathbb{Z}_+}$ 的典范滤子是使得
$(X_n)_{n\in \mathbb{Z}_+}$ 适应的最小滤子。

在本章的剩余部分，我们固定一个过滤概率空间
$(\Omega,\mathcal{A},(\mathcal{F}_n)_{n\in \mathbb{Z}_+},\mathbb{P})$。

\begin{definition}
  令 $(X_n)_{n\in \mathbb{Z}_+}$ 是适应的(实值)随机过程，并且 $\mathbb{E}[|X_n|]<\infty$。
  \begin{enumerate}
    \item 如果对于每个 $n\geq 0$，都有
    \[
      \mathbb{E}[X_{n+1}|\mathcal{F}_n]=X_n,
    \]
    那么我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个鞅。
    \item 如果对于每个 $n\geq 0$，都有
    \[
      \mathbb{E}[X_{n+1}|\mathcal{F}_n]\leq X_n,
    \]
    那么我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个上鞅。
    \item 如果对于每个 $n\geq 0$，都有
    \[
      \mathbb{E}[X_{n+1}|\mathcal{F}_n]\geq X_n,
    \]
    那么我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个下鞅。
  \end{enumerate}
\end{definition}

根据定义，鞅的一个很强的性质是：对于任意 $0\leq n\leq m$，都有
\begin{equation}\label{eq:martingale property}
  \mathbb{E}[X_{m}|\mathcal{F}_n]=X_n.
\end{equation}
这只需要对 $m-n$ 进行归纳。$m=n$ 时，因为 $X_n$ 是 $\mathcal{F}_n$-可测的，所以
\eqref{eq:martingale property} 式成立。如果 $m=n+1$，\eqref{eq:martingale property}
式是鞅的定义。如果 $m-n\geq 2$，那么条件期望的嵌套性质表明 
\[
  \mathbb{E}[X_m| \mathcal{F}_n]=\mathbb{E}[\mathbb{E}[X_m|\mathcal{F}_{m-1}]|\mathcal{F}_n]
  =\mathbb{E}[X_{m-1}|\mathcal{F}_n].
\]
注意到 \eqref{eq:martingale property} 式还表明 $\mathbb{E}[X_m]=\mathbb{E}[X_n]$，
因此，对于任意 $n$ 都有 $\mathbb{E}[X_n]=\mathbb{E}[X_0]$。


类似地，如果 $(X_n)_{n\in \mathbb{Z}_+}$ 是上鞅(下鞅)，那么对于任意 $0\leq n\leq m$，都有
\[
  \mathbb{E}[X_{m}|\mathcal{F}_n]\leq X_n\quad
  \bigl(\mathbb{E}[X_{m}|\mathcal{F}_n]\geq X_n\bigr).
\]
并且还有 $\mathbb{E}[X_m]\leq \mathbb{E}[X_n]$
$\bigl(\mathbb{E}[X_m]\geq \mathbb{E}[X_n]\bigr)$。
也就是说，对于上鞅，期望序列 $(\mathbb{E}[X_n])_{n\in \mathbb{Z}_+}$ 是单调递减的，
而对于下鞅，期望序列是单调递增的。

\begin{example}
  \mbox{}
  \begin{enumerate}
    \item 令 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$。对于每个 $n\geq 0$，令
    \[
      X_n=\mathbb{E}[X| \mathcal{F}_n].
    \]
    那么 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个鞅，被称为闭鞅。这是因为 
    \[
      \mathbb{E}[X_{n+1}| \mathcal{F}_n]=
      \mathbb{E}[\mathbb{E}[X|\mathcal{F}_{n+1}]| \mathcal{F}_n]=
      \mathbb{E}[X| \mathcal{F}_n]=X_n.
    \]
    \item 令 $(X_n)_{n\in \mathbb{Z}_+}$ 是一列递减的可积随机变量，
    并且假设 $(X_n)_{n\in \mathbb{Z}_+}$ 是适应的。那么 
    $(X_n)_{n\in \mathbb{Z}_+}$ 是一个上鞅。这是因为
    \[
      \mathbb{E}[X_{n+1}|\mathcal{F}_n]\leq \mathbb{E}[X_n|\mathcal{F}_n]=X_n.
    \]
    \item \textbf{$\mathbb{R}$ 上的随机游走}。令 $x\in \mathbb{R}$，
    $(Y_n)_{n\in \mathbb{N}}$ 是一列独立同分布的实值随机变量，有分布 $\mu$
    且 $\mathbb{E}[|Y_1|]<\infty$。令
    \[
      X_0=x,\quad X_n=X_0+\sum_{k=1}^n Y_k,\quad n\geq 1.
    \]
    同时定义滤子 $(\mathcal{F}_n)_{n\in \mathbb{Z}_+}$ 为 
    \[
      \mathcal{F}_0=\{\emptyset,\Omega\},\quad 
      \mathcal{F}_n=\sigma(Y_1,Y_2,\dots,Y_n),\quad n\geq 1.
    \]
    也即 $\mathcal{F}_n$ 是 $(X_n)_{n\in \mathbb{Z}_+}$ 的典范滤子。
    \begin{itemize}
      \item 如果 $\mathbb{E}[Y_1]=0$，那么 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个鞅。
      \item 如果 $\mathbb{E}[Y_1]\leq 0$，那么 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个上鞅。
      \item 如果 $\mathbb{E}[Y_1]\geq 0$，那么 $(X_n)_{n\in \mathbb{Z}_+}$ 是一个下鞅。
    \end{itemize}
    考虑 $\mathbb{E}[Y_1]=0$ 的情况，我们有
    \[
      \mathbb{E}[X_{n+1}|\mathcal{F}_n]=
      \mathbb{E}[X_n+Y_{n+1}| \mathcal{F}_n]=
      X_n+\mathbb{E}[Y_{n+1}]=X_n,
    \]
    第二个等号是因为 $X_n$ 是 $\mathcal{F}_n$-可测的，并且 $Y_{n+1}$
    与 $\mathcal{F}_n$ 独立。
    我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是以 $x$ 为起点的移动概率 $\mu$
    的随机游走。一个特别的情况是 $\mu(1)=\mu(-1)=1/2$ 并且 $x\in \mathbb{Z}$，
    此时我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是在 $\mathbb{Z}$ 上以 $x$ 为起点的简单随机游走。
    \item 考虑 \autoref{exa:filtration} 中的 (2)。令 $\mu$ 是 $[0,1)$ 上的
    有限测度。对于每个 $n\geq 0$，定义
    \[
      f_n=\frac{\d \mu}{\d \lambda}\bigg|_{\mathcal{F}_n},
    \]
    注意，这里的 $\mu$ 和 $\lambda$ 都视为限制在 $\mathcal{F}_n$ 上的测度，
    此时 $\mathcal{F}_n$ 上的任意测度相对于 $\lambda$ 都是绝对连续的，
    所以有 Radon-Nikodym 导数 $f_n$。容易验证
    \[
      f_n(\omega)=\sum_{i=1}^{2^n}\frac{\mu([(i-1)2^{-n},i2^{-n}))}{2^{-n}}
      \idf_{[(i-1)2^{-n},i2^{-n})}(\omega),\quad \forall \omega\in [0,1).
    \]
    那么，$(f_n)_{n\in \mathbb{Z}_+}$ 是一个鞅。实际上，如果 $A\in \mathcal{F}_n$，
    我们有
    \[
      \mathbb{E}[\idf_A f_{n+1}]=\int \idf_A(\omega)f_{n+1}(\omega)\d\omega
      =\mu(A)=\int \idf_A(\omega)f_n(\omega)\d\omega =\mathbb{E}[\idf_A f_n],
    \]
    这就表明 $f_n=\mathbb{E}[f_{n+1}|\mathcal{F}_n]$。
  \end{enumerate}
\end{example}

\begin{definition}
  一个实值随机变量序列 $(H_n)_{n\in \mathbb{N}}$ 被称为是可预测的，
  如果每个 $H_n$ 都是有界且 $\mathcal{F}_{n-1}$-可测的。
\end{definition}

\begin{proposition}\label{prop:martingale transform}
  令 $(X_n)_{n\in \mathbb{Z}_+}$ 是适应过程，$(H_n)_{n\in \mathbb{N}}$ 是
  可预测过程。令 $(H \bullet X)_0=0$，对于 $n\geq 1$，令
  \[
    (H \bullet X)_n=\sum_{k=1}^n H_k (X_k - X_{k-1}).
  \]
  那么 
  \begin{enumerate}
    \item 如果 $(X_n)_{n\in \mathbb{Z}_+}$ 是鞅，那么 $(H \bullet X)_{n\in \mathbb{Z}_+}$ 也是鞅；
    \item 如果 $(X_n)_{n\in \mathbb{Z}_+}$ 是上鞅(或者下鞅)，并且对于每个 $n\in \mathbb{N}$
    有 $H_n\geq 0$，那么 $(H \bullet X)_{n\in \mathbb{Z}_+}$ 也是上鞅(或者下鞅)。
  \end{enumerate}
\end{proposition}
\begin{proof}
  我们只证明 (1)。由于 $H_n$ 有界，所以 $(H \bullet X)_n$ 是可积的。
  接下来对 $n$ 归纳。当 $n=0$ 时，有
  \[ 
    \mathbb{E}[(H\bullet X)_1|\mathcal{F}_0]=\mathbb{E}[H_1(X_1-X_0)|\mathcal{F}_0]
    =H_1 \mathbb{E}[X_1-X_0|\mathcal{F}_0]=0,
  \]
  第二个等号是因为 $H_1$ 是 $\mathcal{F}_0$-可测的。考虑 $n+1$
  的情况，那么有
  \begin{align*}
        \mathbb{E}[(H\bullet X)_{n+1}| \mathcal{F}_n]&=
    \mathbb{E}[(H\bullet X)_n|\mathcal{F}_{n}]+\mathbb{E}[H_{n+1}(X_{n+1}-X_n)|\mathcal{F}_n]\\
    &=(H\bullet X)_n+H_{n+1}\mathbb{E}[X_{n+1}-X_n|\mathcal{F}_n]\\
    &=(H\bullet X)_n,
  \end{align*}
  这就表明 $(H\bullet X)_{n\in \mathbb{Z}_+}$ 是鞅。
\end{proof}

回顾我们把一个鞅 $X_n$ 视为公平游戏中玩家的财富的例子。此时差 $X_{n+1}-X_n$
是玩家在 $n$ 和 $n+1$ 时刻之间的收益。我们可以想象，在 $n$ 时刻，玩家
决定使用倍数 $H_{n+1}$ 来下注。由于玩家只能基于 $n$ 时刻之前的信息来决定下注倍数，
所以 $H_{n+1}$ 必须是 $\mathcal{F}_n$-可测的。那么新的收益 $H_{n+1}(X_{n+1}-X_n)$
仍然是一个公平游戏的收益。这给出了 $H\bullet X$ 的一个直观解释。


\section{停时}

\begin{definition}
  一个随机变量 $T:\Omega\to \overline{\mathbb{Z}}_+=\mathbb{Z}_+\cup \{+\infty\}$
  被称为停时，如果对于每个 $n\in \mathbb{Z}_+$，都有
  \[
    \{T=n\}\in \mathcal{F}_n.
  \]
  或者等价的说，对于每个 $n\in \mathbb{Z}_+$，都有 $\{T\leq n\}\in \mathcal{F}_n$。
\end{definition}

若对于每个 $n$ 有 $\{T=n\}\in \mathcal{F}_n$，那么
\[
  \{T\leq n\}=\bigcup_{k=0}^n\{T=k\}\in \mathcal{F}_n.
\]
反之，如果对于每个 $n$ 有 $\{T\leq n\}\in \mathcal{F}_n$，那么
\[
  \{T=n\}=\{T\leq n\}\setminus \{T\leq n-1\}\in \mathcal{F}_n.
\] 
所以这两个定义是等价的。

需要注意的是我们允许 $T=+\infty$。由于
\[
  \{T=+\infty\}=\Omega\setminus \bigcup_{n\geq 0} \{T=n\},
\]
所以 $\{T=+\infty\}\in \mathcal{F}_\infty$。

回到公平游戏的例子上，停时可以理解为玩家决定离开游戏的时间点，这是一个
取决于玩家财富的随机变量。注意到玩家如果在 $n$ 时刻离开游戏，那么
他只能拥有在 $n$ 时刻之前的信息，所以我们要求 $\{T=n\}\in \mathcal{F}_n$。
类似地，在股票市场中，一个人也只能基于当前时间点之前的信息决定是否卖出股票。

\begin{example}
  \mbox{}
  \begin{enumerate}
    \item 令 $k\in \overline{ \mathbb{Z}}_+$，那么常数时间 $T=k$
    显然是一个停时。
    \item 令 $(Y_n)_{n\in \mathbb{Z}_+}$ 是一个适应过程，$A\in \mathcal{B}(\mathbb{R})$，
    令
    \[
      T_A=\inf \{n\in \mathbb{Z}_+\,|\, Y_n\in A\},
    \]
    约定 $\inf \emptyset=+\infty$。那么 $T_A$ 是一个停时。这是因为，对于每个
    $n\in \mathbb{Z}_+$，有
    \[
      \{T_A=n\}=\{Y_0\notin A,Y_1\notin A,\dots,Y_{n-1}\notin A,Y_n\in A\}
      \in \mathcal{F}_n.
    \]
    我们说 $T_A$ 是 $A$ 的首次到达时间。
    \item 在上一个例子的假设下。固定 $N\in \mathbb{N}$，令 
    \[
      L_A=\sup\{n\leq N\,|\, Y_n\in A\}.
    \]
    那么 $L_A$ 通常不是停时。这是因为对于每个 $n\in\{1,\dots,N-1\}$，事件
    \[
      \{L_A=n\}=\{Y_n\in A,Y_{n+1}\notin A,\dots, Y_N\notin A\},
    \]
    这涉及到了 $Y_{n+1},\dots,Y_N$，它们不一定是 $\mathcal{F}_n$-可测的。
  \end{enumerate}
\end{example}

\begin{definition}
  令 $T$ 是停时。定义到 $T$ 截止的 $\sigma$-域为
  \[
    \mathcal{F}_T=\{A\in \mathcal{F}_\infty\,|\, \forall n\in \mathbb{Z}_+, A\cap \{T=n\}\in \mathcal{F}_n \},
  \]
  或者等价的说
  \[
    \mathcal{F}_T=\{A\in \mathcal{F}_\infty\,|\, \forall n\in \mathbb{Z}_+, A\cap \{T\leq n\}\in \mathcal{F}_n \}.
  \]
\end{definition}

这两个定义的等价性也是显然的，并且可以验证 $\mathcal{F}_T$ 确实是一个 $\sigma$-域。
如果 $T=n$ 是常数时间，那么 $\mathcal{F}_T=\mathcal{F}_n$。
还可以注意到停时 $T$ 是 $\mathcal{F}_T$-可测的：对于每个 $k\in \mathbb{Z}_+$，
如果 $n\neq k$ 那么 $\{T=k\}\cap \{T=n\}=\emptyset$，
如果 $n=k$ 那么 $\{T=k\}\cap \{T=n\}=\{T=k\}\in \mathcal{F}_n$。
所以对于每个 $k\in \mathbb{Z}_+$，都有 $\{T=k\}\in \mathcal{F}_T$。

\begin{proposition}
  令 $S$ 和 $T$ 是两个停时并且 $S\leq T$。那么 $\mathcal{F}_S\subseteq \mathcal{F}_T$。
\end{proposition}
\begin{proof}
  令 $A\in \mathcal{F}_S$，那么对于每个 $n\in \mathbb{Z}_+$，
  有 $\{T=n\}\subseteq \{S\leq n\}$，所以
  \[
    A\cap \{T=n\}= \bigcup_{k=0}^n (A\cap \{S=k\})\cap \{T=n\}\in \mathcal{F}_n.\qedhere
  \]
\end{proof}

\begin{proposition}
  令 $S$ 和 $T$ 是两个停时。那么 $S\wedge T$ 和 $S\vee T$ 也是停时。此外，有
  $\mathcal{F}_{S\wedge T}=\mathcal{F}_S\cap \mathcal{F}_T$。
\end{proposition}
\begin{proof}
  注意到 $\{S\wedge T\leq n\}=\{S\leq n\}\cup \{T\leq n\}$
  以及 $\{S\vee T\leq n\}=\{S\leq n\}\cap \{T\leq n\}$，
  所以 $S\wedge T$ 和 $S\vee T$ 都是停时。
  由于 $S\wedge T\leq S$，所以 $\mathcal{F}_{S\wedge T}\subseteq \mathcal{F}_S$。
  同理，$\mathcal{F}_{S\wedge T}\subseteq \mathcal{F}_T$，所以
  $\mathcal{F}_{S\wedge T}\subseteq \mathcal{F}_S\cap \mathcal{F}_T$。
  反之，令 $A\in \mathcal{F}_S\cap \mathcal{F}_T$。那么对于每个 $n\in \mathbb{Z}_+$，有
  $A\cap \{S\leq n\}\in \mathcal{F}_n$ 且 $A\cap \{T\leq n\}\in \mathcal{F}_n$，所以
  \[
    A\cap \{S\wedge T\leq n\}=A\cap (\{S\leq n\}\cup \{T\leq n\})\in \mathcal{F}_n.\qedhere
  \]
\end{proof}

下面的命题表明一个随机过程在停时 $T$ 时的取值是 $\mathcal{F}_T$-可测的随机变量。
一个技术性的细节是只有 $T<\infty$ 时才有意义。出于这个原因，对于一个
定义在 $\Omega$ 的某个可测子集 $A$ 上的实值函数 $Z$：如果 $\mathcal{G}$
是满足 $A\in \mathcal{G}$ 的 $\mathcal{A}$ 的一个子 $\sigma$-域，
那么我们说 $Z$ 是 $\mathcal{G}$-可测的当且仅当对于每个 $B\in \mathcal{B}(\mathbb{R})$
有 $Z^{-1}(B)\in \mathcal{G}$。

\begin{proposition}
  令 $(Y_n)_{n\in \mathbb{Z}_+}$ 是一个适应过程，$T$ 是停时。
  定义 $\{T<\infty\}$ 上的随机变量 $Y_T$ 为 $Y_T(\omega)=Y_{T(\omega)}(\omega)$，
  那么 $Y_T$ 是 $\mathcal{F}_T$-可测的。
\end{proposition}
\begin{proof}
  令 $B\in \mathcal{B}(\mathbb{R})$，那么对于每个 $n\in \mathbb{Z}_+$，有
  \[
    \{Y_T\in B\}\cap \{T=n\}=\{Y_n\in B\}\cap \{T=n\} \in \mathcal{F}_n,
  \]
  所以 $\{Y_T\in B\}\in \mathcal{F}_T$。
\end{proof}

如果 $T$ 是停时，那么对于每个 $n\in \mathbb{Z}_+$，$n\wedge T$ 也是停时，
所以 $Y_{n\wedge T}$ 是 $\mathcal{F}_{n\wedge T}$-可测的，由于
$\mathcal{F}_{n\wedge T}\subseteq \mathcal{F}_n$，所以 $Y_{n\wedge T}$
也是 $\mathcal{F}_n$-可测的。

\begin{theorem}[可选停时定理 1]
  假设 $(X_n)_{n\in \mathbb{Z}_+}$ 是鞅(或者上鞅)，$T$ 是停时。
  那么 $(X_{n\wedge T})_{n\in \mathbb{Z}_+}$ 也是鞅(或者上鞅)。
  特别的，如果停时 $T$ 有界，那么 $X_T\in L^1$，并且
  \[
    \mathbb{E}[X_T]=\mathbb{E}[X_0]\quad
    \bigl(\text{或者 } \mathbb{E}[X_T]\leq \mathbb{E}[X_0]\bigr).
  \]
\end{theorem}
\begin{proof}
  对于每个 $n\geq 1$，令
  \[
    H_n= \idf_{\{T\geq n\}}=1- \idf_{\{T\leq n-1\}}.
  \]
  因为 $\{T\leq n-1\}\in \mathcal{F}_{n-1}$，所以 $H_n$ 是 $\mathcal{F}_{n-1}$-可测的，
  即 $H_n$ 是可预测的。注意到
  \[
    X_{n\wedge T}=X_0+\sum_{i=1}^{n\wedge T}(X_i - X_{i-1})
    =X_0+\sum_{i=1}^n \idf_{\{T\geq i\}} (X_i - X_{i-1})=X_0+(H\bullet X)_n,
  \]
  根据 \autoref{prop:martingale transform}，$(X_{n\wedge T})_{n\in \mathbb{Z}_+}$
  也是鞅。
  
  如果 $T$ 有界，设 $T\leq N$，那么 $X_T=X_{N\wedge T}\in L^1$ 
  以及 $\mathbb{E}[X_T]=\mathbb{E}[X_{N\wedge T}]=\mathbb{E}[X_0]$。
\end{proof}

上述定理中最后对于 $T$ 有界的要求是必须的。考虑从 $0$ 开始的简单随机游走
$(X_n)_{n\in \mathbb{Z}_+}$，那么 $X_n=Y_1+\cdots+Y_n$，
其中 $Y_1,Y_2,\dots$ 是独立同分布 $\mathbb{P}(Y_1=1)=\mathbb{P}(Y_1=-1)=\frac{1}{2}$
的随机变量。因为 $\mathbb{E}[Y_1]=0$，所以 $(X_n)_{n\in \mathbb{Z}_+}$ 是鞅。
定义
\[
  T=\inf\{n\geq 0\,|\, X_n=1\}
\]
是停时，根据 ?? 表明 $T<\infty \,\alsu{}$。但是，
\[
  1=\mathbb{E}[X_T]\neq \mathbb{E}[X_0]=0,
\]
这是因为停时 $T$ 并不是有界的。





\chapter{Markov 链}

\section{定义和首要性质}

在本章中，$E$ 表示一个有限或者可数空间，配备 $\sigma$-域
$\mathcal{P}(E)$。$E$ 上的随机矩阵指的是一族实数 
$(Q(x,y))_{(x,y)\in E\times E}$，其满足：
\begin{enumerate}
  \item 对于任意 $x,y\in E$，$0\leq Q(x,y)\leq 1$；
  \item 对于每个 $x\in E$，$\sum_{y\in E}Q(x,y)=1$。
\end{enumerate}

这个概念等价于从 $E$ 到 $E$ 的转移概率。实际上，如果我们令
\[
  \nu(x,A)=\sum_{y\in A}Q(x,y),\quad x\in E,A\subseteq E,  
\]
那么 $\nu$ 就是一个从 $E$ 到 $E$ 的转移概率。反之，给定一个
转移概率 $\nu$，定义 $Q(x,y)=\nu(x,\{y\})$，这就给出了 
$E$ 上的一个随机矩阵。

对于每个 $n\geq 1$，我们定义 $Q_n=Q^n$ 为通常的矩阵乘法：
定义 $Q_1=Q$，然后递归定义
\[
  Q_{n+1}(x,y)=\sum_{z\in E}Q_n(x,z)Q(z,y).  
\]
不难验证 $Q_n$ 仍然是 $E$ 上的一个随机矩阵。我们同时定义
$Q_0(x,y)=\indicator{\{x=y\}}$（类似单位阵）。
那么对于任意 $m,n\geq 0$，我们有 $Q_{m+n}=Q_mQ_n$：
\[
  Q_{m+n}(x,y)=\sum_{z\in E}Q_m(x,z)Q_n(z,y).  
\]

对于每个函数 $f:E\to \mathbb{R}_+$，用 $Qf$ 表示 $E$
上的函数，满足
\[
  Qf(x)=\sum_{y\in E}Q(x,y)f(y),  
\]
取值在 $[0,\infty]$ 中。如果 $\nu$ 是 $E$ 上的测度，我们
同时定义
\[
  \nu Q(y)=\sum_{x\in E}\nu(x)Q(x,y),\quad y\in E.  
\]

\begin{definition}
  令 $Q$ 是 $E$ 上的随机矩阵，$(X_n)_{n\in \mathbb{Z}_+}$
  是定义在 $(\Omega,\mathcal{A},\mathbb{P})$ 上值在 $E$ 中的随机过程。
  如果对于每个 $n\geq 0$，已知 $(X_0,X_1,\dots,X_n)$ 下的
  $X_{n+1}$ 的条件分布是 $Q(X_n,\cdot)$，那么 
  我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$
  是 Markov 链。这等价于说对于每个 $x_0,\dots,x_n,y\in E$
  使得 $\mathbb{P}(X_0=x_0,\dots,X_n=x_n)>0$，都有
  \[
    \mathbb{P}(X_{n+1}=y|X_0=x_0,\dots,X_n=x_n)=Q(x_n,y).  
  \]
\end{definition}

已知 $(X_0,X_1,\dots,X_n)$ 下的 $X_{n+1}$ 的条件分布是 $Q(X_n,\cdot)$ 还意味着
对于每个 $y\in E$，有
\[
  \mathbb{P}(X_{n+1}=y|X_0,\dots,X_n)=Q(X_n,y).
\]
注意这是随机变量的等式。

利用 \autoref{prop:nested sigma field}，对于 $\{0,1,\dots,n-1\}$ 的任意子集
$\{i_1,\dots,i_k\}$，我们有
\begin{align*}
  &\hphantom{={}}\mathbb{P}(X_{n+1}=y|X_{i_1},\dots,X_{i_k},X_n)\\
  &=\mathbb{E}\bigl[\mathbb{P}(X_{n+1}=y|X_{0},X_1,\dots,X_n)\bigm| X_{i_1},\dots,X_{i_k},X_n\bigr]\\
  &=\mathbb{E}[Q(X_{n},y)|X_{i_1},\dots,X_{i_k},X_n]\\
  &=Q(X_n,y)
\end{align*}
特别地，有
\[
  \mathbb{P}(X_{n+1}=y|X_n)=Q(X_n,y).
\]
这等价于，对于每个使得 $\mathbb{P}(X_n=x)>0$ 的 $x\in E$，有
\[
  \mathbb{P}(X_{n+1}=y|X_n=x)=Q(x,y).
\]
这个式子提供了一种直观理解，即如果 Markov 链在 $n$ 时间处于点 $x\in E$ 处，那么
可以根据概率测度 $Q(x,\cdot)$ 衡量其在 $n+1$ 时间到达点的位置。

\begin{remark}
  \mbox{}
  \begin{enumerate}
    \item 对于一般的随机过程 $(X_n)_{n\in \mathbb{Z}_+}$，已知 $(X_0,X_1,\dots,X_n)$
    下 $X_{n+1}$ 的条件分布可以写为 $\nu((X_0,X_1,\dots,X_n),\cdot)$ 的形式，其中
    $\nu$ 表示从 $E^{n+1}$ 到 $E$ 的转移概率，此时条件分布依赖于所有 $X_0,X_1,\dots,X_n$
    而不仅仅是 $X_n$。而 Markov 链的定义要求已知 $(X_0,X_1,\dots,X_n)$
    下 $X_{n+1}$ 的条件分布仅仅依赖于 $X_n$，这被称为\emph{Markov 属性}：
    为了预测 $X_{n+1}$，过去的所有 $(X_0,X_1,\dots,X_n)$ 的知识并不能提供比 $X_n$
    更多的信息。  
    \item 函数 $Q(x,\cdot)$ 给出了在不依赖 $n$ 的情况下，已知 $X_n=x$ 下 $X_{n+1}$
    的条件分布。这就是“转移机制”的\emph{时齐性}。人们还可以考虑非齐次 Markov 链，
    其中时间 $n$ 和 $n + 1$ 之间的转移机制取决于 $n$，但在本课程中我们仅考虑齐次 Markov 链。
  \end{enumerate}
\end{remark}

\begin{proposition}\label{prop:law of X0 to Xn}
  一个值在 $E$ 中的随机过程 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链当且仅当
  对于每个 $n\geq 0$ 和 $x_0,x_1,\dots,x_n\in E$，我们有
  \[
    \mathbb{P}(X_0=x_0,X_1=x_1,\dots,X_n=x_n)=\mathbb{P}(X_0=x_0)
    Q(x_0,x_1)\cdots Q(x_{n-1},x_n).
  \]
\end{proposition}
\begin{proof}
  若 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链，那么依据
  \begin{align*}
    &\mathbb{P}(X_0=x_0,X_1=x_1,\dots,X_n=x_n,X_{n+1}=x_{n+1})\\
    &=\mathbb{P}(X_0=x_0,\dots,X_n=x_n)\mathbb{P}(X_{n+1}=x_{n+1}|X_0=x_0,\dots,X_n=x_n)
  \end{align*}
  进行归纳即可。

  反之，假设上式成立，那么
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y|X_0=x_0,\dots,X_n=x_n)\\
    &=\frac{\mathbb{P}(X_0=x_0,\dots,X_n=x_n,X_{n+1}=y)}{\mathbb{P}(X_0=x_0,\dots,X_n=x_n)}
    =Q(x_n,y),
  \end{align*}
  即 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链。
\end{proof}

\begin{remark}
  这表明对于 Markov 链 $(X_n)_{n\in \mathbb{Z}_+}$，$(X_0,X_1,\dots,X_n)$
  的分布完全由初始分布和转移矩阵 $Q$ 确定。
\end{remark}

\begin{proposition}
  $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链。
  \begin{enumerate}
    \item 对于每个 $n\geq 0$ 和可测函数 $f:E\to \mathbb{R}_+$，
    \[
      \mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]=\mathbb{E}[f(X_{n+1})|X_n]=Qf(X_n).
    \]
    更一般地，对于 $\{0,1,\dots,n-1\}$ 的任意子集 $\{i_1,\dots,i_k\}$，我们有
    \[
      \mathbb{E}[f(X_{n+1})|X_{i_1},\dots,X_{i_k},X_n]=Qf(X_n).
    \]
    \item 对于每个 $n\geq 0$，$p\geq 1$ 以及 $y_1,\dots,y_p\in E$，有
    \begin{align*}
      &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0,\dots,X_n)\\
      &=Q(X_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p).
    \end{align*}
    因此，有
    \[
      \mathbb{P}(X_{n+p}=y_p|X_n)=\mathbb{P}(X_{n+p}=y_p|X_0,\dots,X_n)=
      Q_p(X_n,y_p).
    \]
    如果我们固定 $n\geq 0$，对于每个 $p\in \mathbb{Z}_+$，令 $Y_p=X_{n+p}$，
    那么随机过程 $(Y_p)_{p\in \mathbb{Z}_+}$ 仍然是带有转移矩阵 $Q$ 的 Markov 链。
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 注意到 $f(X_{n+1})=\sum_{y\in E}f(y)\indicator{\{X_{n+1}=y\}}$，那么
  \begin{align*}
    \mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]
    &=\sum_{y\in E}f(y)\mathbb{P}(X_{n+1}=y|X_0,X_1,\dots,X_n)\\
    &=\sum_{y\in E}f(y)Q(X_n,y)\\
    &=Qf(X_n).
  \end{align*}
  对于 $\{0,1,\dots,n-1\}$ 的任意子集 $\{i_1,\dots,i_k\}$，我们有
  \begin{align*}
    &\mathbb{E}[f(X_{n+1})|X_{i_1},\dots,X_{i_k},X_n]\\
    &=\mathbb{E}\bigl[\mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]\bigm| X_{i_1},\dots,X_{i_k},X_n\bigr]\\
    &=\mathbb{E}[Qf(X_n)|X_{i_1},\dots,X_{i_k},X_n]\\
    &=Qf(X_n).
  \end{align*}

  (2) 根据 \autoref{prop:law of X0 to Xn}，有
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0=x_0,\dots,X_n=x_n)\\
    &=\frac{\mathbb{P}(X_0=x_0)Q(x_0,x_1)\cdots Q(x_n,y_1)\cdots Q(y_{p-1},y_p)}{
      \mathbb{P}(X_0=x_0)Q(x_0,x_1)\cdots Q(x_{n-1},x_n)
    }\\
    &=Q(x_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p),
  \end{align*}
  即 
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0,\dots,X_n)\\
    &=Q(X_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p).
  \end{align*}

  对于 $p=2$ 的情况，有
  \begin{align*}
    \mathbb{P}(X_{n+2}=y_2|X_0,\dots,X_n)
    &=\sum_{y_1\in E}\mathbb{P}(X_{n+1}=y_1,X_{n+2}=y_2|X_0,\dots,X_n)\\
    &=\sum_{y_1\in E} Q(X_n,y_1)Q(y_1,y_2)\\
    &=Q_2(X_n,y_2),
  \end{align*}
  一般的情况由此归纳即可。于是
  \begin{align*}
    \mathbb{P}(X_{n+p}=y_p|X_n)
    &=\mathbb{E}\bigl[\mathbb{P}(X_{n+p}=y_p|X_0,\dots,X_n)\bigm| X_n\bigr]\\
    &=\mathbb{E}[Q_p(X_n,y_p)|X_n]=Q_p(X_n,y_p).
  \end{align*}

  最后我们验证 $(Y_p)_{p\in \mathbb{Z}_+}$ 是带有转移矩阵 $Q$ 的 Markov 链。
  根据定义，有
  \begin{align*}
    &\mathbb{P}(Y_{p+1}=y_{p+1}|Y_0,\dots,Y_p)\\
    &=\mathbb{P}(X_{n+p+1}=y_{p+1}|X_n,\dots,X_{n+p})\\
    &=\mathbb{E}\bigl[\mathbb{P}(X_{n+p+1}=y_{p+1}|X_0,\dots,X_{n+p})\bigm| X_n,\dots,X_{n+p}\bigr]\\
    &=\mathbb{E}[Q(X_{n+p},y_{p+1})|X_n,\dots,X_{n+p}]\\
    &=Q(X_{n+p},y_{p+1})=Q(Y_p,y_{p+1}),
  \end{align*}
  这就表明 $(Y_p)_{p\in \mathbb{Z}_+}$ 是带有转移矩阵 $Q$ 的 Markov 链。
\end{proof}


\section{例子}

\subsection{$\mathbb{Z}^d$ 上的随机游走}


\section{典范的 Markov 链}

在本节中，我们解释如何对概率空间（和随机过程）进行典范的选择，以获得具有给定转移矩阵的 Markov 链。
这与前面的章节形成对比，前面的章节没有指定潜在的概率空间。在 Markov 链的背景下，这种典范的选择
将有几个优点。特别是，它将使我们能够同时考虑给定的 Markov 链和所有可能的初始点。

\begin{proposition}
  令 $Q$ 是 $E$ 上的随机矩阵，我们可以找到一个概率空间 $(\Omega,\mathcal{A},\mathbb{P})$ 使得对于
  每个 $x\in E$，都可以构建一个带有转移矩阵 $Q$ 的 Markov 链 $(X_n^x)_{n\in \mathbb{Z}_+}$ 且
  $X_0^x=x$。
\end{proposition}

下面我们解释这个概率空间的选择，我们令
\[
  \mat\Omega=E^{\mathbb{Z}_+},
\]
即 $\mat\Omega$ 的元素形如 $\omega=(\omega_0,\omega_1,\omega_2,\dots)$。定义坐标映射
$\mat X_n$ 为 $\mat X_n(\omega)=\omega_n$。我们给 $\mat\Omega$ 配备使得所有坐标映射
$\mat X_n$ 都可测的最小的 $\sigma$-域，记为 $\mathfrak{F}$，等价地说，
$\mathfrak{F}$ 由所有的柱集生成：
\[
  \{x_0\}\times\cdots\times\{x_n\}\times E\times E\times \cdots,
\]
其中 $n\in \mathbb{Z}_+,x_0,\dots,x_n\in E$。

\begin{lemma}
  令 $(G,\mathcal{G})$ 是可测空间，映射$\psi:G\to \mat\Omega$，那么
  $\psi$ 可测当且仅当 $\mat X_n\circ\psi$ 可测。
\end{lemma}

\begin{theorem}
  令 $Q$ 是 $E$ 上的随机矩阵，对于每个 $x\in E$，存在唯一的 $(\mat\Omega,\mathfrak F)$ 上
  的概率测度 $\matup P_x$ 使得坐标过程 $(\mat X_n)_{n\in \mathbb{Z}_+}$ 是带有
  转移矩阵 $Q$ 的 Markov 链并且 $\matup P_x(\mat X_0=x)=1$。
\end{theorem}
\begin{remark}
  我们将说在概率空间 $(\mat\Omega,\mathfrak F,\matup P_x)$ 上的坐标过程
  $(\mat X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 和初值 $x$ 的\emph{典范 Markov 链}。
\end{remark}

\begin{remark}\label{rmk:canonical Markov}
  令 $(Y_n)_{n\in \mathbb{Z}_+}$ 是概率测度 $\mathbb{P}$ 下具有转移矩阵 $Q$ 的 Markov 链
  且 $Y_0=x$。那么对于 $\mat\Omega=E^{\mathbb{Z}_+}$ 的任意可测子集 $B$，有
  \[
    \mathbb{P}\bigl((Y_n)_{n\in \mathbb{Z}_+}\in B\bigr)=\matup P_x(B).
  \]
  事实上，当 $B$ 是柱集（cylinder set）时，这个等式成立，然后依据单调类给出一般情况。
  这个等式表明，我们后面为典范 Markov 链建立的所有结果都可以转移到具有相同转移矩阵的任何
  Markov 链上（无论它是在哪个概率空间上定义的）。
\end{remark}

\section{状态分类}

从现在开始，除非另有说明，否则我们将考虑上一节中针对 $E$ 上给定随机矩阵 $Q$ 引入的典范 Markov 链。
如 \autoref{rmk:canonical Markov} 所述，我们可以将得出的所有结果都转移到
在任何概率空间上定义的具有相同转移矩阵的 Markov 链。

回顾记号
\[
  H_x=\inf\{n\geq 1| \mat X_n=x\}, N_x=\sum_{n=0}^\infty \indicator{\{\mat X_n=x\}}.
\]
在 Markov 链中，$H_x$ 可以解释为状态第一次经过点 $x$ 时需要的步数，
$N_x$ 可以解释为状态经过点 $x$ 的次数。

\begin{proposition}\label{prop:recurrent and transient}
  令 $x\in E$，那么
  \begin{itemize}
    \item 要么 $\matup P_x(H_x<\infty)=1$，此时
    \[
      N_x=\infty,\ \alsu{\matup P_x}
    \]
    这种情况下 $x$ 被称为\emph{常返的}。
    \item 要么 $\matup P_x(H_x<\infty)<1$，此时
    \[
      N_x<\infty,\ \alsu{\matup P_x}
    \]
    更准确地，对于每个 $k\geq 1$ 有 $\matup P_x(N_x=k)=\matup P_x(H_x=\infty)\matup P_x(H_x<\infty)^{k-1}$，
    并且 $\matup E_x[N_x]=1/\matup P_x(H_x=\infty)<\infty$，在这种情况下 $x$
    被称为是\emph{暂留的}。
  \end{itemize}
\end{proposition}
\begin{remark}
  直观上来说，$\matup P_x(H_x<\infty)=1$ 的情况表明如果状态几乎肯定能够经过点 $x$，那么
  其几乎肯定能够无数次经过点 $x$。$\matup P_x(H_x<\infty)<1$ 的情况表明
  如果状态不一定能经过点 $x$，那么其经过点 $x$ 的次数几乎肯定是有限次，且期望也是有限次。
\end{remark}

\begin{definition}
  Markov 链的潜在核定义为 $E\times E$ 上的函数 
  \[
    U(x,y)=\matup E_x[N_y].
  \]
\end{definition}

注意到 $U(x,y)>0$ 当且仅当从 $x$ 出发的链能够到达 $y$ 的概率是正的。

\begin{proposition}
  \mbox{}
  \begin{enumerate}
    \item 对于每个 $x,y\in E$，有
    \[
      U(x,y)=\sum_{n=0}^\infty Q_n(x,y).  
    \]
    \item $U(x,x)=\infty$ 当且仅当 $x$ 是常返的。
    \item 对于每个 $x,y\in E$ 且 $x\neq y$，有
    \[
      U(x,y)=\matup P_x(H_y<\infty) U(y,y).  
    \]
    因此，如果 $y$ 是暂留的，那么对于每个 $x\in E$，
    我们有 $\matup P_x(N_y<\infty)=1$。
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 直接计算可知
  \[
    U(x,y)=\matup E_x\left[
      \sum_{n=0}^\infty \indicator{\{\mat X_n=y\}}
    \right]  =\sum_{n=0}^\infty \matup P_x(\mat X_n=y)
    =\sum_{n=0}^\infty Q_n(x,y).
  \]

  (2) 根据 $U$ 的定义，我们有
  $U(x,x)=\infty$ 当且仅当 $\matup P_x(N_x=\infty)=1$，
  即 $x$ 是常返的。

  (3) 
\end{proof}

\begin{remark}
  这个命题告诉我们
  \[
    U(x,y)=\sum_{n=0}^\infty Q_n(x,y)=\sum_{n=0}^\infty
    \matup P_x(X_{m+n}=y|X_m=x),
  \]
  所以 $U(x,y)>0$ 当且仅当存在某个 $n$ 使得 $\matup P_x(X_{m+n}=y|X_m=x)>0$。
  有些教材会把 $\matup P_x(X_{m+n}=y|X_m=x)$ 记为 $p_{xy}^{(n)}$，
  称作\emph{$n$ 步转移概率}。若 $U(x,y)>0$（等价地说，存在
  $n\geq 0$ 使得 $p_{xy}^{(n)}>0$），那么我们说 $x$ \emph{可达}
  $y$，记为 $x\to y$。如果同时有 $y\to x$，那么我们说 
  $x$ 和 $y$ \emph{互通}，记为 $x\leftrightarrow y$。
  不难验证互通是一个等价关系。
\end{remark}

我们记所有常返点的集合为 $R$。

\begin{lemma}
  假设 $x\in R$ 且 $y\in E \smallsetminus\{x\}$ 使得 $U(x,y)>0 \ (x\to y)$，
  那么 $y\in R$ 且 $\matup P_y(H_x<\infty)=1$，因此 $U(y,x)>0\ (y\to x)$。
\end{lemma}





\end{document}
