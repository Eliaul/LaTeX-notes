\documentclass[fontset=none]{Notes}

\makeatletter
\DeclareRobustCommand{\em}{%
  \@nomath\em \if b\expandafter\@car\f@series\@nil
  \normalfont \else \bfseries \fi}
\makeatother

\usepackage{tikz-cd,wrapstuff}
\usepackage{fixdif,siunitx,tikz,nicematrix}
\usetikzlibrary{matrix,calc}

\input{font.def}

\usepackage[subscriptcorrection,nofontinfo,mtpbb,mtpfrak]{mtpro2}

\tikzcdset{
  arrow style=tikz,
  diagrams={>={Straight Barb[scale=0.8]}}
}

\allowdisplaybreaks[1]

\newlength{\mymathln}
\newcommand{\aligninside}[2]{
  \settowidth{\mymathln}{#2}
  \mathmakebox[\mymathln]{#1}
}

\DeclareMathOperator\Spec{Spec}
\DeclareMathOperator\im{im}
\DeclareMathOperator\nil{nil}
\DeclareMathOperator\rad{rad}
\DeclareMathOperator\Ann{Ann}
\DeclareMathOperator\Max{Max}
\DeclareMathOperator\GL{GL}
\DeclareMathOperator\End{End}
\DeclareMathOperator\Int{Int}
\DeclareMathOperator\Tor{Tor}
\DeclareMathOperator\Frac{Frac}
\DeclareMathOperator\Tr{Tr}
\DeclareMathOperator\Hom{Hom}
\DeclareMathOperator\Leb{Leb}
\DeclareMathOperator\supp{supp}
\DeclareMathOperator\Id{Id}
\DeclareMathOperator\rk{rank}
\DeclareMathOperator\var{var}
\DeclareMathOperator\card{card}
\DeclareMathOperator\coker{coker}

\newcommand{\ideal}[1]{\mathfrak{#1}}
\newcommand{\mat}[1]{\mathbold{#1}}
\newcommand{\matup}[1]{\mathbf{#1}}
\newcommand{\uline}{\underline{\hphantom{X}}}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\ulim}[1][]{\lim_{#1}\mathrel{\uparrow}}
\newcommand{\dlim}[1][]{\lim_{#1}\mathrel{\downarrow}}
\newcommand{\indicator}[1]{\mathbold 1_{#1}}
\newcommand{\alev}[1]{\text{$#1$ a.e.}}
\newcommand{\alsu}[1]{\text{$#1$ a.s.}}
\newcommand{\norm}[1]{\left\Vert#1\right\Vert}

\usepackage{enumitem}

\setlist[enumerate]{nosep}

%\DeclareMathAlphabet\mathcal{OMS}{cmsy}{m}{n}

\newlength\stextwidth
\newcommand\makesamewidth[3][c]{%
  \settowidth{\stextwidth}{#2}%
  \makebox[\stextwidth][#1]{#3}%
}



\begin{document}

\frontmatter

\tableofcontents

\mainmatter

% \chapter{测度和积分}

% \section{可测空间}

% 令 $E$ 是集合，$\mathcal{E}$ 是 $E$ 的一个子集族。若对于任意 $A,B\in\mathcal{E}$ 有
% $A\cap B\in\mathcal{E}$，那么我们说 $\mathcal{E}$ \emph{对交封闭}。如果 $\mathcal{E}$
% 中任意可数个集合的交还在 $\mathcal{E}$ 中，那么我们说 $\mathcal{E}$ 对可数交封闭。
% 类似地，我们可以定义对补封闭、对并封闭和对可数并封闭的概念。

% \subsubsection{$\sigma$-代数}

% 如果 $E$ 的非空子集族 $\mathcal{E}$ 对补和有限并封闭，那么我们说 $\mathcal{E}$
% 是 $E$ 上的\emph{代数}。如果其对补和可数并封闭，那么我们说 $\mathcal{E}$
% 是 $E$ 上的\emph{$\sigma$-代数}，即：
% \begin{alphenum}
%   \item $A\in\mathcal{E}\Rightarrow E\smallsetminus A\in\mathcal{E}$，
%   \item $A_1,A_2,\dotsc\in \mathcal{E}\Rightarrow\bigcup_n A_n\in\mathcal{E}$。
% \end{alphenum}
% 由于 $\left(\bigcup_n A_n\right)^c=\bigcap_n A_n^c\in\mathcal{E}$，所以对补和可数并封闭
% 可以自然导出对可数交封闭，即 $\sigma$-代数对可数交也封闭。

% 任取 $A\in \mathcal{E}$，那么 $E=A\cup(E \smallsetminus A)\in \mathcal{E}$，所以 $E$ 上
% 任意 $\sigma$-代数都至少包含 $E$ 和 $\emptyset$。事实上，$\mathcal{E}=\{E,\emptyset\}$
% 是 $E$ 上的最简单的 $\sigma$-代数，被称为\emph{平凡 $\sigma$-代数}。$E$ 上最大的
% $\sigma$-代数当然是 $\mathcal{E}=2^E$，即 $\mathcal{E}$ 就是 $E$ 的幂集，被
% 称为\emph{离散 $\sigma$-代数}。

% 不难看出，$E$ 上一族 $\sigma$-代数的任意交(不一定可数)还是 $E$ 上的 $\sigma$-代数。
% 给定 $E$ 的一个子集族 $\mathcal{C}$，我们可以考虑所有包含 $\mathcal{C}$ 
% 的 $\sigma$-代数(总是存在至少一个这样的 $\sigma$-代数，即 $2^E$)，将这些
% $\sigma$-代数取交集，我们便得到了包含 $\mathcal{C}$ 的最小的 $\sigma$-代数，
% 被称为\emph{由 $\mathcal{C}$ 生成的} $\sigma$-代数，记为 $\sigma\mathcal{C}$。

% 如果 $E$ 是拓扑空间，由 $E$ 的所有开集族生成的 $\sigma$-代数被称为 $E$ 上的
% \emph{Borel $\sigma$-代数}，记为 $\mathcal{B}(E)$ 或者 $\mathcal{B}_E$，
% 其元素被称为\emph{Borel 集}。

% \subsubsection{p-系和 d-系}

% 对于 $E$ 的子集族 $\mathcal{C}$，如果其对交封闭，那么我们说 $\mathcal{C}$
% 是一个 p-系，这里 p 代表 product，是“交”的另一种说法。
% $E$ 的子集族 $\mathcal{D}$ 被称为 d-系，如果其满足：
% \begin{alphenum}
%   \item $E\in\mathcal{D}$，
%   \item $\text{$A,B\in \mathcal{D}$ and $A\supseteq B\Rightarrow A \smallsetminus B\in \mathcal{D}$}$，
%   \item $\text{$(A_n)\subseteq \mathcal{D}$ and $A_n\nearrow A\Rightarrow A\in \mathcal{D}$}$。
% \end{alphenum}
% 其中 $(A_n)\subseteq D$ 表明 $(A_n)$ 是 $D$ 中的集合序列，$A_n\nearrow A$ 表明这个序列
% 递增于极限 $A$：
% \[
%   A_1\subseteq A_2\subseteq\cdots,\quad \bigcup_{n=1}^\infty A_n=A.
% \]

% 显然一个 $\sigma$-代数既是 p-系又是 d-系，其反面也是成立的。所以 p-系和 d-系是产生
% $\sigma$-代数的原始结构。

% \begin{proposition}\label{prop:equivalent condition of sigma algebra}
%   $E$ 的子集族是 $\sigma$-代数当且仅当其既是 p-系又是 d-系。
% \end{proposition}
% \begin{proof}
%   $(\Rightarrow)$ 若 $\mathcal{E}$ 是 $\sigma$-代数，其显然是 p-系并且满足 d-系的条件 (a) 和 (c)。
%   下面我们验证其满足 d-系的条件 (b)。任取 $A,B\in\mathcal{E}$ 且 $A\supseteq B$，
%   那么 $A \smallsetminus B=A\cap (E \smallsetminus B)\in \mathcal{E}$，
%   所以 $\mathcal{E}$ 是 d-系。

%   $(\Leftarrow)$ 若 $\mathcal{E}$ 既是 p-系又是 d-系。任取 $A\in \mathcal{E}$，
%   根据 d-系的 (a) 和 (b)，我们有 $E \smallsetminus A\in \mathcal{E}$。
%   所以 $\mathcal{E}$ 对补封闭。然后我们说明对并封闭。任取 $A,B\in \mathcal{E}$， 
%   由于
%   \[
%     A\cup B=E \smallsetminus (A\cup B)^c=E \smallsetminus (A^c\cap B^c),
%   \]
%   结合 p-系对交封闭，所以 $A\cup B\in \mathcal{E}$。最后我们说明对可数并封闭。
%   如果 $(A_n)\subseteq \mathcal{E}$，令 $B_n=A_1\cup\cdots\cup A_n$，
%   那么 $(B_n)\subseteq \mathcal{E}$ 且 $B_n\nearrow A$，根据 d-系的 (c)，所以
%   $A\in \mathcal{E}$，故 $\mathcal{E}$ 对可数并封闭。
% \end{proof}

% 下面的引理为本节的主要定理做准备。

% \begin{lemma}\label{lemma:hat D}
%   令 $\mathcal{D}$ 是 $E$ 上的 d-系，固定 $D\in \mathcal{D}$，令
%   \[
%     \hat{\mathcal{D}}=\{A\in \mathcal{D}: A\cap D\in \mathcal{D}\},
%   \]
%   那么 $\hat{\mathcal{D}}$ 仍然是 d-系。
% \end{lemma}

% \subsubsection{单调类定理}

% 这是一个非常有用的工具来证明某些集族是 $\sigma$-代数。

% \begin{theorem}\label{thm:monotone class theorem}
%   如果一个 d-系包含一个 p-系，那么其包含这个 p-系生成的 $\sigma$-代数。
% \end{theorem}
% \begin{proof}
%   设 $\mathcal{C}$ 是一个 p-系。令 $\mathcal{D}$ 是包含 $\mathcal{C}$
%   的最小的 d-系，即包含 $\mathcal{C}$ 的所有 d-系的交(不难看出 d-系的任意交是 d-系)。
%   我们证明 $\mathcal{D}$ 实际上是一个 $\sigma$-代数，这样包含 $\mathcal{C}$
%   的任意 d-系都包含 $\mathcal{D}$，而 $\mathcal{D}$ 作为包含 $\mathcal{C}$
%   的 $\sigma$-代数，其包含 $\sigma \mathcal{C}$。
%   根据 \autoref{prop:equivalent condition of sigma algebra}，只需要说明 
%   $\mathcal{D}$ 既是 p-系又是 d-系，而 $\mathcal{D}$ 已经是 d-系，所以只需要
%   说明 $\mathcal{D}$ 是 p-系。

%   我们首先说明对于任意的 $D\in \mathcal{D}$ 和 $C\in \mathcal{C}$，
%   有 $D\cap C\in \mathcal{D}$。令
%   \[
%     \mathcal{D}_1=\{A\in \mathcal{D}: A\cap C\in \mathcal{D}\},  
%   \]
%   根据 \autoref{lemma:hat D}，$\mathcal{D}_1$ 是 d-系。由于 $\mathcal{C}$
%   是 p-系，所以 $\mathcal{C}\subseteq \mathcal{D}_1$，即 $\mathcal{D}_1$
%   是包含 $\mathcal{C}$ 的 d-系，所以 $\mathcal{D}\subseteq \mathcal{D}_1$。
%   这就表明 $D\in \mathcal{D}_1$，即 $D\cap C\in \mathcal{D}$。

%   下面说明对于任意的 $D,B\in \mathcal{D}$，有 $D\cap B\in \mathcal{D}$。
%   令
%   \[
%     \mathcal{D}_2=\{A\in \mathcal{D}: A\cap D\in \mathcal{D}\} .
%   \]
%   同样根据 \autoref{lemma:hat D}，$\mathcal{D}_2$ 是 d-系。根据上面的叙述，
%   有 $\mathcal{C}\subseteq \mathcal{D}_2$，即 $\mathcal{D}_2$ 是包含 
%   $\mathcal{C}$ 的 d-系，所以 $\mathcal{D}\subseteq \mathcal{D}_2$，
%   这就表明 $B\in \mathcal{D}_2$，即 $D\cap B\in \mathcal{D}$。
%   这就证明了 $\mathcal{D}$ 是 p-系。
% \end{proof}

% \subsubsection{可测空间}

% 一个\emph{可测空间}指的是二元组 $(E,\mathcal{E})$，其中 $E$ 是集合，
% $\mathcal{E}$ 是 $E$ 上的 $\sigma$-代数。此时，$\mathcal{E}$
% 的元素被称为\emph{可测集}。当 $E$ 是拓扑空间，$\mathcal{E}=\mathcal{B}_E$
% 的时候，可测集也被称为\emph{Borel 集}。

% \subsubsection{可测空间的积}

% 令 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$ 是可测空间。
% 如果 $A\in \mathcal{E}$ 和 $B\in \mathcal{F}$，那么 $A\times B$
% 被称为\emph{可测矩形}。我们用 $\mathcal{E}\otimes \mathcal{F}$
% 表示 $E\times F$ 上的由可测矩形集族生成的 $\sigma$-代数，
% 被称为\emph{乘积 $\sigma$-代数}。可测空间 $(E\times F,\mathcal{E}\otimes \mathcal{F})$
% 被称为 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$ 的积，我们通常使用
% $(E,\mathcal{E})\times (F,\mathcal{F})$ 来表示。

% \subsubsection{Exercises}

% \begin{exercise}{划分生成 $\sigma$-代数}{}
%   \begin{alphenum}[nosep]
%     \item 令 $\mathcal{C}=\{A,B,C\}$ 是 $E$ 的一个划分，列出
%     $\sigma \mathcal{C}$ 的元素。
%     \item 令 $\mathcal{C}$ 是 $E$ 的(可数)划分。证明 $\sigma \mathcal{C}$
%     的每个元素都是 $\mathcal{C}$ 中元素的可数并。
%     \item 令 $E=\mathbb{R}$，$\mathcal{C}$ 是 $\mathbb{R}$ 的所有单点子集
%     构成的子集族。证明 $\sigma \mathcal{C}$ 的元素要么是可数集要么
%     是可数集的补集。这表明从直观上来看，$\sigma \mathcal{C}$ 要比 $\mathcal{B}(\mathbb{R})$
%     小得多，例如开区间 $(0,1)$ 属于后者但是不属于前者。
%   \end{alphenum}
% \end{exercise}
% \begin{solution}
%   (a) 令
%   \[
%     \mathcal{E}=\{A,B,C,A\cup B,A\cup C,B\cup C,E\},
%   \]
%   显然 $\mathcal{E}$ 是一个 $\sigma$-代数。对于任意包含 $\mathcal{C}$
%   的 $\sigma$-代数，由于其对并封闭，所以其必须包含 $\mathcal{E}$，
%   所以 $\mathcal{E}=\sigma \mathcal{C}$。

%   (b) 令 $\mathcal{E}$ 为 $\mathcal{C}$ 中元素的所有可数并构成的
%   集族。根据 $\sigma$-代数对可数并的封闭性，所以 $\sigma \mathcal{C}\supseteq \mathcal{E}$。
%   设 $(A_n)$ 构成 $E$ 的可数划分，即 $(A_n)$ 两两不相交且 $E=\bigcup_n A_n$。
%   任取 $\bigcup_k A_{n_k}\in \mathcal{E}$，那么
%   $E \smallsetminus \left(\bigcup_k A_{n_k}\right)$ 依然是某些 $(A_n)$
%   的可数并，所以 $E \smallsetminus \left(\bigcup_k A_{n_k}\right)\in \mathcal{E}$，
%   即 $\mathcal{E}$ 对补封闭，所以 $\mathcal{E}$ 是 $\sigma$-代数，
%   所以 $\mathcal{E}=\sigma \mathcal{C}$。

%   (c) 令 $\mathcal{E}$ 为 $\mathbb{R}$ 的可数子集和补集可数的子集构成的子集族。
%   显然 $\mathcal{E}\subseteq \sigma \mathcal{C}$ 且不难验证 $\mathcal{E}$
%   是一个 $\sigma$-代数(可数个可数集的并是可数集)，所以 $\mathcal{E}=\sigma \mathcal{C}$。
% \end{solution}

% \begin{exercise}{$\mathbb{R}$ 上的 Borel $\sigma$-代数}{}
%   $\mathbb{R}=(-\infty,+\infty)$ 的任意开子集都是开区间的可数并。使用这一事实证明
%   $\mathcal{B}(\mathbb{R})$ 由所有开区间构成的子集族生成。
% \end{exercise}
% \begin{proof}
%   设 $\mathcal{C}$ 为所有开区间构成的子集族，$\mathcal{T}$ 为所有开集构成的子集族(即 $\mathbb{R}$ 上的拓扑)。
%   显然 $\mathcal{C}\subseteq \mathcal{T}$，
%   所以 $\sigma \mathcal{C}\subseteq \sigma \mathcal{T}=\mathcal{B}(\mathbb{R})$。由于
%   $\mathcal{T}$ 中集合都是 $\mathcal{C}$ 中集合的可数并，所以 $\mathcal{T}\subseteq \sigma \mathcal{C}$，
%   这表明 $\mathcal{B}(\mathbb{R})=\sigma \mathcal{T}\subseteq \sigma \mathcal{C}$。
%   所以 $\mathcal{B}(\mathbb{R})=\sigma \mathcal{C}$ 由所有开区间构成的子集族生成。
% \end{proof}

% \begin{exercise}{$\mathbb{R}$ 上的 Borel $\sigma$-代数}{}
%   证明：$\mathbb{R}$ 中的任意区间都是 Borel 集。特别的，$(-\infty,x),(-\infty,x],(x,y],[x,y]$ 都是 Borel 集。
%   对于每个 $x$，单点集 $\{x\}$ 也是 Borel 集。 
% \end{exercise}
% \begin{proof}
%   只需注意到
%   \begin{gather*}
%     (-\infty,x)=\bigcup_{n=1}^\infty \left(-n+x,x\right), 
%     (-\infty, x]=\bigcap_{n=1}^\infty \left(-\infty,x+\frac{1}{n}\right),\\
%     (x,y]=\bigcap_{n=1}^\infty \left(x,y+\frac{1}{n}\right),
%     [x,y]=\bigcap_{n=1}^\infty\left(x-\frac{1}{n},y\right],
%     \{x\}=\bigcap_{n=1}^\infty\left(x-\frac{1}{n},x\right].
%   \end{gather*}
%   所以上述集合都是 Borel 集，对于其他的区间同理。
% \end{proof}

% \begin{exercise}{$\mathbb{R}$ 上的 Borel $\sigma$-代数}{}
%   证明 $\mathcal{B}(\mathbb{R})$ 可以由以下任意一种集族生成(实际上还有很多可能)：
%   \begin{alphenum}[nosep]
%     \item 所有形如 $(-\infty, x]$ 的区间构成的子集族。
%     \item 所有形如 $(x,y]$ 的区间构成的子集族。
%     \item 所有形如 $[x,y]$ 的区间构成的子集族。
%     \item 所有形如 $(x,+\infty)$ 的区间构成的子集族。
%   \end{alphenum}
%   此外，在每种情况中 $x,y$ 可以被限制为有理数。
% \end{exercise}
% \begin{proof}
%   (a) 记该集族为 $\mathcal{C}$，由上题，这样的区间已经是 Borel 集，
%   所以 $\sigma\mathcal{C}\subseteq \mathcal{B}(\mathbb{R})$。任取 $\mathbb{R}$
%   的开区间 $(x,y)$，有
%   \[
%     (x,y)=(-\infty,x]^c\cap (-\infty, y)=
%     (-\infty,x]^c\cap\bigcup_{n=1}^\infty \left(-\infty,y-\frac{1}{n}\right]\in\sigma \mathcal{C},
%   \]
%   而 $\mathcal{B}(\mathbb{R})$ 由所有开区间生成，所以 $\mathcal{B}(\mathbb{R})\subseteq \sigma \mathcal{C}$。
%   所以 $\mathcal{B}(\mathbb{R})=\sigma \mathcal{C}$。

%   (b) (c) (d) 完全同理。
% \end{proof}

% \begin{exercise}{迹空间}{}
%   令 $(E,\mathcal{E})$ 是可测空间，固定 $D\subseteq E$，令
%   \[
%     \mathcal{D}=\mathcal{E}\cap D=\{A\cap D:A\in \mathcal{E}\}.  
%   \]
%   证明 $\mathcal{D}$ 是 $D$ 上的 $\sigma$-代数，被称为 $\mathcal{E}$
%   在 $D$ 上的\emph{迹}。$(D,\mathcal{D})$ 也被称为 $(E,\mathcal{E})$
%   在 $D$ 上的迹。
% \end{exercise}
% \begin{proof}
%   任取 $A\cap D\in \mathcal{D}$，其中 $A\in \mathcal{E}$，那么
%   \[
%     D \smallsetminus (A\cap D)= (E \smallsetminus A)\cap D\in \mathcal{D},
%   \]
%   所以 $\mathcal{D}$ 对补封闭。任取 $(A_n\cap D)\subseteq \mathcal{D}$，那么
%   \[
%     \bigcup_{n=1}^\infty  (A_n\cap D)=\left(\bigcup_{n=1}^\infty A_n\right)\cap D\in \mathcal{D},
%   \]
%   所以 $\mathcal{D}$ 对可数并封闭。
% \end{proof}

% \begin{exercise}{子集的 Borel $\sigma$-代数是迹}{}
%   设 $(E,\mathcal{T})$ 是拓扑空间，$(D,\mathcal{T}_D)$ 是
%   子空间。证明 $D$ 上的 Borel $\sigma$-代数 $\mathcal{B}_D$
%   与 $D$ 在 $E$ 上的迹 $\mathcal{B}_E\cap D$ 相同。
% \end{exercise}
% \begin{proof}
%   由于 $\mathcal{T}_D=\mathcal{T}\cap D\subseteq \mathcal{B}_E\cap D$，
%   由上题 $\mathcal{B}_E\cap D$ 是 $\sigma$-代数，所以 $\mathcal{B}_D\subseteq\mathcal{B}_E\cap D$。
%   记
%   \[
%     \mathcal{C}=\{A\subseteq E: A\cap D\in \mathcal{B}_D\},  
%   \]
%   那么 $\mathcal{T}\subseteq \mathcal{C}$。我们只需要证明 $\mathcal{C}$
%   是 $E$ 上的 $\sigma$-代数，那么就有 $\mathcal{C}\supseteq \sigma \mathcal{T}=\mathcal{B}_E$，即
%   $\mathcal{B}_D\supseteq \mathcal{C}\cap D\supseteq \mathcal{B}_E\cap D$。
%   任取 $A\in \mathcal{C}$，那么 $(E \smallsetminus A)\cap D=D \smallsetminus (A\cap D)\in \mathcal{B}_D$，
%   所以 $E \smallsetminus A\in \mathcal{C}$。任取 $(A_n)\subseteq \mathcal{C}$，那么
%   \[
%     \left(\bigcup_{n=1}^\infty A_n\right)\cap D=\bigcup_{n=1}^\infty (A_n\cap D)
%     \in \mathcal{B}_D,  
%   \]
%   所以 $\bigcup_n A_n\in \mathcal{C}$。这就表明 $\mathcal{C}$
%   是 $E$ 上的 $\sigma$-代数。
% \end{proof}


% \section{可测函数}

% \subsubsection{可测函数}

% 令 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$ 是可测空间，映射 $f:E\to F$ 如果使得任取 $B\in \mathcal{F}$，有
% $f^{-1}B\in \mathcal{E}$，那么我们说 $f$ 相对于 $\mathcal{E}$ 和 $\mathcal{F}$ \emph{可测}。

% \begin{proposition}\label{prop:equivalent condition of measurable}
%   映射 $f:E\to F$ 相对于 $\mathcal{E}$ 和 $\mathcal{F}$ 可测当且仅当对于任意生成 $\mathcal{F}$ 的子集族
%   $\mathcal{F}_0$，任取 $B\in \mathcal{F}_0$，有 $f^{-1}B\in \mathcal{E}$。
% \end{proposition}
% \begin{proof}
%   必要性显然。下证充分性。设 $\mathcal{F}_0$ 使得 $\mathcal{F}=\sigma \mathcal{F}_0$，且
%   对于任意的 $B\in \mathcal{F}_0$ 有 $f^{-1}B\in \mathcal{E}$。记
%   \[
%     \mathcal{F}_1=\{A\in \mathcal{F}: f^{-1}A\in \mathcal{E}\},
%   \]
%   显然 $\mathcal{F}_0\subseteq \mathcal{F}_1\subseteq \mathcal{F}$。由于
%   \[
%     f^{-1}\left(F \smallsetminus A\right)=E \smallsetminus(f^{-1}A),\quad
%     f^{-1}\left(\bigcup_{i\in I}A_i\right)=\bigcup_{i\in I} f^{-1}A_i,
%   \]
%   所以 $\mathcal{F}_1$ 是 $\sigma$-代数，所以 $\mathcal{F}=\mathcal{F}_1$，即 $f$ 
%   相对于 $\mathcal{E}$ 和 $\mathcal{F}$ 可测。
% \end{proof}

% \begin{proposition}
%   给定可测空间 $(E,\mathcal{E}),(F,\mathcal{F}),(G,\mathcal{G})$，如果 $f$ 相对于 $\mathcal{E}$ 和 
%   $\mathcal{F}$ 可测，$g$ 相对于 $\mathcal{F}$ 和 $\mathcal{G}$ 可测，那么复合
%   $g\circ f$ 相对于 $\mathcal{E}$ 和 $\mathcal{G}$ 可测。
% \end{proposition}
% \begin{proof}
%   任取 $C\in \mathcal{G}$，有
%   \[
%     (g\circ f)^{-1}(C)=f^{-1}\left(g^{-1}(C)\right),  
%   \]
%   $g$ 可测表明 $g^{-1}(C)\in \mathcal{F}$，$f$ 可测表明 $f^{-1}\left(g^{-1}(C)\right)\in \mathcal{E}$，
%   所以 $g\circ f$ 相对于 $\mathcal{E}$ 和 $\mathcal{G}$ 可测。
% \end{proof}

% \subsubsection{数值函数}

% 令 $(E,\mathcal{E})$ 是可测空间。回顾实数及扩充实数 $\mathbb{R}=(-\infty,+\infty)$，
% $\bar{\mathbb{R}}=[-\infty,+\infty]$，$\mathbb{R}_+=[0,+\infty)$，
% $\bar{\mathbb{R}}_+=[0,+\infty]$。$E$ 上的\emph{数值函数}指的是
% 从 $E$ 到 $\bar{\mathbb{R}}$ 或者 $\bar{\mathbb{R}}$ 的子集的映射。
% 如果这个映射的值在 $\mathbb{R}$ 中，那么我们一般称其为\emph{实值函数}。

% $E$ 上的数值函数如果相对于 $\mathcal{E}$ 和 $\mathcal{B}(\bar{\mathbb{R}})$
% 可测，那么我们说其是 $\mathcal{E}$-可测的。如果 $E$
% 是拓扑空间且 $\mathcal{E}=\mathcal{B}(E)$，那么 $\mathcal{E}$-可测函数
% 被称为\emph{Borel 函数}。
% 下面的命题是 \autoref{prop:equivalent condition of measurable} 的直接结果。

% \begin{proposition}
%   映射 $f:E\to\bar{\mathbb{R}}$ 是 $\mathcal{E}$-可测的当且仅当
%   对于每个 $r\in \mathbb{R}$，$f^{-1}[-\infty,r]\in \mathcal{E}$。
% \end{proposition}

% 上述命题中的 $[-\infty,r]$ 可以改为 $[-\infty,r)$，$[r,\infty]$，
% $(r,\infty]$ 中的任意一种。

% \subsubsection{函数的正部分和负部分}

% 对于 $a,b\in\bar{\mathbb{R}}$，我们记 $a\vee b$ 为 $a$ 和 $b$
% 中的最大者，$a\wedge b$ 为 $a$ 和 $b$ 中的最小者。
% 对于函数 $f,g$，用 $f\vee g$ 表示函数 $x\mapsto f(x)\vee g(x)$。
% 令 $(E,\mathcal{E})$ 是可测空间，$f$ 是 $E$ 上的数值函数。
% 那么
% \[
%   f^+=f\vee 0,\quad f^-=-(f\wedge 0)  
% \]
% 都是非负函数并且 $f=f^+-f^-$。函数 $f^+$ 被称为 $f$ 的\emph{正部分}，
% $f^-$ 被称为 $f$ 的\emph{负部分}。

% \begin{proposition}
%   函数 $f$ 是 $\mathcal{E}$-可测的当且仅当 $f^+$ 和 $f^-$
%   都是 $\mathcal{E}$-可测的。
% \end{proposition}
% \begin{proof}
%   若 $f$ 是 $\mathcal{E}$-可测的。任取 $r\in \mathbb{R}$，
% 若 $r< 0$，则 $\left(f^+\right)^{-1}[-\infty,r]=\emptyset\in \mathcal{E}$。
%   若 $r\geq 0$，则
%   \[
%     \left(f^+\right)^{-1}[-\infty,r]=E \smallsetminus \left(f^+\right)^{-1}(r,\infty]
%     =E \smallsetminus f^{-1}(r,\infty],
%   \]
%   由于 $(r,\infty]$ 是 Borel 集，所以 $\left(f^+\right)^{-1}[-\infty,r]\in \mathcal{E}$。
%   综合起来，$f^+$ 是 $\mathcal{E}$-可测的。同理可证 $f^-$ 是 $\mathcal{E}$-可测的。

%   若 $f^+$ 和 $f^-$ 都是 $\mathcal{E}$-可测的。任取 $r\in \mathbb{R}$，若 $r<0$，那么
%   \[
%     f^{-1}[-\infty,r]=  \left(f^-\right)^{-1}[-r,\infty]\in \mathcal{E}.
%   \]
%   若 $r\geq 0$，那么
%   \[
%     f^{-1}[-\infty,r]= E \smallsetminus f^{-1}(r,\infty]
%     =E \smallsetminus \left(f^+\right)^{-1}(r,\infty]\in \mathcal{E}.
%   \]
%   所以 $f$ 是 $\mathcal{E}$-可测的。
% \end{proof}

% \subsubsection{指示函数和简单函数}

% 令 $A\subseteq E$，定义 $A$ 的指示函数为 $1_A$：
% \[
%   1_A(x)=\begin{cases}
%     1 & x\in A,\\
%     0 & x\notin A.
%   \end{cases}  
% \]
% 对于 $1_E$，我们简记为 $1$。显然，$1_A$ 是 $\mathcal{E}$-可测的当且仅当
% $A\in \mathcal{E}$。

% $E$ 上的函数 $f$ 如果形如
% \[
%   f=\sum_{i=1}^n a_i 1_{A_i},  
% \]
% 其中 $n\geq 1$，$a_1,\dots,a_n\in \mathbb{R}$，$A_1,\dots,A_n$ 是可测集，
% 那么我们说 $f$ 是\emph{简单函数}。
% 在这个定义中，若 $A_i\cap A_j\ne\emptyset$，那么我们可以将
% $a_i1_{A_i}+a_j1_{A_j}$ 拆为
% \[ 
%   a_i1_{A_i \smallsetminus (A_i\cap A_j)}+(a_i+a_j)1_{A_i\cap A_j}+a_j 1_{A_j \smallsetminus (A_i\cap A_j)},
% \]
% 所以我们可以假设 $A_i$ 两两不相交。此外，如果 $\bigcup_i A_i\neq E$，记
% $B=E \smallsetminus\bigcup_i A_i\in \mathcal{E}$，那么
% \[
%   f=  \sum_{i=1}^n a_i 1_{A_i}+0\cdot 1_{B},
% \]
% 所以我们还可以假设 $\bigcup_i A_i=E$。这意味着对于一个简单函数 $f$，
% 总存在整数 $m$，不同的实数 $b_1,\dots,b_m$ 和 $E$ 的可测划分
% $\{B_1,\dots,B_m\}$ 使得 $f=\sum_{i=1}^m b_i 1_{B_i}$，
% 这种表示被称为简单函数 $f$ 的\emph{标准型}。

% 利用简单函数的标准型，很容易验证简单函数都是 $\mathcal{E}$-可测的。
% 反之，若 $f$ 是 $\mathcal{E}$-可测的，只有有限个取值且值为实数，那么
% $f$ 为简单函数。特别地，任意常值函数是简单函数。最后，如果 $f,g$
% 是简单函数，那么
% \[
%   f+g,\quad f-g,\quad fg,\quad f/g,\quad f\vee g,\quad f\wedge g  
% \]
% 都是简单函数，其中 $f/g$ 要求 $g$ 的值始终非零。

% \subsubsection{函数列的极限}

% 令 $(f_n)$ 是 $E$ 上的一列数值函数，我们可以逐点定义
% \begin{equation}\label{eq:inf and sup}
%   \inf f_n,\quad \sup f_n,\quad \liminf f_n,\quad \limsup f_n,
% \end{equation}
% 例如，$\inf f_n$ 将 $x\in E$ 送到实数列 $(f_n(x))$ 的下确界。
% 如果
% \[
%   \liminf f_n=\limsup f_n=f,
% \]
% 那么我们说 $(f_n)$ 有逐点极限 $f$，记为 $f=\lim f_n$ 或者 $f_n\to f$。

% 如果 $(f_n)$ 单调递增，即 $f_1\leq f_2\leq \cdots$，那么根据单调有界定理，$\lim f_n$
% 存在且等于 $\sup f_n$。此时我们用 $f_n\nearrow f$ 来表示 $(f_n)$ 单调递增且有极限 $f$。
% 类似地，用 $f_n\searrow f$ 来表示 $(f_n)$ 单调递减且有极限 $f$。

% 下面的定理表明可测函数类对极限操作是封闭的。
% \begin{theorem}\label{thm:lim of measurable function is measurable}
%   令 $(f_n)$ 是一列 $\mathcal{E}$-可测函数，那么 \eqref{eq:inf and sup} 中的四个函数都是
%   $\mathcal{E}$-可测的。此外，如果 $\lim f_n$ 存在，那么 $\lim f_n$ 也是 $\mathcal{E}$-可测的。
% \end{theorem}
% \begin{proof}
%   记 $g=\sup f_n$。任取 $r\in \mathbb{R}$，注意到 $g(x)\leq r$ 当且仅当对于所有 $n$ 有 $f_n(x)\leq r$。
%   所以
%   \[
%     g^{-1}[-\infty,r]=\bigcap_{n=1}^\infty f_n^{-1}[-\infty,r],
%   \]
%   $f_n$ 可测表明 $f_n^{-1}[-\infty,r]\in \mathcal{E}$，所以 $g^{-1}[-\infty,r]\in \mathcal{E}$，即
%   $g$ 可测。

%   对于 $\inf f_n$，我们有 $\inf f_n=-\sup (-f_n)$，所以 $\inf f_n$ 也可测。
%   最后，注意到
%   \[
%     \liminf f_n=\sup\limits_m \mathop{\vphantom{\sup}\inf}_{n\geq m} f_n,\quad
%     \limsup f_n=\mathop{\vphantom{\sup}\inf}_{m}\sup_{n\geq m} f_n,
%   \] 
%   所以 $\liminf f_n$ 和 $\limsup f_n$ 可测。若二者相等，那么 $\lim f_n$ 也可测。
% \end{proof}

% \subsubsection{可测函数的逼近}

% \begin{lemma}\label{lemma:dn}
%   对于 $n\in \mathbb{N}^*$，令
%   \[
%     d_n(r)=\sum_{k=1}^{n2^n}\frac{k-1}{2^n}1_{\left[\frac{k-1}{2^n},\frac{k}{2^n}\right)}(r)
%     +n1_{[n,\infty]}(r),\quad r\in \bar{\mathbb{R}}_+.
%   \]
%   那么，$d_n(r)$ 是 $\bar{\mathbb{R}}_+$ 上单调递增的简单函数，并且对于每个 $r\in\bar{\mathbb{R}}_+$，
%   $d_n(r)$ 随着 $n$ 的增大是的单调递增的。
% \end{lemma}
% \begin{proof}
%   显然 $d_n(r)$ 是单调递增的简单函数，我们证明任取 $r\in \bar{\mathbb{R}}_+$，$d_n(r)$
%   是单调递增的。若 $r=\infty$，那么 $d_n(r)=n$ 是单调递增的。现在假设 $r\in \mathbb{R}_+$，
%   那么存在正整数 $m$ 使得 $m\leq r<m+1$，所以当 $n\leq m$ 的时候，$d_n(r)=n$ 单调递增。
%   当 $n>m$ 的时候，直观来看，$d_n$ 将区间 $[0,n]$ 等分为 $n2^{n}$ 份，$r\in [0,n]$
%   表明一定存在唯一的 $k_n$ 使得 $(k_n-1)/2^n\leq r <k_n/2^n$，可以发现 $k_{n}$ 满足 
%   递推关系 $k_{n+1}=2k_n-1$ 或者 $k_{n+1}=2k_n$，这表明
%   \[
%     d_{n+1}(r)= \frac{k_{n+1}-1}{2^{n+1}}\geq\frac{2k_n-2}{2^{n+1}}=\frac{k_n-1}{2^n}=d_n(r).
%   \]
%   综上，$d_n(r)$ 随着 $n$ 的增大是的单调递增的。
% \end{proof}

% \begin{theorem}\label{thm:approximation of measurable function}
%   $E$ 上的非负函数是 $\mathcal{E}$-可测的当且仅当其是一列单调递增的非负简单函数序列
%   的极限。
% \end{theorem}
% \begin{proof}
%   充分性来源于 \autoref{thm:lim of measurable function is measurable}。
%   对于必要性，设 $f:E\to\bar{\mathbb{R}}_+$ 是 $\mathcal{E}$-可测的非负函数。
%   记 $d_n$ 为上述引理中的函数，令 $f_n=d_n\circ f$。那么 $f_n$ 是非负的 $\mathcal{E}$-可测函数，
%   并且其取值只有有限个，所以是简单函数。由于 $(d_n)$ 单调递增，所以 $(f_n)$ 单调递增。
%   对于任意 $x\in E$，由于 $f_n(x)=d_n(f(x))$，所以 $n\to\infty$ 的时候
%   $f_n(x)\to f(x)$，故 $f=\lim f_n$。
% \end{proof}

% \subsubsection{函数的单调类}

% 令 $\mathcal{M}$ 为 $E$ 上数值函数的一个集合，记 $\mathcal{M}_+$ 为 $\mathcal{M}$
% 中非负函数组成的子集，$\mathcal{M}_b$ 为 $\mathcal{M}$ 中有界函数组成的子集。

% 如果 $\mathcal{M}$ 包含常值函数 $1$，$\mathcal{M}_b$ 构成 $\mathbb{R}$ 上的向量空间
% 以及 $\mathcal{M}_+$ 在递增极限下封闭，那么我们说 $\mathcal{M}$ 是一个\emph{单调类}。
% 更准确地说，$\mathcal{M}$ 是单调类当且仅当：
% \begin{alphenum}
%   \item $1\in \mathcal{M}$，
%   \item 若 $f,g\in \mathcal{M}_b$ 且 $a,b\in \mathbb{R}$，则 $af+bg\in \mathcal{M}$，
%   \item 若 $(f_n)\subseteq \mathcal{M}_+$ 且 $f_n\nearrow f$，那么
%   $f\in \mathcal{M}$。
% \end{alphenum}

% 下面的定理通常被用于证明所有 $\mathcal{E}$-可测函数拥有的某一性质。

% \begin{theorem}
%   令 $\mathcal{M}$ 是 $E$ 上函数的单调类。假设对于某个生成 $\mathcal{E}$
%   的 p-系 $\mathcal{C}$，任取 $A\in \mathcal{C}$，有 $1_A\in \mathcal{M}$。那么，
%   $\mathcal{M}$ 包含所有的非负 $\mathcal{E}$-可测函数以及所有的有界 $\mathcal{E}$-可测函数。
% \end{theorem} 
% \begin{proof}
%   首先证明对于任意的 $A\in \mathcal{E}$ 有 $1_A\in \mathcal{M}$。记
%   \[
%     \mathcal{D}=\{A\in \mathcal{E}:1_A\in \mathcal{M}\}.
%   \]
%   由于 $1=1_E\in \mathcal{M}$，所以 $E\in \mathcal{D}$。任取 $A,B\in \mathcal{D}$ 且 $A\supseteq B$，
%   那么 $1_{A \smallsetminus B}=1_A-1_B\in \mathcal{M}$，这表明 $A \smallsetminus B\in \mathcal{D}$。
%   设 $(A_n)\subseteq \mathcal{D}$ 且 $A_n\nearrow A$，那么 $(1_{A_n})\subseteq \mathcal{M}_+$
%   且 $1_{A_n}\nearrow 1_A$，所以 $1_A\in \mathcal{M}$，这表明 $A\in \mathcal{D}$。
%   这表明 $\mathcal{D}$ 是 d-系。由于 $\mathcal{C}$ 是 p-系且 $\mathcal{C}\subseteq \mathcal{D}$，
%   根据单调类定理 \ref{thm:monotone class theorem}，$\mathcal{D}$ 包含 $\sigma \mathcal{C}=\mathcal{E}$，
%   所以对于任意的 $A\in \mathcal{E}$ 有 $A\in \mathcal{D}$，即 $1_A\in \mathcal{M}$。

%   再根据单调类的定义 (b)，$\mathcal{M}$ 包含所有的简单函数。

%   令 $f$ 是非负 $\mathcal{E}$-可测函数，根据 \autoref{thm:approximation of measurable function}，
%   $f$ 是函数序列 $(f_n)$ 的极限，其中 $f_n$ 是递增的非负简单函数，即 $(f_n)\subseteq \mathcal{M}_+$。
%   根据单调类的定义 (c)，有 $f\in \mathcal{M}$。

%   令 $g$ 是有界 $\mathcal{E}$-可测函数，那么 $g^+$ 和 $g^-$ 都是非负 $\mathcal{E}$-可测函数，所以
%   $g^+,g^-\in \mathcal{M}$。显然 $g^+,g^-$ 也都是有界的，根据单调类的定义 (b)，所以
%   $g=g^+-g^-\in \mathcal{M}$。
% \end{proof}

% \subsubsection{标准可测空间}

% 令 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$ 是可测空间。如果 $f:E\to F$ 是双射的
% 相对于 $\mathcal{E}$ 和 $\mathcal{F}$ 的可测函数，并且其逆映射 $f^{-1}:F\to E$
% 是相对于 $\mathcal{F}$ 和 $\mathcal{E}$ 的可测函数，那么我们说 $f$ 是\emph{同构}。

% 如果可测空间 $(E,\mathcal{E})$ 同构于 $(F,\mathcal{B}_F)$，其中 $F$ 是 $\mathbb{R}$
% 的某个 Borel 子集，那么我们说 $(E,\mathcal{E})$ 是\emph{标准可测空间}。
% 标准可测空间有非常多。如果 $E$ 是完备度量空间，那么 $(E,\mathcal{B}_E)$
% 是标准可测空间。如果 $E$ 是波兰空间，即可分的可完备度量化的拓扑空间，那么
% $(E,\mathcal{B}_E)$ 是标准可测空间。如果 $E$ 是可分的 Banach 空间，
% 那么 $(E,\mathcal{B}_E)$ 是标准可测空间。

% 显然，$[0,1]$ 和它的 Borel $\sigma$-代数构成标准可测空间。
% $\{1,2,\dots,n\}$ 和它的离散 $\sigma$-代数构成标准可测空间。
% $\mathbb{N}=\{0,1,2,\dots\}$ 和它的离散 $\sigma$-代数构成标准可测空间。
% 一个深刻的结果是，任意标准可测空间都同构于上述三者之一。


% \section{测度}

% 令 $(E,\mathcal{E})$ 是可测空间，$(E,\mathcal{E})$ 上的\emph{测度}
% 指的是一个映射 $\mu:\mathcal{E}\to\bar{\mathbb{R}}_+$，其满足：
% \begin{alphenum}
%   \item $\mu(\emptyset)=0$，
%   \item 对于不相交的子集列 $(A_n)\subseteq \mathcal{E}$，有 
%   $\mu(\bigcup_n A_n)=\sum_n \mu(A_n)$。
% \end{alphenum}
% 条件 (b) 被称为\emph{可列可加性}。需要注意 $\mu(A)$ 总是为正数且可以
% 为 $+\infty$。数 $\mu(A)$ 被称为 $A$ 的\emph{测度}，也简记为 $\mu A$。

% 一个\emph{测度空间}指的是三元组 $(E,\mathcal{E},\mu)$，其中 $(E,\mathcal{E})$
% 是可测空间，$\mu$ 是 $(E,\mathcal{E})$ 上的测度。

% \subsubsection{例子}

% \begin{example}[Dirac 测度]
%   令 $(E,\mathcal{E})$ 是可测空间，固定 $x\in E$。对于每个 $A\in \mathcal{E}$，
%   令
%   \[
%     \delta_x(A)=\begin{cases}
%       1 & x\in A,\\
%       0 & x\notin A.
%     \end{cases}  
%   \]
%   那么 $\delta_x$ 是 $(E,\mathcal{E})$ 上的测度，被称为\emph{Dirac 测度}。
%   直观来看，其基于一个集合 $A$ 是否含有特定元素 $x$ 来给出这个集合的“大小”。
% \end{example}

% \begin{example}[计数测度]
%   令 $(E,\mathcal{E})$ 是可测空间，固定 $D\subseteq E$。对于每个
%   $A\in \mathcal{E}$，令 $\nu(A)$ 是 $A\cap D$ 中点的个数，
%   此时 $\nu$ 是 $(E,\mathcal{E})$ 上的测度，被称为\emph{计数测度}。
%   通常，集合 $D$ 被选取为可数集，在这种情况下
%   \[
%     \nu(A)=\sum_{x\in D}\delta_x(A),\quad A\in \mathcal{E}.  
%   \]
% \end{example}

% \begin{example}[离散测度]
%   令 $(E,\mathcal{E})$ 是可测空间，固定可数子集 $D\subseteq E$。
%   对于每个 $x\in D$，分配一个正数 $m(x)$。定义
%   \[
%     \mu(A)=\sum_{x\in D} m(x)\delta_x(A),\quad A\in \mathcal{E}.  
%   \]
%   那么 $\mu$ 是 $(E,\mathcal{E})$ 上的测度，被称为\emph{离散测度}。
%   我们可能会把 $m(x)$ 理解为点 $x$ 的质量，那么 $\mu(A)$ 就是集合 $A$
%   的质量。特别地，如果 $(E,\mathcal{E})$ 是离散可测空间，那么
%   每个测度 $\mu$ 都有这种形式。
% \end{example}

% \begin{example}[Lebesgue 测度]
%   $(\mathbb{R},\mathcal{B}_{\mathbb{R}})$ 上的测度 $\mu$ 如果对于每个
%   区间 $A$ 都满足 $\mu(A)$ 为 $A$ 的长度，那么我们说 $\mu$ 是\emph{Lebesgue 测度}。
%   类似地，$\mathbb{R}^2$ 上的 Lebesgue 测度是“面积”测度，
%   $\mathbb{R}^3$ 上的 Lebesgue 测度是“体积”测度等等。
%   我们将它们记作 $\Leb$。
% \end{example}

% \subsubsection{测度的性质}

% \begin{proposition}
%   令 $\mu$ 是可测空间 $(E,\mathcal{E})$ 上的测度，那么对于任意
%   可测集 $A,B$ 和 $A_1,A_2,\dots$，有：
%   \begin{description}[nosep,font=\sffamily\mdseries,itemindent=0pt]
%     \item[有限可加性] $A\cap B=\emptyset\Rightarrow \mu(A\cup B)=\mu(A)+\mu(B)$。
%     \item[单调性] $A\subseteq B\Rightarrow \mu(A)\leq \mu(B)$。
%     \item[连续性] $A_n\nearrow A\Rightarrow \mu(A_n)\nearrow \mu(A)$。
%     \item[Boole 不等式]  $\mu(\bigcup_n A_n)\leq \sum_n \mu(A_n)$。  
%   \end{description}
% \end{proposition}
% \begin{proof}
%   有限可加性是可列可加性的特殊情况，取 $A_1=A,A_2=B,A_3=A_4=\cdots=\emptyset$
%   即可。若 $A\subseteq B$，由于 $\mathcal{E}$ 是 d-系，所以 $B \smallsetminus A\in \mathcal{E}$，
%   所以
%   \[
%     \mu(B)=\mu(A\cup(B \smallsetminus A))= \mu(A)+\mu(B \smallsetminus A)
%     \geq \mu(A).
%   \]
%   若 $A_n\nearrow A$，令 $B_1=A_1$，$B_n=A_{n}\smallsetminus A_{n-1}$，那么
%   $B_n$ 互不相交且 $\bigcup_{k=1}^n B_k=A_n$，所以
%   \[
%     \lim \mu(A_n)=\lim\mu\left(\bigcup_{k=1}^n B_k\right)  
%     =\lim \sum_{k=1}^n \mu(B_k)=\sum_{k=1}^\infty \mu(B_k)
%     =\mu(A).
%   \]
%   对于 Boole 不等式，注意到
%   \[
%     \mu(A\cup B)=\mu(A\cup (B \smallsetminus A))=\mu(A)+\mu(B \smallsetminus A) 
%     \leq \mu(A)+\mu (B), 
%   \]
%   所以归纳可得
%   \[
%     \mu\left(\bigcup_{k=1}^n A_k\right)\leq \sum_{k=1}^n\mu(A_k),  
%   \]
%   令 $n\to\infty$，左边根据连续性即可得到 Boole 不等式。
% \end{proof}

% \subsubsection{有限测度}

% 令 $\mu$ 是可测空间 $(E,\mathcal{E})$ 上的测度，如果 $\mu(E)<\infty$，
% 那么 $\mu$ 被称为\emph{有限测度}，根据单调性，此时对于任意 $A\in \mathcal{E}$，
% 都有 $\mu(A)<\infty$。如果 $\mu(E)=1$，那么 $\mu$ 被称为\emph{概率测度}。
% 如果存在 $E$ 的可测划分 $(E_n)$ 使得 $\mu(E_n)<\infty$，那么
% $\mu$ 被称为\emph{$\sigma$-有限测度}。如果存在一列有限测度 $\mu_n$
% 使得 $\mu=\sum_n \mu_n$，那么 $\mu$ 被称为\emph{$\Sigma$-有限测度}。
% 有限测度都是 $\sigma$-有限的，$\sigma$-有限测度都是 $\Sigma$-有限的。

% \begin{proposition}
%   令 $(E,\mathcal{E})$ 是可测空间，$\mu,\nu$ 是两个有限测度且 $\mu(E)=\nu(E)$，如果
%   $\mu,\nu$ 在生成 $\mathcal{E}$ 的某个 p-系上取值相同，那么
%   $\mu=\nu$。
% \end{proposition}
% \begin{proof}
%   设 $\mathcal{C}$ 是 p-系且 $\mathcal{E}=\sigma \mathcal{C}$，
%   任取 $A\in \mathcal{C}$ 有 $\mu(A)=\nu(A)$。令
%   \[
%     \mathcal{D}=\{A\in \mathcal{E}:\mu(A)=\nu(A)\},  
%   \]
%   那么 $\mathcal{C}\subseteq \mathcal{D}$。如果我们证明 $\mathcal{D}$
%   是 d-系，那么根据单调类定理，就有 $\mathcal{E}=\sigma \mathcal{C}\subseteq \mathcal{D}$，
%   即任取 $A\in \mathcal{E}$ 有 $\mu(A)=\nu(A)$。下面我们证明 $\mathcal{D}$
%   是 d-系。由于 $\mu(E)=\nu(E)$，所以 $E\in \mathcal{D}$。
%   若 $A,B\in \mathcal{D}$ 且 $A\supseteq B$，那么
%   \[
%     \mu(B)+\mu(A \smallsetminus B)= \mu(A)=\nu(A)=\nu(B)+\mu(A \smallsetminus B),
%   \]
%   由于 $\mu(B)=\nu(B)$，所以 $\mu(A \smallsetminus B)=\nu (A \smallsetminus B)$，
%   即 $A \smallsetminus B\in \mathcal{D}$。
%   任取 $(A_n)\subseteq \mathcal{D}$ 且 $A_n\nearrow A$，根据连续性，所以
%   $\mu(A_n)\nearrow \mu(A)$ 以及 $\nu(A_n)\nearrow \nu(A)$，所以
%   \[
%     \mu(A)=\lim \mu(A_n)=\lim \nu(A_n)=\nu(A),  
%   \]
%   所以 $A\in \mathcal{D}$。这就证明了 $\mathcal{D}$ 是 d-系。
% \end{proof}

% \begin{corollary}
%   令 $\mu,\nu$ 是 $\left(\bar{\mathbb{R}},\mathcal{B}\left(\bar{\mathbb{R}}\right)\right)$
%   上的概率测度，那么 $\mu=\nu$ 当且仅当对于任意的 $r\in \mathbb{R}$ 有
%   $\mu[-\infty,r]=\nu[-\infty, r]$。
% \end{corollary}

% \subsubsection{原子，纯原子测度和非原子测度}

% 令 $(E,\mathcal{E})$ 是可测空间，假设对于每个 $x\in E$，单点集 $\{x\}\in \mathcal{E}$，
% 这一点对于所有的标准可测空间都是成立的。令 $\mu$ 是 $(E,\mathcal{E})$ 上的测度，
% 如果点 $x$ 使得 $\mu\{x\}>0$，那么 $x$ 被称为 $\mu$ 的一个\emph{原子}。如果 $\mu$
% 没有任何原子，那么 $\mu$ 被称为\emph{非原子测度}。如果 $\mu$ 的原子的集合 $D$
% 是可数集并且 $\mu(E \smallsetminus D)=0$，那么 $\mu$ 被称为\emph{纯原子测度}。
% 例如，Lebesgue 测度是非原子测度，Dirac 测度是纯原子测度(其只有一个原子)，离散测度
% 是纯原子测度。

% \begin{proposition}
%   令 $\mu$ 是 $(E,\mathcal{E})$ 上的 $\Sigma$-有限测度，那么
%   \[
%     \mu=\lambda+\nu,
%   \]
%   其中 $\lambda$ 是非原子测度，$\nu$ 是纯原子测度。
% \end{proposition}


% \subsubsection{完备性，零测集}

% 令 $(E,\mathcal{E},\mu)$ 是测度空间，如果可测集 $B$ 使得 $\mu(B)=0$，那么 $B$
% 被称为\emph{零测集}。$E$ 的任意子集如果被一个可测的零测集包含，那么也被称为\emph{零测集}。
% 如果 $E$ 的每个零测集都是可测集，那么我们说这个测度空间是\emph{完备的}。对于不完备的
% 测度空间，下面的结果表明可以通过包含所有的零测集来扩大 $\mathcal{E}$ 以及
% $\mu$ 来得到一个完备测度空间。测度空间 $(E,\bar{\mathcal{E}},\bar\mu)$ 被称为
% $(E,\mathcal{E},\mu)$ 的\emph{完备化}。当 $E=\mathbb{R}$，$\mathcal{E}=\mathcal{B}_{\mathbb{R}}$
% 和 $\mu=\Leb$ 的时候，$\bar{\mathcal{E}}$ 的元素被称为\emph{Lebesgue 可测集}。

% \begin{proposition}
%   令 $\mathcal{N}$ 是 $E$ 的所有零测子集的集合族，$\bar{\mathcal{E}}$ 为 $\mathcal{E}\cup \mathcal{N}$
%   生成的 $\sigma$-代数，那么
%   \begin{alphenum}[nosep]
%     \item 每个 $B\in\bar{\mathcal{E}}$ 都形如 $B=A\cup N$，其中 $A\in \mathcal{E}$ 以及 $N\in \mathcal{N}$，
%     \item 定义 $\bar\mu(A\cup N)=\mu(A)$，这给出了 $\bar{\mathcal{E}}$ 上的测度 $\bar\mu$，并且
%     是唯一的满足 $\bar\mu(A)=\mu(A)\ (A\in \mathcal{E})$ 的测度，此时测度空间 $(E,\mathcal{E},\mu)$
%     是完备的。
%   \end{alphenum}
% \end{proposition}

% \begin{exercise}{限制和迹}{}
%   令 $(E,\mathcal{E})$ 是可测空间，$\mu$ 是测度。令 $D\in \mathcal{E}$。
%   \begin{alphenum}[nosep]
%     \item 定义 $\nu(A)=\mu(A\cap D)$，证明 $\nu$ 是 $(E,\mathcal{E})$ 上的测度，
%     被称为 $\mu$ 在 $D$ 上的迹。
%     \item 令 $\mathcal{D}$ 为 $\mathcal{E}$ 在 $D$ 上的迹，对于 $A\in \mathcal{D}$，
%     定义 $\nu(A)=\mu(A)$，证明 $\nu$ 是 $(D,\mathcal{D})$ 上的测度，被称为
%     $\mu$ 在 $D$ 上的限制。
%   \end{alphenum}
% \end{exercise}
% \begin{proof}
%   (a) $\nu(\emptyset)=\mu(\emptyset)=0$。设 $(A_n)\subseteq \mathcal{E}$ 是不相交
%   的子集列，那么 $(A_n\cap D)\subseteq \mathcal{E}$ 仍然不相交，所以
%   \[
%     \nu\left(\bigcup_{n=1}^\infty A_n\right)=\mu\left(\bigcup_{n=1}^\infty (A_n\cap D)\right)
%     =\sum_{n=1}^\infty \mu(A_n\cap D)=\sum_{n=1}^\infty \nu(A_n),
%   \]
%   即 $\nu$ 是 $(E,\mathcal{E})$ 上的测度。

%   (b) $\nu(\emptyset)=\mu(\emptyset)=0$。设 $(A_n)\subseteq \mathcal{D}$
%   是不相交的子集列，于是
%   \[
%     \nu\left(\bigcup_{n=1}^\infty A_n\right)=\mu\left(\bigcup_{n=1}^\infty A_n\right)
%     =\sum_{n=1}^\infty\mu(A_n)=\sum_{n=1}^\infty\nu(A_n).\qedhere
%   \]
% \end{proof}

% \section{积分}

% 令 $(E,\mathcal{E},\mu)$ 是测度空间。我们同时用 $\mathcal{E}$ 表示
% $E$ 上的 $\mathcal{E}$-可测函数的集合，$\mathcal{E}_+$ 表示非负
% $\mathcal{E}$-可测函数构成的子集。下面对于所有合理的 $f\in \mathcal{E}$，
% 我们定义“$f$ 相对于 $\mu$ 的积分”，我们将记为：
% \[
%   \mu f=\mu(f)=\int_E f(x) \mu(\d x)  =\int_E f \d\mu.
% \]
% 并且我们将证明我们定义的积分蕴含下面的性质：对于任意 $a,b\in \mathbb{R}_+$
% 和 $f,g,f_n\in \mathcal{E}_+$，有：
% \begin{description}[nosep,font=\sffamily\mdseries,itemindent=0pt]
%   \item[非负性] $\mu f\geq 0$，若 $f=0$，则 $\mu f=0$。
%   \item[线性性] $\mu(af+bg)=a\mu f+b\mu g$。
%   \item[单调收敛定理] 若 $f_n\nearrow f$，则 $\mu f_n\nearrow \mu f$。  
% \end{description}

% \begin{definition}
%   我们从简单函数开始逐步定义积分的概念。
%   \begin{alphenum}
%     \item 令 $f$ 是简单非负函数，设其标准型为 $f=\sum_i a_i 1_{A_i}$，
%     定义
%     \[
%       \mu f=\sum_{i=1}^n a_i\mu(A_i).  
%     \]
%     \item 令 $f\in \mathcal{E}_+$，记 $f_n=d_n\circ f$，其中 $d_n$
%     为 \autoref{lemma:dn} 中的简单函数，那么每个 $f_n$ 是简单非负函数。
%     此时 $\mu f_n$ 是单调递增的，于是我们定义
%     \[
%       \mu f=\lim \mu f_n.  
%     \]
%     \item 令 $f\in \mathcal{E}$，那么 $f^+,f^-\in \mathcal{E}_+$。
%     由于 $f=f^+-f^-$，于是我们定义
%     \[
%       \mu f=\mu(f^+)-\mu (f^-).  
%     \]
%     上述定义中我们要求等式右端至少有一项是有限的。
%   \end{alphenum}
% \end{definition}
% \begin{remark}
%   令 $f,g$ 是简单非负函数。
%   \begin{alphenum}
%     \item 设 $f=\sum_i a_i 1_{A_i}$，这里我们不要求是标准型。若 $\bigcup_i A_i\neq E$，
%     那么我们可以添加零项，所以我们假设 $\bigcup_i A_i=E$。若 $A_i\cap A_j\neq \emptyset$，
%     那么
%     \[
%       a_i1_{A_i}+a_j1_{A_j}=
%       a_i1_{A_i \smallsetminus (A_i\cap A_j)}+(a_i+a_j)1_{A_i\cap A_j}+a_j 1_{A_j \smallsetminus (A_i\cap A_j)},
%     \]
%     于是这两项的积分为
%     \begin{align*}
%       &a_i\mu(A_i \smallsetminus (A_i\cap A_j))+(a_i+a_j)\mu(A_i\cap A_j)+
%       a_j\mu(A_j \smallsetminus (A_i\cap A_j))\\
%       ={}& a_i\mu(A_i)-a_i\mu(A_i\cap A_j)+(a_i+a_j)\mu(A_i\cap A_j)+a_j\mu(A_j)
%       -a_j\mu(A_i\cap A_j)\\
%       ={}& a_i\mu(A_i)+a_j\mu(A_j),
%     \end{align*}
%     所以对于简单函数的非标准形式而言，其积分依然形如 $\mu f=\sum_i a_i\mu(A_i)$。
%     \item 若 $a,b\in \mathbb{R}_+$，那么 $af+bg$ 依然是简单非负函数，再根据
%     (a)，就有
%     \[
%       \mu(af+bg)=a\mu f+b\mu g.  
%     \]
%     \item 如果 $f\leq g$，那么
%     \[
%       \mu f\leq \mu f+\mu(g-f)=\mu(f+g-f)=\mu g.
%     \]
%     \item 若 $f_1\leq f_2\leq\cdots$，根据 (c)，有 $\mu f_1\leq\mu f_2\leq \cdots$，
%     所以定义中的 $\lim \mu f_n$ 存在(可以为 $+\infty$)。
%   \end{alphenum}
% \end{remark}

% \subsubsection{示例}

% \begin{example}[离散测度]
%   固定 $x_0\in E$，考虑 Dirac 测度 $\delta_{x_0}$。任取 $f\in \mathcal{E}_+$，
%   所以
%   \[
%     \delta_{x_0}f=\lim \delta_{x_0}(d_n\circ f)=  f(x_0).
%   \]
%   那么对于任意 $f\in \mathcal{E}$，就有
%   \[
%     \delta_{x_0}f=\delta_{x_0}(f^+)-\delta_{x_0}(f^-)=f(x_0).  
%   \]
%   设 $\mu=\sum_{x\in D} m(x)\delta_x$ 是离散测度，其中 $D\in \mathcal{E}$ 是可数集，
%   $m(x)> 0$，那么
%   \[
%     \mu f=\sum_{x\in D}m(x) f(x).  
%   \]
% \end{example}

% \begin{example}[离散空间]
%   设 $(E,\mathcal{E})$ 是离散可测空间，即 $E$ 可数且 $\mathcal{E}=2^E$。此时
%   $E$ 上的任意数值函数都是 $\mathcal{E}$-可测的，且 $E$ 上的任意测度 $\mu$ 都满足
%   $\mu=\sum_{x\in E}\mu\{x\}\delta_x$，所以对于任意 $E$ 上的函数 $f$，有
%   \[
%     \mu f=\sum_{x\in E}\mu\{x\} f(x).
%   \]
% \end{example}

% \begin{example}[Lebesgue 积分]
%   设 $E$ 是 $\mathbb{R}^d$ 的 Borel 子集，$\mathcal{E}=\mathcal{B}(E)$。
%   设 $\mu$ 是 Lebesgue 测度在 $(E,\mathcal{E})$ 上的限制，对于 $f\in \mathcal{E}$，
%   我们使用下面的记号表示积分 $\mu f$：
%   \[
%     \mu f=\Leb_E f=\int_E f(x)\Leb(\d x)=\int_E f(x)\d x.  
%   \]
% \end{example}

% \subsubsection{可积性}

% 对于一个函数 $f\in \mathcal{E}$，如果 $\mu f$ 存在且为实数，
% 那么 $f$ 被称为\emph{可积的}。也就是说，$f$ 可积当且仅当 
% $\mu f^+<\infty$ 以及 $\mu f^-<\infty$。

% \subsubsection{在可测集上的积分}

% 令 $f\in \mathcal{E}$，$A$ 是可测集，那么 $f1_A\in \mathcal{E}$，
% 此时我们把 $f$ 在 $A$ 上的积分定义为 $f1_A$ 的积分，使用下面的记号：
% \[
%   \mu(f1_A)=\int_A f(x)\mu(\d x)=\int_A f \d\mu.  
% \]

% \begin{lemma}
%   令 $f\in \mathcal{E}_+$，$A,B\in \mathcal{E}$ 不相交且 $C=A\cup B$，
%   那么
%   \[
%     \mu(f1_A)+\mu(f1_B)=\mu(f1_C).  
%   \]
%   对于一般的 $f\in \mathcal{E}$ 也成立。
% \end{lemma}
% \begin{proof}
%   令 $f_n=d_n\circ f$，由于 $f_n$ 是简单函数，所以
%   \[
%     \mu(f_n1_A)+\mu(f_n1_B)=\mu(f_n1_C),  
%   \]
%   注意到 $f_n1_A=d_n\circ(f1_A)$，对 $B,C$ 同理。令 $n\to\infty$ 即得结论。
% \end{proof}

% \subsubsection{非负性和单调性}

% \begin{proposition}
%   若 $f\in \mathcal{E}_+$，那么 $\mu f\geq 0$。如果 $f,g\in \mathcal{E}_+$
%   且 $f\leq g$，那么 $\mu f\leq \mu g$。
% \end{proposition}
% \begin{proof}
%   $f\in \mathcal{E}_+$ 表明 $f_n\geq 0$，从而 $\mu f_n\geq 0$，
%   所以 $\mu f=\lim\mu f_n\geq 0$。如果 $f\leq g$，由于 $d_n$ 是单调递增函数，
%   所以 $f_n\leq g_n$，所以 $\mu f_n\leq \mu g_n$，所以 $\mu f\leq \mu g$。
% \end{proof}
% \begin{corollary}
%   若 $f,g\in \mathcal{E}$ 且 $f\leq g$，那么 $\mu f\leq \mu g$.
% \end{corollary}
% \begin{proof}
%   $f\leq g$ 表明 $f^+\leq g^+$ 以及 $f^-\geq g^-$，所以
%   $\mu f=\mu(f^+)-\mu(f^-)\leq \mu(g^+)-\mu (g^-)\leq \mu g$。
% \end{proof}

% \subsubsection{单调收敛定理}

% 该定理是交换积分和极限次序的关键工具。该定理表明映射
% \[
%   \mathcal{E}_+\to\bar{\mathbb{R}}_+,\quad f\mapsto \mu f  
% \]
% 在递增极限下是连续的。

% \begin{theorem}
%   令 $(f_n)$ 是 $\mathcal{E}_+$ 中的递增序列，那么
%   \[
%     \mu(\lim f_n)=\lim\mu f_n.  
%   \]
% \end{theorem}
% \begin{proof}
%   令 $f=\lim f_n\in \mathcal{E}_+$，由于 $f_n\leq f$，根据单调性，有
%   $\mu f_n\leq \mu f$，故
%   \[
%     \lim \mu f_n\leq \mu f.  
%   \]

%   任取满足 $0\leq s\leq f$ 的非负简单函数 $s$，给定 $0<\alpha <1$，
%   定义
%   \[
%     A_n=\{x\in E:f_n(x)\geq \alpha s(x)\},
%   \]
%   那么 $A_n=(f_n-\alpha s)^{-1}[0,\infty]\in \mathcal{E}$。不难验证
%   $A_n\subseteq A_{n+1}$。对于任意 $x\in E$，由于 $f_n\nearrow f$
%   且 $f(x)\geq s(x)$，所以总存在足够大的 $n$ 使得 $f_n(x)\geq s(x)>\alpha s(x)$，
%   即 $x\in A_n$，所以 $A_n\nearrow E$。定义 $(E,\mathcal{E})$ 上的测度
%   $\nu$ 为
%   \[
%     \nu(A)=\mu(s1_A)=\int_A s\d \mu,  
%   \]
%   不难验证这确实是一个测度。此时我们有
%   \[
%     \mu f_n\geq \mu(f_n1_{A_n})\geq \mu(\alpha s1_{A_n})=\alpha\mu(s1_{A_n})
%     =\alpha\nu(A_n),  
%   \]
%   令 $n\to\infty$，由于 $A_n\nearrow E$，所以 $\nu(A_n)\nearrow \nu(E)=\mu s$，
%   所以
%   \[
%     \lim \mu f_n\geq \alpha\mu s.  
%   \]
%   特别地，取 $s=d_k\circ f$，有 $\lim \mu f_n\geq \alpha\mu(d_k\circ f)$，
%   令 $k\to\infty$，所以 $\lim \mu f_n\geq \alpha\mu f$。再取
%   $\alpha=1-1/k$，令 $k\to\infty$，即得
%   \[
%     \lim\mu f_n\geq \mu f.  \qedhere
%   \]
% \end{proof}

% \subsubsection{积分的线性性}

% \begin{proposition}
%   对于 $f,g\in \mathcal{E}_+$ 和 $a,b\in \mathbb{R}_+$，有
%   \[
%     \mu(af+bg)=a\mu f+b\mu g.  
%   \]
%   对于 $f,g\in \mathcal{E}$ 和 $a,b\in \mathbb{R}$ 也是正确的。
% \end{proposition}
% \begin{proof}
%   已知对于简单函数 $f_n=d_n\circ f$ 和 $g_n=d_n\circ g$，有
%   \[
%     \mu(af_n+bg_n)=a\mu f_n+b\mu g_n,  
%   \]
%   而 $f_n\nearrow f$，$g_n\nearrow g$，根据单调收敛定理，就有
%   \[
%     \mu(af+bg)=a\mu f+b\mu g.  
%   \]
%   对于一般的 $f,g$，只需将其拆为正部分和负部分即可验证。
% \end{proof}

% \subsubsection{积分的不敏感性}

% \begin{proposition}
%   如果 $A\in \mathcal{E}$ 是零测集，那么对于任意 $f\in \mathcal{E}$，有 $\mu(f1_A)=0$。
%   如果 $f,g\in \mathcal{E}$ 且几乎处处有 $f=g$，那么 $\mu f=\mu g$。
%   如果 $f\in \mathcal{E}_+$ 并且 $\mu f=0$，那么几乎处处 $f=0$。
% \end{proposition}
% \begin{proof}
%   先假设 $f$ 是简单非负函数，其标准型为 $f=\sum_i a_i 1_{A_i}$，那么
%   \[
%     f1_A=\sum_{i=1}^n a_i 1_{A_i\cap A},
%   \]
%   所以 $\mu(f1_A)=\sum_i a_i\mu(A_i\cap A)$。根据单调性有 $\mu(A_i\cap A)\leq \mu(A)=0$，
%   所以 $\mu(f1_A)=0$。然后假设 $f\in \mathcal{E}_+$，那么 $\mu((d_n\circ f)1_A)=0$，所以
%   $\mu(f1_A)=0$。最后，设 $f\in \mathcal{E}_+$，那么 $\mu(f1_A)=\mu(f^+1_A)-\mu (f^-1_A)=0$。

%   记 $A=\{x\in E:f(x)\neq g(x)\}$，那么 $A=E \smallsetminus(f-g)^{-1}(0)$ 可测，
%   几乎处处 $f=g$ 表明 $A$ 是零测集。于是 $\mu(f1_A)=\mu(g1_A)=0$，所以
%   \begin{align*}
%     \mu f&=\mu(f1_A)+\mu(f1_{E \smallsetminus A})=\mu(f1_{E \smallsetminus A})
%     =
%     \mu(g1_{E \smallsetminus A})\\&=\mu(g1_{E \smallsetminus A})+\mu(g1_A)=\mu g.
%   \end{align*}

%   记 $N=\{x\in E: f(x)>0\}$，$N_k=\{x\in E:f(x)>1/k\}$，显然 $N_k\nearrow N$，故
%   $\mu(N_k)\nearrow \mu(N)$。此时 $f> 1/k1_{N_k}$，所以 $0=\mu f\geq 1/k\mu(N_k)$，
%   这表明 $\mu(N_k)=0$，所以 $\mu(N)=\lim\mu(N_k)=0$。
% \end{proof}


% \subsubsection{Fatou 引理}

% \begin{lemma}
%   令 $(f_n)\subseteq \mathcal{E}_+$，那么 $\mu(\liminf f_n)\leq \liminf\mu f_n$。
% \end{lemma}
% \begin{proof}
%   记 $g_m=\inf_{n\geq m}f_n$，那么 $g_m\in \mathcal{E}_+$ 且递增，根据单调收敛定理，有
%   \[
%     \mu(\liminf f_n)=\mu(\lim g_m)=\lim\mu g_m.
%   \]
%   又因为 $n\geq m$ 的时候 $g_m\leq f_n$，所以 $\mu g_m\leq \mu f_n$，所以
%   $\mu g_m\leq \inf_{n\geq m} \mu f_n$，令 $m\to\infty$，即得
%   \[
%     \mu(\liminf f_n)=\lim\mu g_m\leq \liminf \mu f_n.\qedhere
%   \]
% \end{proof}

% \begin{corollary}
%   令 $(f_n)\subseteq \mathcal{E}$，如果存在可积函数 $g$ 使得 $f_n\geq g$，那么
%   \[
%     \mu(\liminf f_n)\leq\liminf \mu f_n.
%   \]
%   如果存在可积函数 $g$ 使得 $f_n\leq g$，那么
%   \[
%     \mu(\limsup f_n)\geq \limsup \mu f_n.
%   \]
% \end{corollary}
% \begin{proof}
%   若可积函数 $g$ 使得 $f_n\geq g$，那么 $A=\{x\in E:g(x)\in \mathbb{R}\}$ 的补集是零测集(练习)。
%   那么几乎处处 $f_n1_A=f_n$ 以及 $g1_A=g$。由于 $g1_A$ 是实值函数，所以
%   $f_n1_A-g1_A$ 是有意义的，故 $f_n1_A-g1_A\in \mathcal{E}_+$ 且可积，根据 Fatou 引理，有
%   \begin{align*}
%     \mu\bigl(\liminf (f_n1_A)\bigr)-\mu(g1_A)&=\mu\bigl(\liminf (f_n1_A)- g1_A\bigr)
%     =\mu\bigl(\liminf (f_n1_A-g1_A)\bigr)\\
%     &\leq \liminf\mu(f_n1_A-g1_A)=\liminf \mu(f_n1_A)-\mu(g1_A),
%   \end{align*}
%   由于几乎处处 $f_n1_A=f_n$，故几乎处处 $\liminf (f_n1_A)=\liminf f_n$，
%   故 $\mu(f_n1_A)=\mu f_n$ 以及 $\mu\bigl(\liminf (f_n1_A)\bigr)=\mu(\liminf f_n)$，这就表明
%   \[
%     \mu(\liminf f_n)\leq\liminf \mu f_n.
%   \]
%   对于第二点，考虑 $g1_A-f_n1_A\in \mathcal{E}_+$ 并且 $\limsup r_n=-\liminf(-r_n)$ 即可。
% \end{proof}


\part{测度论}

\chapter{可测空间}

\section{可测集}

\begin{definition}
  集合 $E$ 上的 $\sigma$-域 $\mathcal{A}$ 指的是 $E$ 的一个子集族，
  其满足下面的性质：
  \begin{enumerate}
    \item $E\in \mathcal{A}$；
    \item $A\in \mathcal{A}\Rightarrow A^c\in \mathcal{A}$；
    \item 如果一列子集 $A_n\in \mathcal{A}$，那么
    $\bigcup_{n\in \mathbb{N}} A_n\in \mathcal{A}$。
  \end{enumerate}
\end{definition}

$\mathcal A$ 的元素被称为\emph{可测集}，$(E,\mathcal{A})$ 被称为\emph{可测空间}。
根据定义，我们很容易得出下面的结果：
\begin{itemize}[nosep]
  \item $\emptyset=E^c\in \mathcal{A}$。
  \item 如果一列子集 $A_n\in \mathcal{A}$，那么
  \[
    \bigcap_{n\in \mathbb{N}}A_n=\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr) ^c\in \mathcal{A}.
  \]
  \item $\mathcal{A}$ 对有限并和有限交也是封闭的，只需要从某一项 $A_n$ 开始
  全部取空集即可。
\end{itemize}

\begin{example}
  根据可测集的定义，很容易构造出一些最简单的例子：
  \begin{enumerate}
    \item $\mathcal{A}=\mathcal{P}(E)$，当 $E$ 是有限集或者可数集的时候
    我们通常会使用这样的 $\sigma$-域，其他情况则很少使用。
    \item $\mathcal{A}=\{\emptyset,E\}$，平凡 $\sigma$-域。
    \item $E$ 的所有至多可数的子集以及所有补集至多可数的子集构成
    $E$ 上的一个 $\sigma$-域。
  \end{enumerate}
\end{example}

为了产生更多的例子，我们注意到 $E$ 上任意 $\sigma$-域的交集仍然是
$\sigma$-域，这导出了下面的定义。

\begin{definition}
  令 $\mathcal{C}$ 是 $\mathcal{P}(E)$ 的子集，$E$ 上包含 $\mathcal{C}$
  的最小的 $\sigma$-域被记为 $\sigma(\mathcal{C})$，不难看出其是所有包含 $\mathcal{C}$
  的 $\sigma$-域的交集。我们称 $\sigma(\mathcal{C})$ 是由 $\mathcal{C}$ 生成的
  $\sigma$-域。
\end{definition}

\begin{definition}
  设 $(E,\mathcal{O})$ 是拓扑空间，所有开集 $\mathcal{O}$ 生成的 $\sigma$-域
  $\sigma(\mathcal{O})$ 被称为 $E$ 上的 Borel $\sigma$-域，记为 $\mathcal{B}(E)$。
\end{definition}

$E$ 上的 Borel $\sigma$-域是包含所有开集的最小的 $\sigma$-域。
$\mathcal{B}(E)$ 的元素被称为 $E$ 的\emph{Borel 子集}。显然，
$E$ 中的闭集也都是 Borel 子集。

\begin{example}[$\mathbb{R}$ 上的 Borel $\sigma$-域]
  记 $\mathcal{C}_1$ 为 $\mathbb{R}$ 中开区间的集合：
  \[
    \mathcal{C}_1=\{(a,b)\,|\, a,b\in \mathbb{R},a<b\}  ,
  \]
  显然有 $\mathcal{C}_1\subseteq \mathcal{B}(\mathbb{R})$，于是
  $\sigma(\mathcal{C}_1)\subseteq \mathcal{B}(\mathbb{R})$。
  下面我们说明 $\mathcal{B}(\mathbb{R})\subseteq \sigma(\mathcal{C}_1)$。
  我们不加证明地使用一个结论(Lindel\"of 定理)：$\mathbb{R}$ 的任意开子集 $U$ 都是开区间的可数并。
  那么根据 $\sigma$-域的定义，任意开区间都在 $\sigma(\mathcal{C}_1)$ 中，
  故 $\mathcal{B}(\mathbb{R})\subseteq \sigma(\mathcal{C}_1)$。
  这表明 $\mathcal{B}(\mathbb{R})$ 可以由所有开区间生成。

  此外，如果注意到
  \[
    (a,b)=(-\infty,b)\cap (-\infty,a)^c,  
  \]
  还可以证明 $\mathcal{B}(\mathbb{R})$ 由 $\mathcal{C}_2$ 生成，其中
  \[
    \mathcal{C}_2=\{(-\infty,a)\,|\, a\in \mathbb{R}\}.
  \]
  最后，不难证明这里的开区间都可以换成闭区间。
\end{example}

在后文中，每当我们考虑拓扑空间(例如 $\mathbb{R}$ 或者 $\mathbb{R}^d$)时，
除非有特别说明，否则我们总是假设它们配备 Borel $\sigma$-域。

下一个非常重要的 $\sigma$-域是乘积 $\sigma$-域。

\begin{definition}
  令 $(E_1,\mathcal{A}_1)$ 和 $(E_2,\mathcal{A}_2)$ 是可测空间，定义
  $E_1\times E_2$ 上的 $\sigma$-域 $\mathcal{A}_1\otimes \mathcal{A}_2$ 为
  \[
    \mathcal{A}_1\otimes \mathcal{A}_2=\sigma\bigl(\{A_1\times A_2\,|\, A_1\in \mathcal{A}_1,A_2\in \mathcal{A}_2\}\bigr).
  \]
\end{definition}

\begin{lemma}
  设 $E$ 和 $F$ 是可分(有可数的稠密子集)的拓扑空间，$E\times F$ 配备积拓扑，那么
  $\mathcal{B}(E\times F)=\mathcal{B}(E)\otimes \mathcal{B}(F)$。
\end{lemma}


\section{正测度}

令 $(E,\mathcal{A})$ 是可测空间。

\begin{definition}
  $(E,\mathcal{A})$ 上的正测度指的是一个映射 $\mu:\mathcal{A}\to [0,\infty]$，
  其满足下面的性质：
  \begin{enumerate}
    \item $\mu(\emptyset)=0$；
    \item ($\sigma$-可加性) 对于任意可数个不相交的可测集序列 $(A_n)_{n\in \mathbb{N}}$，有
    \[
      \mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr) =\sum_{n\in \mathbb{N}}\mu(A_n).
    \]
  \end{enumerate}
  此时，三元组 $(E,\mathcal{A},\mu)$ 被称为\emph{测度空间}。
  值 $\mu(E)$ 被称为测度 $\mu$ 的总质量。
\end{definition}

需要注意的是，我们允许 $\mu$ 的值为 $+\infty$，此时级数
$\sum_{n\in \mathbb{N}}\mu(A_n)$ 作为正向级数在 $[0,\infty]$
中总是有意义的。
根据 $\sigma$-可加性，如果我们令 $n>n_0$ 开始 $A_n=\emptyset$，
便可以得到有限可加性。

\begin{proposition}[测度的性质]
  根据定义，测度 $\mu$ 满足下面的性质：
  \begin{enumerate}
    \item 如果 $A\subseteq B$，那么 $\mu(A)\leq\mu(B)$。此外，如果
    还满足 $\mu(A)<\infty$，那么
    \[
        \mu(B \smallsetminus A)=\mu(B)-\mu(A).
    \]
    \item 如果 $A,B\in \mathcal{A}$，那么
    \[
      \mu(A)+\mu(B)=\mu(A\cup B)+\mu(A\cap B).  
    \]
    \item 如果 $A_n\in \mathcal{A}$ 且 $A_n\subseteq A_{n+1}$，那么
    \[
      \mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)  
      =\lim_{n\to\infty}\mu(A_n).
    \]
    \item 如果 $B_n\in \mathcal{A}$ 且 $B_{n+1}\subseteq B_n$，
    $\mu(B_1)<\infty$，那么
    \[
      \mu\biggl(\bigcap_{n\in \mathbb{N}}B_n\biggr)  
      =\lim_{n\to\infty}\mu(B_n).
    \]
    \item 如果 $A_n\in \mathcal{A}$，那么
    \[
      \mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)\leq \sum_{n\in \mathbb{N}}\mu(A_n).
    \]
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 若 $A\subseteq B$，那么 $B=A\bigcup (B \smallsetminus A)$ 是无交并，所以
  \[
    \mu(B)=\mu(A)+\mu(B \smallsetminus A)\geq \mu(A).  
  \]

  (2) 若 $\mu(A),\mu(B)$ 中有至少一个为无穷，那么根据 (1)，
  $\mu(A\cup B)$ 为无穷，所以结论成立。下面假设
  $\mu(A),\mu(B)$ 均有限，记 $C=A\cap B$，那么
  $A\cup B=(A \smallsetminus C)\cup C\cup(B \smallsetminus C)$ 是无交并，
  所以
  \[
    \mu(A\cup B)=\mu(A \smallsetminus C)+\mu(C)+\mu(B \smallsetminus C)
    =\mu(A)+\mu(B)-\mu(C),
  \]
  结论 (2) 成立。

  (3) 令 $C_1=A_1$，对于 $n\geq 2$ 的时候，令
  \[
    C_n=A_{n}  \smallsetminus A_{n-1},
  \]
  那么 $A_n=\bigcup_{k\leq n}C_k$ 是无交并，所以
  \[
    \mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)  
    =\mu\biggl(\bigcup_{n\in \mathbb{N}}C_n \biggr)
    =\sum_{n\in \mathbb{N}}\mu(C_n)=\lim_{n\to\infty}
    \sum_{k=1}^n \mu(C_k)=\lim_{n\to\infty} \mu(A_n).
  \]

  (4) 令 $A_n=B_1 \smallsetminus B_n$，那么 $A_n\subseteq A_{n+1}$，此时
  \[
    \mu\biggl(\bigcap_{n\in \mathbb{N}}B_n\biggr)  =
    \mu(B_1)-\mu\biggl(B_1 \smallsetminus\bigcap_{n\in \mathbb{N}}B_n\biggr)
    = \mu(B_1)-\mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr),
  \]
  再根据 (3)，就有
  \[
    \mu\biggl(\bigcap_{n\in \mathbb{N}}B_n\biggr)  =\mu(B_1)-\lim_{n\to\infty}\mu(A_n)
    =\lim_{n\to\infty}\mu(B_1 \smallsetminus A_n)=\lim_{n\to\infty}\mu(B_n).
  \]

  (5) 令 $C_1=A_1$，对于 $n\geq 2$ 的时候，令
  \[
    C_n=A_n \smallsetminus\bigcup_{k=1}^{n-1}A_k,
  \]
  那么 $C_n$ 之间互不相交，所以
  \[
    \mu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)=\mu\biggl(\bigcup_{n\in \mathbb{N}}C_n\biggr)
    =\sum_{n\in \mathbb{N}}\mu(C_n)\leq \sum_{n\in \mathbb{N}}\mu(A_n).\qedhere
  \]
\end{proof}

\begin{example}[常见的测度]
  \mbox{}
  \begin{enumerate}
    \item 令 $E=\mathbb{N}$，$A=\mathcal{P}(\mathbb{N})$，定义%
    \emph{计数测度}为
    \[
      \mu(A)=\card(A).  
    \]
    \item 如果 $A$ 是 $E$ 的子集，定义 $A$ 的示性函数 $\mathbf{1}_A:E\to\{0,1\}$
    为
    \[
      \mathbf{1}_A(x)=\begin{cases}
        1 & x\in A,\\
        0 & x\notin A.
      \end{cases}  
    \]
    令 $(E,\mathcal{A})$ 是可测空间，固定 $x\in E$。对于每个 $A\in \mathcal{A}$，令
    $\delta_x(A)=\mathbf{1}_A(x)$，这给出了 $(E,\mathcal{A})$ 上的一个测度，被称为
    \emph{$\mathbold x$ 处的 Dirac 测度}。更一般的，如果 $(x_n)_{n\in \mathbb{N}}$
    是 $E$ 中的点列，$(\alpha_n)_{n\in \mathbb{N}}$ 是 $[0,\infty]$ 中的点列，
    我们可以考虑测度 $\sum_{n\in \mathbb{N}}\alpha_n\delta_{x_n}$ 为
    \[
      \biggl(\sum_{n\in \mathbb{N}}\alpha_n\delta_{x_n}\biggr)
      (A)=\sum_{n\in \mathbb{N}}\alpha_n\delta_{x_n}(A)=
      \sum_{n\in \mathbb{N}}\alpha_n\mathbold 1_{A}(x_n),
    \]
    这个测度被称为 $E$ 上的\emph{点测度}。
    \item 可以证明，在 $(\mathbb{R},\mathcal{B}(\mathbb{R}))$ 上存在唯一的正测度 $\lambda$
    使得：对于每个闭区间 $[a,b]$，有 $\lambda\bigl([a,b]\bigr)=b-a$。这个
    测度 $\lambda$ 被称为\emph{Lebesgue 测度}。
    Lebesgue 测度的唯一性可以由 \autoref{coro:uniqueness of measure} 保证，
    存在性由 ？保证。
  \end{enumerate}
\end{example}

如果 $\mu$ 是 $(E,\mathcal{A})$ 上的正测度，$C\in \mathcal{A}$，
那么可以定义 $\mu$ 在 $C$ 上的\emph{限制} $\nu$ 为：
\[
  \nu(A)=\mu(A\cap C),\quad \forall A\in \mathcal{A}.
\]
不难验证 $\nu$ 还是 $(E,\mathcal{A})$ 上的正测度。

\begin{definition}
  \mbox{}
  \begin{itemize}[nosep]
    \item 如果 $\mu(E)<\infty$，那么我们说测度 $\mu$ 是\emph{有限的}。
    \item 如果 $\mu(E)=1$，那么我们说测度 $\mu$ 是\emph{概率测度}，$(E,\mathcal{A},\mu)$ 是\emph{概率空间}。
    \item 如果存在一列可测集 $(E_n)_{n\in \mathbb{N}}$ 使得 $E=\bigcup_n E_n$ 以及每个
    $\mu(E_n)<\infty$，那么我们说测度 $\mu$ 是\emph{$\mathbold\sigma$-有限的}。
    \item 如果 $x\in E$ 使得单点集 $\{x\}\in \mathcal{A}$ 并且 $\mu(\{x\})>0$，那么我们说
    $x$ 是测度 $\mu$ 的一个\emph{原子}。
    \item 如果测度 $\mu$ 没有原子，那么我们说 $\mu$ 是\emph{扩散测度}。
  \end{itemize}
\end{definition}

如果 $(A_n)_{n\in \mathbb{N}}$ 是一列可测集，类比数列的上下极限，我们可以定义
集合列的上下极限分别为：
\[
  \limsup A_n=\bigcap_{n=1}^\infty\biggl(\bigcup_{k=n}^\infty A_k\biggr),\quad
  \liminf A_n=\bigcup_{n=1}^\infty\biggl(\bigcap_{k=n}^\infty A_k\biggr).
\]
注意到对于任意 $m$，都有
\[
  \bigcup_{n=1}^m\biggl(\bigcap_{k=n}^\infty A_k\biggr)
  =\bigcap_{k=m}^\infty A_k,\quad 
  \bigcap_{n=1}^m\biggl(\bigcup_{k=n}^\infty A_k\biggr)=\bigcup_{k=m}^\infty A_k,
\]
所以显然有 $\liminf A_n\subseteq \limsup A_n$。

\begin{lemma}\label{lemma:liminf and limsup ineq}
  令 $\mu$ 是 $(E,\mathcal{A})$ 上的测度，那么
  \[
    \mu(\liminf A_n)\leq \liminf \mu(A_n).
  \]
  如果 $\mu$ 是有限测度，或者更一般地，$\mu\left(\bigcup_{n=1}^\infty A_n\right)<\infty$，
  那么
  \[
    \mu(\limsup A_n)\geq\limsup\mu(A_n).
  \]
\end{lemma}
\begin{proof}
  对于任意的 $n$，有 
  \[
    \mu\biggl(\bigcap_{k=n}^\infty A_k\biggr)\leq \inf_{k\geq n}\mu(A_k),
  \]
  所以
  \[
    \mu(\liminf A_n)=\lim_{n\to\infty}\mu\biggl(\bigcap_{k=n}^\infty A_k\biggr)
    \leq \lim_{n\to\infty}\inf_{k\geq n}\mu(A_k)=\liminf \mu(A_n).
  \]
  第二个结论同理。
\end{proof}

\section{可测函数}

\begin{definition}
  令 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$ 是两个可测空间，如果映射 $f:E\to F$ 满足：
  \[
    \forall B\in \mathcal{B},\  f^{-1}(B)\in \mathcal{A},
  \]
  那么我们说 $f$ 是\emph{可测映射}。当 $E,F$ 是两个配备了 Borel $\sigma$-域的拓扑空间时，
  我们说 $f$ 是\emph{Borel 可测的}。
\end{definition}

显然，可测映射的复合是可测映射。

\begin{proposition}
  令 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$ 是两个可测空间，映射 $f:E\to F$。$f$ 可测
  当且仅当对于某个生成 $\mathcal{B}$ 的子集族 $\mathcal{C}$ (即 $\mathcal{B}=\sigma(\mathcal{C})$)，
  有 $f^{-1}(B)\in \mathcal{A}\ (\forall B\in \mathcal{C})$。
\end{proposition}
\begin{proof}
  只需证明充分性。记
  \[
    \mathcal{G}=\{B\in \mathcal{B}\,|\, f^{-1}(B)\in \mathcal{A}\},
  \]
  直接验证可知 $\mathcal{G}$ 是一个 $\sigma$-域，又因为 $\mathcal{C}\subseteq \mathcal{G}$，
  所以 $\mathcal{B}=\sigma(\mathcal{C})\subseteq \mathcal{G}\subseteq \mathcal{B}$，
  所以 $\mathcal{G}=\mathcal{B}$，这就表明 $f$ 是可测的。
\end{proof}

\begin{example}
  若 $(F,\mathcal{B})=(\mathbb{R},\mathcal{B}(\mathbb{R}))$，要证明 $f$ 是可测的，只需说明
  集合 $f^{-1}((a,b))$ 是可测的，或者 $f^{-1}((-\infty,a))$ 是可测的。
\end{example}

\begin{corollary}
  设 $E,F$ 是两个配备 Borel $\sigma$-域的拓扑空间，那么连续映射 $f:E\to F$ 都是可测的。
\end{corollary}

\begin{lemma}
  令 $(E,\mathcal{A}),(F_1,\mathcal{B}_1)$ 和 $(F_2,\mathcal{B}_2)$ 是可测空间，乘积
  $F_1\times F_2$ 配备乘积 $\sigma$-域 $\mathcal{B}_1\otimes \mathcal{B}_2$，令映射
  $f_1:E\to F_1$ 和 $F_2:E\to F_2$，定义 $f:E\to F_1\times F_2$ 为 $f(x)=(f_1(x),f_2(x))$，
  那么 $f$ 可测当且仅当 $f_1,f_2$ 都可测。
\end{lemma}

\begin{corollary}
  令 $(E,\mathcal{A})$ 是可测空间，$f,g$ 是从 $E$ 到 $\mathbb{R}$ 的可测函数，那么函数
  \[ 
    f+g,fg,\min(f,g),\max(f,g)
  \] 
  都是可测的。
\end{corollary}

记扩充实数 $\bar{\mathbb{R}}=\mathbb{R}\cup\{-\infty,+\infty\}$，其拓扑为序拓扑。
与 $\mathbb{R}$ 类似，$\bar{\mathbb{R}}$ 的 Borel $\sigma$-域由区间 $[-\infty,a)$
生成。

\begin{proposition}
  令 $(f_n)_{n\in \mathbb{N}}$ 是 $E\to\bar{\mathbb{R}}$ 的可测函数列，那么
  \[
    \sup f_n,\quad \inf f_n,\quad \limsup_{n\to\infty}f_n,\quad \liminf_{n\to\infty} f_n
  \]
  都是可测函数。特别地，如果 $(f_n)$ 逐点收敛，那么极限 $\lim f_n$ 是可测函数。
\end{proposition}

\begin{definition}
  令 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$ 是可测空间，$\varphi:E\to F$ 是可测映射， 
  $\mu$ 是 $(E,\mathcal{A})$ 上的测度，定义 $(F,\mathcal{B})$ 上的测度 $\nu$ 为
  \[
    \nu(B)=\mu(\varphi^{-1}(B)),\quad \forall B\in \mathcal{B}.
  \]
  $\nu$ 被称为\emph{$\mathbold\mu$ 在 $\mathbold\varphi$ 下的推前}，记为
  $\varphi(\mu)$，有时也记为 $\varphi_*\mu$。
\end{definition}

\section{单调类}

本节我们陈述单调类定理，这是测度论甚至概率论中的一个基本工具。

\begin{definition}
  $\mathcal{P}(E)$ 的一个子集 $\mathcal{M}$ 如果满足：
  \begin{enumerate}
    \item $E\in \mathcal{M}$；
    \item 对于任意 $A,B\in \mathcal{M}$ 且 $A\subseteq B$，有
    $B \smallsetminus A\in \mathcal{M}$；
    \item 如果一列子集 $A_n\subseteq \mathcal{M}$ 且 $A_n\subseteq A_{n+1}$，
    那么 $\bigcup_{n\in \mathbb{N}}A_n\in \mathcal{M}$，
  \end{enumerate}
  那么我们说 $\mathcal{M}$ 是一个\emph{单调类}。
\end{definition}

显然，$\sigma$-域都是单调类。反之，一个单调类是 $\sigma$-域当且仅当
其对有限交封闭。这很容易证明，若单调类 $\mathcal{M}$ 对有限交封闭，那么
任取一列子集 $A_n\subseteq \mathcal{M}$，对于任意的 $n$，有 
\[
  \bigcup_{k=1}^n  A_k=E \smallsetminus\bigcap_{k=1}^n A_k^c\in \mathcal{M},
\]
所以
\[
  \bigcup_{n\in \mathbb{N}}A_n=\bigcup_{n\in \mathbb{N}}
  \biggl(\bigcup_{k=1}^n A_k\biggr)  \in \mathcal{M},
\]
这就表明 $\mathcal{M}$ 是一个 $\sigma$-域。

与 $\sigma$-域类似，显然单调类的任意交仍然是单调类。如果
$\mathcal{C}\subseteq \mathcal{P}(E)$，那么我们可以定义
由 $\mathcal{C}$ 生成的单调类 $\mathcal{M}(\mathcal{C})$，
即包含 $\mathcal{C}$ 的最小的单调类，其可以通过对所有
包含 $\mathcal{C}$ 的单调类取交集得到。

\begin{theorem}[单调类定理]
  令 $\mathcal{C}\subseteq \mathcal{P}(E)$ 对有限交封闭，
  那么 $\mathcal{M}(\mathcal{C})=\sigma(\mathcal{C})$。
  因此，如果 $\mathcal{M}$ 是包含 $\mathcal{C}$ 的任意单调类，
  那么 $\sigma(\mathcal{C})\subseteq \mathcal{M}$。
\end{theorem}
\begin{proof}
  显然有 $\mathcal{M}(\mathcal{C})\subseteq \sigma(\mathcal{C})$。
  要证明 $\sigma(\mathcal{C})\subseteq \mathcal{M}(\mathcal{C})$，
  只需要说明 $\mathcal{M}(\mathcal{C})$ 是 $\sigma$-域。
  根据上面的叙述，这只需要说明 $\mathcal{M}(\mathcal{C})$ 对
  有限交封闭。

  对于 $A\in \mathcal{P}{(E)}$，记
  \[
    \mathcal{M}_A=\{B\in \mathcal{M}(\mathcal{C})\,|\,
    A\cap B\in \mathcal{M}(\mathcal{C})\}.  
  \]
  直接验证可知 $\mathcal{M}_A$ 是一个单调类。
  下面任取 $A\in \mathcal{C}$，由于 $\mathcal{C}$
  对有限交封闭，所以 $\mathcal{C}\subseteq \mathcal{M}_A$，这就表明
  $\mathcal{M}(\mathcal{C})\subseteq \mathcal{M}_A$。

  接下来任取 $D\in \mathcal{M}(\mathcal{C})$，上面的叙述告诉我们
  $\mathcal{C}\subseteq \mathcal{M}_D$，所以 $\mathcal{M}(\mathcal{C})\subseteq \mathcal{M}_D$。
  这就表明 $\mathcal{M}(\mathcal{C})$ 对有限交封闭，所以
  $\mathcal{M}(\mathcal{C})$ 是 $\sigma$-域。
\end{proof}

单调类定理最重要的应用是证明某些测度的唯一性。

\begin{corollary}\label{coro:uniqueness of measure}
  令 $\mu,\nu$ 是 $(E,\mathcal{A})$ 上的两个测度。假设存在一个
  子集族 $\mathcal{C}\subseteq \mathcal{A}$ 满足 $\mathcal{C}$
  对有限交封闭且 $\mathcal{A}=\sigma(\mathcal{C})$，并且对于
  任意 $A\in \mathcal{C}$ 都有 $\mu(A)=\nu(A)$。
  \begin{enumerate}
    \item 如果 $\mu(E)=\nu(E)<\infty$，那么 $\mu=\nu$。
    \item 如果存在一列 $\mathcal{C}$ 中的递增序列 $(E_n)_{n\in \mathbb{N}}$ 
    使得 $E=\bigcup_{n\in \mathbb{N}}E_n$，并且
    $\mu(E_n)=\nu(E_n)<\infty$，那么 $\mu=\nu$。
  \end{enumerate}
\end{corollary}
\begin{proof}
  (1) 令
  \[
    \mathcal{G}=\{A\in \mathcal{A}\,|\,\mu(A)=\nu(A)\},
  \]
  那么 $\mathcal{C}\subseteq \mathcal{G}$ 且不难验证 $\mathcal{G}$
  是单调类，根据单调类定理，有 $\mathcal{A}=\sigma(\mathcal{C})\subseteq \mathcal{G}$，
  即 $\mu=\nu$。

  (2) 记 $\mu_n$ 为 $\mu$ 在 $E_n$ 上的限制，$\nu_n$ 同理。
  那么
  \[
    \mu_n(E)=\mu(E\cap E_n)=\mu(E_n)=\nu(E_n)=\nu(E\cap E_n)  
    =\nu_n(E),
  \]
  根据 (1)，有 $\mu_n=\nu_n$。于是任取 $A\in \mathcal{A}$，有
  \begin{align*}
    \mu (A)&=\mu(A\cap E)=\mu\biggl(\bigcup_{n\in \mathbb{N}}(A\cap E_n)\biggr)
    =\ulim[n\to\infty]\mu(A\cap E_n)\\
    &=\ulim[n\to\infty]\mu_n(A)=\ulim[n\to\infty]\nu_n(A)
    =\ulim[n\to\infty]\nu(A\cap E_n)\\
    &=\nu\biggl(\bigcup_{n\in \mathbb{N}}(A\cap E_n)\biggr)
    =\nu(A\cap E)=\nu(A),
  \end{align*}
  这就表明 $\mu=\nu$。
\end{proof}

\autoref{coro:uniqueness of measure} 表明了 Lebesgue 测度的唯一性。
即若 $\lambda$ 是 $(\mathbb{R},\mathcal{B}(\mathbb{R}))$ 上的 
正测度，且使得 $\lambda\bigl([a,b]\bigr)=b-a$，那么这样的测度 $\lambda$
是唯一的。这是因为我们可以取
\[
  \mathcal{C}=\big\{[a,b]\,|\, a,b\in \mathbb{R},a<b\big\}  ,
\]
此时 $\mathcal{C}$ 对有限交封闭并且 $\mathcal{B}(\mathbb{R})=\sigma(\mathcal{C})$。
取 $E_n=[-n,n]\in \mathcal{C}$，那么 $\mathbb{R}=\bigcup_{n\in \mathbb{N}} E_n$
且 $\lambda(E_n)<\infty$，应用 \autoref{coro:uniqueness of measure}
的 (2) 即可表明唯一性。








\chapter{可测函数的积分}

\section{非负函数的积分}

在本章中，我们考虑配备正测度 $\mu$ 的可测空间 $(E,\mathcal{A})$。

\paragraph{简单函数}
如果可测函数 $f:E\to \mathbb{R}$ 的值域是有限集，那么我们说 $f$ 的\emph{简单函数}。
假设 $f$ 的所有可能的取值为 $\alpha_1,\dots,\alpha_n$，不妨假设 $\alpha_1<\alpha_2<\cdots<\alpha_n$。
那么 $f$ 可以表示为
\[
  f(x)=\sum_{i=1}^n \alpha_i\mathbold 1_{A_i}(x),
\]
其中 $A_i=f^{-1}(\{\alpha_i\})\in \mathcal{A}$。注意到 $E$ 是 $A_1,\dots,A_n$ 的无交并。
上述公式 $f=\sum_{i=1}^n \alpha_i\mathbold 1_{A_i}$ 被称为 $f$ 的标准表示。

\begin{definition}
  令 $f$ 是取值在 $\mathbb{R}_+$ 中的简单函数，标准表示为 $f=\sum_{i=1}^n \alpha_i\mathbold 1_{A_i}$。
  定义\emph{$\mathbold f$ 相对于 $\mathbold\mu$ 的积分}为
  \[
    \int f\d\mu=\sum_{i=1}^n\alpha_i\mu(A_i).
  \]
  在 $\alpha_i=0$ 和 $\mu(A_i)=\infty$ 的情况下，约定 $0\times\infty=0$。
\end{definition}

注意上述定义中 $\sum_{i=1}^n\alpha_i\mu(A_i)$ 的取值为 $[0,\infty]$。所以在上述定义中
我们只考虑非负的简单函数，这是为了避免出现 $\infty-\infty$ 之类的表达式。

值得注意的是，如果简单函数 $f$ 有表达
\[
  f=\sum_{j=1}^m\beta_j\mathbold 1_{B_j},
\]
其中 $B_j$ 仍然构成 $E$ 的一个划分，但是 $\beta_j$ 不再是两两不同的。此时
$f$ 的积分仍然为
\[
  \int f\d\mu=\sum_{j=1}^m\beta_j\mu(B_j).
\]
这是因为对于每个 $A_i$，某些 $B_j$ 构成了 $A_i$ 的划分，即
\[
  A_i=\bigcup_{\{j\,|\,\beta_j=\alpha_i\}}B_j,
\]
那么
\[
  \alpha_i\mu(A_i)=\alpha_i\sum_{\{j\,|\,\beta_j=\alpha_i\}}\mu( B_j)=
  \sum_{\{j\,|\,\beta_j=\alpha_i\}}\beta_j\mu( B_j).
\]

非负简单函数的积分满足下面的一些基本的性质。

\begin{proposition}
  令 $f,g$ 是 $E$ 上的非负简单函数。
  \begin{enumerate}
    \item 对于每个 $a,b\in \mathbb{R}_+$，有
    \[
      \int(af+bg)\d\mu=a\int f\d\mu+b\int g\d\mu.
    \]
    \item 如果 $f\leq g$，那么
    \[
      \int f\d\mu\leq \int g\d\mu.
    \]
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 设 $f,g$ 的标准表示分别为
  \[
    f=\sum_{i=1}^n\alpha_i\mathbold 1_{A_i},\quad  
    g=\sum_{j=1}^m\beta_j\mathbold 1_{B_j}.  
  \]
  那么每个 $A_i$ 都是某些 $A_i\cap B_j$ 的无交并，同理，
  每个 $B_j$ 都是某些 $A_i\cap B_j$ 的无交并，于是我们可以
  使用一个新的划分 $\{C_1,\dots,C_p\}$ 使得
  \[
    f=\sum_{k=1}^p \gamma_k\mathbold 1_{C_k} ,\quad
    g=\sum_{k=1}^p \theta_k\mathbold 1_{C_k} ,
  \]
  此时 $\gamma_k$ 不一定互不相同，$\theta_k$ 也不一定互不相同，
  根据命题前面的叙述，我们有
  \begin{align*}
    \int
    (af+bg)\d\mu&=\sum_{k=1}^p(a\gamma_k+b\theta_k)  \mu(C_k)\\&=
    a\sum_{k=1}^p\gamma_k\mu(C_k)+b\sum_{k=1}^p\theta_k\mu(C_k)\\
    &=a\int f\d\mu+b\int g\d\mu.
  \end{align*}

  (2) 由 (1)，有
  \[
    \int g\d\mu=\int(g-f)\d\mu+\int f\d\mu\geq \int f\d\mu.\qedhere  
  \]
\end{proof}

我们用 $\mathcal{E}_+$ 来表示 $E$ 上的非负简单函数的集合。

\begin{definition}
  令 $f:E\to[0,\infty]$ 是可测函数，定义\emph{$\mathbold f$ 相对于 $\mathbold\mu$ 的积分}
  为
  \[
    \int f\d\mu=\sup_{h\in \mathcal{E}_+,h\leq f}\int h\d\mu.
  \]
\end{definition}

$f$ 相对于 $\mu$ 的积分通常有很多写法，下面的表达
\[
  \int f\d\mu,\ \int f(x)\d\mu(x),\ \int f(x)\mu(\d x),\ \int\mu(\d x)f(x)
\]
表示的含义是完全相同的。此外，如果 $A$ 是 $E$ 的可测子集，我们定义
\[
  \int_A f\d\mu=\int f\mathbold 1_A\d\mu.
\]

从现在开始，我们用非负可测函数表示 $E\to [0,\infty]$ 的可测函数(值可以为无穷)。
需要注意的是，我们前面定义的非负简单函数值必须有限。

\begin{proposition}\label{prop:elementary property of positive measurable function}
  令 $f,g$ 是 $E$ 上的非负可测函数。
  \begin{enumerate}
    \item 如果 $f\leq g$，那么 $\int f\d\mu\leq \int g\d\mu$。
    \item 如果 $\mu(\{x\in E\,|\, f(x)> 0\})=0$，那么 $\int f\d\mu=0$。
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 显然
  \[
      \bigl\{h\in \mathcal{E}_+\,|\, h\leq f\bigr\}\subseteq 
      \bigl\{h\in \mathcal{E}_+\,|\, h\leq g\bigr\},
  \]
  根据定义即得 $\int f\d\mu\leq \int g\d\mu$。

  (2) 设 $h\in \mathcal{E}_+$ 且 $h\leq f$，设 $h$ 的标准表示
  为 $h=\sum_{i=1}^n \alpha_i\mathbold 1_{A_i}$，若 $\alpha_i> 0$，那么
  \[
    \mu(A_i)\leq   \mu (\{x\in E\,|\, h(x)> 0\})\leq \mu(\{x\in E\,|\, f(x)> 0\})=0,
  \]
  所以
  \[
    \int h\d\mu=\sum_{\{i\,|\,\alpha_i=0\}}\alpha_i\mu(A_i)+
    \sum_{\{i\,|\,\alpha_i>0\}}\alpha_i\mu(A_i)=0+0=0,
  \]
  故 $\int f\d\mu=0$。
\end{proof}

下面的单调收敛定理是测度论中的一个极为重要的基本定理，其表明
对于一列递增的非负可测函数，极限和积分可以交换次序。

\begin{theorem}[单调收敛定理]\label{thm:monotone convergence thm}
  令 $(f_n)_{n\in \mathbb{N}}$ 是 $E$ 上的一列递增的非负可测函数，即 $f_n\leq f_{n+1}$，
  记 $f=\ulim f_n$，那么
  \[
    \int f\d\mu=\ulim[n\to\infty]\int f_n\d\mu.
  \]
\end{theorem}
\begin{proof}
  由于 $f_n\leq f$，所以 $\int f_n\d\mu\leq\int f\d\mu$，
  所以 $\ulim \int f_n\d\mu\leq\int f\d\mu$，于是我们只需要证明
  反向的不等式。

  假设非负可测函数 $h=\sum_{i=1}^k \alpha_i\mathbold 1_{A_i}$
  满足 $h\leq f$，任取 $a\in[0,1)$，定义一列可测集
  \[
    E_n=\{x\in E\,|\, ah(x)\leq f_n(x)\}  ,
  \]
  此时对于任意的 $x\in E$，都有 $ah(x)<h(x)\leq f(x)$，而 $f=\ulim f_n$，
  所以总存在足够大的 $n$，使得 $ah(x)\leq f_n(x)$，这表明 $E=\bigcup_{n\in \mathbb{N}}E_n$。
  此外，$f_n\leq f_{n+1}$ 表明 $E_n\subseteq E_{n+1}$。

  显然 $f_n\geq ah\mathbold 1_{E_n}$，所以
  \[
    \int f_n\d\mu\geq a\int_{E_n} h\d\mu=
    a\sum_{i=1}^k\alpha_i\mu(A_i\cap E_n),  
  \]
  由于 $A_i=A_i\cap E=\bigcup_{n\in \mathbb{N}}(A_i\cap E_n)$，
  所以
  \[
    \mu(A_i)=\mu\biggl(\bigcup_{n\in \mathbb{N}}(A_i\cap E_n)\biggr)
    =\ulim[n\to\infty]\mu(A_i\cap E_n),
  \]
  于是
  \[
    \ulim[n\to\infty]\int f_n\d\mu\geq a\sum_{i=1}^k
    \alpha_i\ulim[n\to\infty]\mu(A_i\cap E_n)
    =  a\sum_{i=1}^k\alpha_i\mu(A_i)
    =a\int h\d\mu,
  \]
  由于 $a$ 可以任意接近 $1$，所以
  \[
    \ulim[n\to\infty]\int f_n\d\mu\geq \int h\d\mu,
  \]
  所以
  \[
    \ulim[n\to\infty]\int f_n\d\mu\geq \int f\d\mu=
    \sup_{h\in \mathcal{E}_+,h\leq f}\int h\d\mu.\qedhere
  \]
\end{proof}


\begin{proposition}\label{prop:property of integral of positive function}
  \mbox{}
  \begin{enumerate}
    \item 设 $f$ 是 $E$ 上的非负可测函数，那么存在一列递增的非负简单函数 $(f_n)_{n\in \mathbb{N}}$
    使得 $f=\ulim f_n$。如果 $f$ 有界，那么 $f_n\to f$ 一致收敛。
    \item 令 $f,g$ 是两个 $E$ 上的非负可测函数，$a,b\in \mathbb{R}_+$，那么
    \[
      \int (af+bg)\d\mu=a\int f\d\mu+b\int g\d\mu.
    \]
    \item 令 $(f_n)_{n\in \mathbb{N}}$ 是一列 $E$ 上的非负可测函数，那么
    \[
      \int\biggl(\sum_{n\in \mathbb{N}}f_n\biggr)\d\mu=\sum_{n\in \mathbb{N}}\int f_n\d\mu.
    \]
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 令 $d_n:[0,\infty]\to \mathbb{R}_+$ 为
  \[
    d_n=\sum_{k=1}^{n2^n}\frac{k-1}{2^n}  
    \mathbold 1_{\left[\frac{k-1}{2^n},\frac{k}{2^n}\right)}+
    n\mathbold 1_{[n,\infty]},
  \]
  显然 $d_n$ 是非负简单函数。直观上来看，$d_n$ 将区间 $[0,n]$
  等分为了 $n2^n$ 份，即将 $[0,1]$ 等分为了 $2^n$ 份。
  那么对于 $x\in [0,n)$，总存在唯一的 $k_n$ 使得 
  $(k_n-1)/2^n\leq x< k_n/2^n$，此时 $k_{n+1}=2k_n$
  或者 $k_{n+1}=2k_n-1$，所以
  \[
    d_{n+1}(x)  =\frac{k_{n+1}-1}{2^{n+1}}\geq \frac{k_n-1 }{2^n}
    =d_n(x),
  \]
  这表明 $d_n\leq d_{n+1}$。此外，不难看出 $\lim d_n(x)=x$。
  
  令 $f_n=d_n\circ f$，由于 $f_n$ 只有有限多个取值，所以
  $f_n$ 是非负简单函数。$d_n\leq d_{n+1}$ 表明
  $f_n\leq f_{n+1}$。且 $\lim f_n=\lim d_n\circ f=f$，
  所以 $f_n$ 就是一列递增的非负简单函数且 $f=\ulim f_n$。
  $f$ 有界表明在 $n$ 足够大的时候有 $0\leq f-f_n\leq 2^{-n}$，
  即 $f_n\to f$ 一致收敛。

  (2) 由 (1)，设 $f=\ulim f_n$，$g=\ulim g_n$，其中 $(f_n),(g_n)$
  均为一列递增的简单函数，那么
  \[
    \int (af_n+bg_n)\d\mu=a\int f_n\d\mu+b\int g_n\d\mu,  
  \]
  令 $n\to\infty$，再根据单调收敛定理，就有
  \[
    \int (af+bg)\d\mu=a\int f\d\mu+b\int g\d\mu.
  \]

  (3) 根据 (2)，有
  \[
    \int\biggl(\sum_{n=1}^m f_n\biggr)  \d\mu=
    \sum_{n=1}^m \int f_n\d\mu,
  \]
  令 $m\to\infty$，再根据单调收敛定理，就有
  \[
    \int\biggl(\sum_{n\in \mathbb{N}}f_n\biggr)\d\mu=\sum_{n\in \mathbb{N}}\int f_n\d\mu.
    \qedhere
  \]
\end{proof}

\begin{remark}
  \autoref{prop:property of integral of positive function} 和
  单调收敛定理 \ref{thm:monotone convergence thm} 给出了证明
  关于非负可测函数积分的命题的一种基本范式，即根据
  \autoref{prop:property of integral of positive function} 的 (1)，
  假设一列非负简单函数逼近原函数，先证明命题对非负简单函数成立，
  这通常是非常容易的，再使用单调收敛定理证明命题对所有的
  非负可测函数成立。
\end{remark}

下面的推论在概率论中十分有用，其对应于随机变量的概率密度函数。其
证明是上述注释中技巧的一个典型运用。

\begin{corollary}\label{coro:density of measure}
  令 $g$ 是非负可测函数，对于 $A\in \mathcal{A}$，令
  \[
    \nu(A)=\int_A g\d\mu=\int g\mathbold 1_A \d\mu,
  \]
  那么 $\nu$ 是 $E$ 上的正测度，被称为密度 $g$ 相对于 $\mu$
  的测度，记为 $\nu=g\cdot \mu$。此外，对于非负可测函数
  $f$，有
  \[
    \int f\d\nu=\int fg\d\mu.
  \]
\end{corollary}
\begin{proof}
  显然 $\nu(\emptyset)=0$。任取一列不相交的 $A_n\in \mathcal{A}$，
  那么
  \[
    \nu\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)  
    =\int \biggl(\sum_{n\in \mathbb{N}}g\mathbold 1_{A_n}\biggr)
    \d\mu=\sum_{n\in \mathbb{N}}\int g\mathbold 1_{A_n}\d\mu
    =\sum_{n\in \mathbb{N}}\mu(A_n),
  \]
  这就表明 $\mu$ 是 $E$ 上的正测度。

  对于任意示性函数 $\mathbold 1_A$，有
  \[
    \int \indicator{A}\d\nu=\nu(A)=\int \indicator{A}g\d\mu,
  \]
  进一步的，令 $f=\ulim f_n$，其中 $f_n$ 是非负简单函数，
  对于每个 $f_n$，根据积分的线性性，都有
  \[
    \int f_n \d\nu=\int f_ng\d\mu, 
  \]
  令 $n\to\infty$，根据单调收敛定理，就有 
  \[
    \int f\d\nu=\int fg\d\mu.\qedhere
  \]
\end{proof}
\begin{remark}
  在实际中，我们通常也会写作 $\nu(\d x)=g(x)\mu(\d x)$，或者
  $g=\d\nu/\d\mu$。
\end{remark}

在测度论中，命题通常在\emph{几乎处处}(almost everywhere)的意义下成立，也就是说，
对于不满足该命题的所有 $x\in E$ 的集合，这个集合的 $\mu$-测度为 $0$，
我们使用简写 $\alev{\mu}$ 来表示这个意思。也就是说，当我们
写到 $f=g,\ \alev{\mu}$ 的时候，我们表示的意思实际上是
\[
  \mu\bigl(\{x\in E\,|\, f(x)\neq g(x)\}\bigr)=0.
\]

\begin{proposition}
  令 $f$ 是非负可测函数。
  \begin{enumerate}
    \item 对于每个 $a\in(0,\infty)$，有
    \[
      \mu(\{x\in E\,|\, f(x)\geq a\})\leq \frac{1}{a}\int f\d\mu.
    \]
    \item 我们有
    \[
      \int f\d\mu<\infty\Rightarrow f<\infty,\ \text{$\mu$ a.e.}
    \]
    \item 我们有
    \[
      \int f\d\mu=0\Leftrightarrow f=0,\ \text{$\mu$ a.e.}
    \]
    \item 如果 $g$ 是非负可测函数，
    \[
      f=g,\ \text{$\mu$ a.e.}\Rightarrow \int f\d\mu=\int g\d\mu.
    \]
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 令可测集
  $
    A=\{x\in E\,|\, f(x)\geq a\}
  $，
  那么 $f\geq a\indicator{A}$，所以
  \[
    \int f\d\mu\geq a\int \indicator{A}\d\mu  
    =a\mu(A).
  \]

  (2) 令可测集
  $
    A_n=\{x\in E\,|\, f(x)\geq n\}  
  $ 以及 $A_\infty=\{x\in E\,|\, f(x)=\infty\}$，
  那么 $A_{n+1}\subseteq A_n$ 且 $A_\infty=\bigcap_{n\in \mathbb{N}}A_n$。
  根据 (1)，有
  \[
    \mu(A_1)\leq \int f\d\mu<\infty,  
  \]
  所以
  \[
    \mu(A_\infty)=\dlim[n\to\infty] \mu(A_n)\leq
    \dlim[n\to\infty]\frac{1}{n}\int f\d\mu=0, 
  \]
  所以 $\mu(A_\infty)=0$，即 $f<\infty,\ \alev{\mu}$。

  (3) 充分性由 \autoref{prop:property of integral of positive function} 的 (2) 保证。
  下证必要性。令可测集
  $
    A_n=\{x\in E\,|\, f(x)\geq 1/n\}  
  $ 以及
  $A_\infty=\{x\in E\,|\, f(x)\neq 0\}$，那么
  $A_n\subseteq A_{n+1}$ 且 $A_\infty=\bigcup_{n\in \mathbb{N}}A_n$。
  根据 (1)，有
  \[
    \mu(A_\infty)=\ulim[n\to\infty]\mu(A_n)\leq
    \ulim[n\to\infty]n\int f\d\mu=0,
  \]
  所以 $\mu(A_\infty)=0$。

  (4) 记 $f\wedge g=\min(f,g)$ 及 $f\vee g=\max(f,g)$，那么
  $f=g,\ \alev{\mu}$ 表明  $f\vee g=f\wedge g,\ \alev{\mu}$。
  根据 (3)，有
  \[
    \int f\vee g\d\mu=\int f\wedge g\d\mu+\int (f\vee g-f\wedge g)\d\mu
    =\int f\wedge g\d\mu,  
  \]
  又因为 $\int f\wedge g\d\mu\leq \int f\d\mu\leq \int f\vee g\d\mu$，
  对于 $g$ 类似，所以
  \[
    \int f\d\mu=\int g\d\mu.\qedhere  
  \]
\end{proof}

\begin{theorem}[Fatou 引理]
  令 $(f_n)_{n\in \mathbb{N}}$ 是一列非负可测函数，那么
  \[
    \int \liminf f_n\d\mu\leq \liminf \int f_n\d\mu.
  \]
\end{theorem}
\begin{proof}
  只需证明
  \[
    \int\lim_{n\to\infty}\inf_{k\geq n}f_k \d\mu\leq 
    \lim_{n\to\infty}\inf_{k\geq n}\int f_k\d\mu,  
  \]
  令 $g_n=\inf_{k\geq n}f_k$，那么 $g_n\leq g_{n+1}$，根据
  单调收敛定理，有
  \[
    \int \lim_{n\to\infty}g_n\d\mu=\ulim[n\to\infty]\int g_n\d\mu.
  \]
  对于任意 $n$ 和 $k\geq n$，有 $\int g_n\d\mu\leq \int f_k\d\mu$，所以
  \[
    \int \lim_{n\to\infty}g_n\d\mu=\ulim[n\to\infty]\int g_n\d\mu
    \leq\inf_{k\geq n} \int f_k\d\mu,
  \]
  令 $n\to\infty$，即可得到
  \[
    \int \liminf f_n\d\mu\leq \liminf \int f_n\d\mu.\qedhere
  \]
\end{proof}

\begin{proposition}\label{prop:change variable}
  令 $(F,\mathcal{B})$ 是可测空间，$\varphi:E\to F$ 是可测映射。令
  $\nu$ 是 $\mu$ 在 $\varphi$ 下的推前。那么，对于任意 $F$ 上的非负可测函数 $h$，
  我们有
  \[
    \int_Eh(\varphi(x))\mu(\d x)=\int_Fh(y)\nu(\d y).
  \]
\end{proposition}
\begin{proof}
  若 $h=\indicator{B}$ 是示性函数，那么
  \[
    \int_E h(\varphi(x))\mu(\d x)=
    \mu(\varphi^{-1}(B)) =\nu(B)=\int_F h(y)\nu(\d y).
  \]
  若 $h=\sum_{i=1}^n\alpha_i\indicator{B_i}$ 是非负简单函数，
  那么根据积分的线性性，结论也成立。
  若 $h$ 是一般的非负可测函数，设 $(h_n)_{n\in \mathbb{N}}$ 是一列递增的非负简单函数
  且 $h=\ulim h_n$，根据单调收敛定理，即可证明结论。
\end{proof}



\section{可积函数}

本节我们讨论可变号的可测函数。
如果 $f:E\to \mathbb{R}$ 是可测函数，记 $f$ 正部分 $f^+=\max(f,0)$，
负部分 $f^-=\max(-f,0)$，需要注意 $f^+$ 和 $f^-$ 此时都是非负可测函数
并且 $f=f^+-f^-$，$|f|=f^++f^-$。

\begin{definition}
  令 $f:E\to \mathbb{R}$ 是可测函数，如果
  \[
    \int|f|\d\mu<\infty,
  \]
  那么我们说 $f$ 相对于 $\mu$ \emph{可积}。在这种情况下，
  我们定义
  \[
    \int f\d\mu=\int f^+\d\mu-\int f^-\d\mu.
  \]
  如果 $A\in \mathcal{A}$，记
  \[
    \int_A f\d\mu=\int f\mathbold 1_A\d\mu.
  \]
\end{definition}

我们使用 $\mathcal{L}^1(E,\mathcal{A},\mu)$ 来表示所有可积函数
$f:E\to \mathbb{R}$ 构成的空间。$\mathcal{L}_+^1(E,\mathcal{A},\mu)$ 来表示
所有非负可积函数构成的空间。

\begin{proposition}[可积函数的性质]
  \mbox{}
  \begin{enumerate}
    \item 对于任意 $f\in \mathcal{L}^1(E,\mathcal{A},\mu)$，有
    $\bigl|\int f\d\mu\bigr|\leq \int |f|\d\mu$。
    \item $\mathcal{L}^1(E,\mathcal{A},\mu)$ 是 $\mathbb{R}$-向量空间。
    \item 如果 $f,g\in \mathcal{L}^1(E,\mathcal{A},\mu)$ 且
    $f\leq g$，那么 $\int f\d\mu\leq \int g\d\mu$。
    \item 如果 $f\in \mathcal{L}^1(E,\mathcal{A},\mu)$，$g:E\to [0,\infty]$
    是非负可测函数使得 $f=g,\ \alev{\mu}$，那么
    $g\in \mathcal{L}^1(E,\mathcal{A},\mu)$ 且 $\int f\d\mu=\int g\d\mu$。
    \item 令 $(F,\mathcal{B})$ 是可测空间，$\varphi:E\to F$ 是可测映射。令
    $\nu$ 是 $\mu$ 在 $\varphi$ 下的推前。那么，对于任意可测函数 $h:F\to \mathbb{R}$，
    $h$ 是 $\nu$-可积的当且仅当 $h\circ\varphi$ 是 $\mu$-可积的，并且我们有
    \[
      \int_Eh(\varphi(x))\mu(\d x)=\int_Fh(y)\nu(\d y).
    \]
  \end{enumerate}
\end{proposition}

\begin{theorem}[控制收敛定理]
  令 $(f_n)_{n\in \mathbb{N}}$ 是 $\mathcal{L}^1(E,\mathcal{A},\mu)$
  中的一列函数，如果：
  \begin{enumerate}
    \item 存在可测函数 $f:E\to \mathbb{R}$ 使得
    \[
      f_n(x)\to f(x),\quad\alev{\mu}  
    \]
    \item 存在非负可测函数 $g$ 使得 $\int g\d\mu<\infty$，并且
    对于每个 $n\in \mathbb{N}$，都有
    \[
      |f_n(x)|\leq g(x),\quad \alev{\mu}   
    \]
  \end{enumerate}
  那么 $f\in \mathcal{L}^1(E,\mathcal{A},\mu)$ 且我们有
  \[
    \lim_{n\to\infty}\int f_n\d\mu=\int f\d\mu,\quad
    \lim_{n\to\infty}\int |f_n-f|\d\mu=0.  
  \]
\end{theorem}
\begin{proof}
  我们首先将两个条件中的几乎处处去掉，证明结论成立。
  由于 $|f_n|\leq g$，所以 $|f|=\lim|f_n|\leq g$，所以
  $\int |f|\d\mu\leq \int g\d\mu<\infty$，故
  $f\in L^1(E,\mathcal{A},\mu)$。由于 $|f-f_n|\leq 2g$
  以及 $\lim |f-f_n|=0$，根据 Fatou 引理，有
  \[
    \liminf \int\bigl(2g-|f-f_n|\bigr)\d\mu\geq
    \int \bigl(2g-\limsup|f-f_n|\bigr)\d\mu 
    =\int 2g\d\mu,
  \]
  再根据积分的线性性，有
  \[
    \int 2g\d\mu-\limsup\int|f-f_n|\d\mu\geq \int 2g\d\mu,  
  \]
  这表明
  \[
    \limsup\int |f-f_n|\d\mu = 0,  
  \]
  所以 $\lim \int |f-f_n|\d\mu$ 存在且为 $0$。最后，我们有
  \[
    \left|\int f\d\mu-\int f_n\d\mu\right|\leq \int |f-f_n|\d\mu\to 0,
  \]
  所以 $\int f\d\mu=\lim\int f_n\d\mu$。

  现在我们证明几乎处处的情况。记
  \[
    A=\big\{x\in E\,|\, f_n(x)\to f(x),|f_n(x)|\leq g(x)\big\}  ,
  \]
  那么 $A$ 可测且条件表明 $\mu(A^c)=0$。定义
  \[
    \tilde f_n(x)=\indicator{A}(x)f_n(x),\quad \tilde{f}(x)=\indicator{A}(x)f(x),  
  \]
  于是在几乎处处的意义下有 $f_n=\tilde{f}_n$ 以及 $f=\tilde{f}$，
  所以 $\int f_n\d\mu=\int\tilde{f}_n\d\mu$，
  $\int f\d\mu=\int\tilde f\d\mu$ 以及 $\int|f-f_n|\d\mu=\int|\tilde f-\tilde f_n|\d\mu$。
  对 $\tilde{f}_n$ 和 $\tilde{f}$ 应用上面的结论即可。
\end{proof}

\section{含参积分}

我们考虑带有一个参数的函数的积分。
设 $(U,d)$ 是一个度量空间，参数位于这个空间中。

\begin{theorem}[含参积分的连续性]
  令 $f:U\times E\to \mathbb{R}$ (or $\mathbb{C}$)，$u_0\in U$。假设：
  \begin{enumerate}
    \item 对于每个 $u\in U$，函数 $x\mapsto f(u,x)$ 可测；
    \item $\alev{\mu(\d x)}$，函数 $u\mapsto f(u,x)$ 在 $u_0$ 处连续；
    \item 存在函数 $g\in \mathcal{L}_+^1(E,\mathcal{A},\mu)$
    使得任取 $u\in U$ 有
    \[
      |f(u,x)|\leq g(x)\quad \alev{\mu(\d x)}  
    \]
  \end{enumerate}
  那么函数 $F(u)=\int f(u,x)\mu(\d x)$ 是良好定义的且在 $u_0$
  处连续。
\end{theorem}
\begin{proof}
  条件 (1) 保证了 $x\mapsto f(u,x)$ 是可测的，所以 $F(u)$ 是良好定义的。
  设 $(u_n)_{n\in \mathbb{N}}$ 是任意趋于 $u_0$ 的点列，那么 
  对于几乎处处的 $x$，$u\mapsto f(u,x)$ 连续表明 $f(u_n,x)\to f(u,x)$，
  再根据条件 (3) 和控制收敛定理，就有
  \[
    F(u_0)=\int \lim_{n\to\infty} f(u_n,x)\mu(\d x)
    =  \lim_{n\to\infty}\int f(u_n,x)\mu(\d x)=\lim_{n\to\infty}F(u_n),
  \]
  这就表明 $F(u)$ 在 $u_0$ 处连续。
\end{proof}

\begin{example}
  \mbox{}
  \begin{enumerate}
    \item \emph{Fourier 变换}。令 $\lambda$ 表示 $\mathbb{R}$ 上的 Lebesgue 测度。
    如果 $\varphi\in \mathcal{L}^1(\mathbb{R},\mathcal{B}(\mathbb{R}),\lambda)$，
    定义函数 $\hat\varphi:\mathbb{R}\to \mathbb{C}$ 为：
    \[
      \hat\varphi(u)=\int e^{iux}\varphi(x)\lambda(\d x),  
    \]
    根据上面的定理，$\hat\varphi$ 是连续函数。函数 $\hat\varphi$ 被称为 $\varphi$
    的 \emph{Fourier 变换}。在概率论中，我们经常会考虑有限测度的 Fourier 变换。
    如果 $\mu$ 是 $\mathbb{R}$ 上的有限测度，定义 $\mu$ 的 Fourier 变换为
    \[
      \hat{\mu}(u)=\int e^{iux}\mu(\d x)\quad u\in \mathbb{R}.  
    \]
    此时 $|e^{iux}|\leq \indicator{\mathbb{R}}$ 是可积函数，所以
    $\hat\mu$ 是连续函数。
    \item \emph{卷积}。令 $\varphi\in \mathcal{L}^1(\mathbb{R},\mathcal{B}(\mathbb{R}),\lambda)$，
    $h: \mathbb{R}\to \mathbb{R}$ 是有界连续函数，那么定义函数 $h*\varphi$ 为
    \[
      h*\varphi(u)=\int h(u-x)\varphi(x)\lambda(\d x),  
    \]
    这是一个连续函数。
  \end{enumerate}
\end{example}

下面我们叙述含参积分的可微性。令 $I\subseteq \mathbb{R}$ 是开区间。

\begin{theorem}
  考虑函数 $f:I\times E\to \mathbb{R}$，$u_0\in I$，假设
  \begin{enumerate}
    \item 对于每个 $u\in I$，函数 $x\mapsto f(u,x)$ 是可积函数；
    \item $\alev{\mu(\d x)}$，函数 $u\mapsto f(u,x)$ 在 $u_0$ 处可导，
    导数记为
    \[
      \frac{\partial f}{\partial u}(u_0,x);  
    \]
    \item 存在函数 $g\in \mathcal{L}_+^1(E,\mathcal{A},\mu)$ 使得
    对于任意 $u\in I$ 有
    \[
      |f(u,x)-f(u_0,x)|\leq g(x)|u-u_0|,\quad \alev{\mu(\d x)}  
    \]
  \end{enumerate}
  那么函数 $F(u)=\int f(u,x)\mu(\d x)$ 在 $u_0$ 处可导，并且
  \[
    F'(u_0)=\int \frac{\partial f}{\partial u}(u_0,x)\mu(\d x).
  \]
\end{theorem}
\begin{proof}
  
\end{proof}


\begin{exercise}
  计算
  \[
    \lim_{n\to\infty}\int_0^n\left(1+\frac{x}{n}\right)^ne^{-2x}\d x.  
  \]
  令 $\alpha\in \mathbb{R}$，证明极限
  \[
    \lim_{n\to\infty}\int_0^n\left(1-\frac{x}{n}\right)^n x^{\alpha-1}\d x  
  \]
  在 $[0,\infty]$ 上存在，且极限值有限当且仅当 $\alpha>0$。
\end{exercise}
\begin{proof}
  由于
  \[
    \int_0^n\left(1+\frac{x}{n}\right)^ne^{-2x}\d x=\int_0^1
    n(1+x)^ne^{-2nx}\d x,
  \]
  对于任意 $x\in (0,1)$，有
  \[
    \lim_{n\to\infty}n(1+x)^n e^{-2nx}=\lim_{n\to\infty}n\bigl((1+x)e^{-2x}\bigr) ^n
    =0,
  \]
\end{proof}



\chapter{测度的构造}

\section{外测度}

\begin{definition}
  令 $E$ 是集合，映射 $\mu^*:\mathcal{P}(E)\to [0,\infty]$ 如果满足：
  \begin{enumerate}
    \item  $\mu^*(\emptyset)=0$；
    \item $A\subseteq B\Rightarrow \mu^*(A)\leq\mu^*(B)$；
    \item ($\sigma$-次可加性) 对于 $\mathcal{P}(E)$ 中的一列子集 $(A_k)_{k\in \mathbb{N}}$，
    有
    \[
      \mu^*\biggl(\bigcup_{k\in \mathbb{N}}A_k \biggr)  \leq
      \sum_{k\in \mathbb{N}}\mu^*(A_k).
    \]
  \end{enumerate}
  那么我们说 $\mu^*$ 是一个\emph{外测度}。
\end{definition}

外测度的要求不如测度严格，首先 $\sigma$-可加性被替换为 $\sigma$-次可加性，
其次外测度是在幂集 $\mathcal{P}(E)$ 上定义的，而测度只能在
$\sigma$-域上定义。

我们本节的目标是从外测度 $\mu^*$ 开始，在某个 $\sigma$-域 $\mathcal{M}(\mu^*)$
上构造一个测度。从现在开始，我们固定一个外测度 $\mu^*$。

\begin{definition}
  对于 $E$ 的子集 $B$，如果任取 $A\subseteq E$，都有
  \[
    \mu^*(A)=\mu^*(A\cap B)+\mu^*(A\cap B^c),  
  \]
  那么我们说 $B$ 是\emph{$\mathbold{\mu^*}$-可测的}。用
  $\mathcal{M}(\mu^*)$ 表示所有 $\mu^*$-可测的子集构成的子集族。
\end{definition}

\begin{remark}
  根据 $\sigma$-次可加性，总是有
  \[
    \mu^*(A)\leq \mu^*(A\cap B)+\mu^*(A\cap B^c),
  \]
  所以要验证子集 $B$ 是 $\mu^*$-可测的，只需要说明反向的不等式即可。
\end{remark}

\begin{theorem}\label{thm:outer measure}
  \mbox{}
  \begin{enumerate}
    \item $\mathcal{M}(\mu^*)$ 是 $\sigma$-域，并且其包含
    所有的满足 $\mu^*(B)=0$ 的子集 $B\subseteq E$。
    \item $\mu^*$ 在 $\mathcal{M}(\mu^*)$ 上的限制是一个测度。
  \end{enumerate}
\end{theorem}


\section{Lebesgue 测度}

对于任意子集 $A\subseteq \mathbb{R}$，定义
\[
  \lambda^*(A)=\inf\bigg\{\sum_{i\in \mathbb{N}}(b_i-a_i)\,|\, A\subseteq \bigcup_{i\in \mathbb{N}}(a_i,b_i)\bigg\}  .
\]
注意这个下确界的取值范围为 $[0,\infty]$：如果 $A$ 无界，那么
将会得到 $\infty$。

\begin{theorem}
  \mbox{}
  \begin{enumerate}
    \item $\lambda^*$ 是 $\mathbb{R}$ 上的一个外测度。
    \item $\sigma$-域 $\mathcal{M}(\lambda^*)$ 包含 $\mathcal{B}(\mathbb{R})$。
    \item 对于任意实数 $a\leq b$，$\lambda^*([a,b])=\lambda^*((a,b))=b-a$。
  \end{enumerate}
\end{theorem}
\begin{proof}
  (1) 显然 $\lambda^*(\emptyset)=0$ 并且 $A\subseteq B$ 表明 $\lambda^*(A)\leq\lambda^*(B)$。
  下面证明 $\sigma$-次可加性。任取 $\mathbb{R}$ 的一列子集 $(A_n)_{n\in \mathbb{N}}$，
  不妨假设每个 $\lambda^*(A_n)<\infty$。任取 $\varepsilon>0$，对于每个 $A_n$，都存在
  一列开区间 $\bigl(a_i^{(n)},b_i^{(n)}\bigr)$ 使得
  \[
    \lambda^*(A_n)\leq \sum_{i\in \mathbb{N}}\bigl(b_i^{(n)}-a_i^{(n)}\bigr)
    <\lambda^*(A_n)+\frac{\varepsilon}{2^n},
  \]
  注意到所有的开区间 $\bigl(a_i^{(n)},b_{i}^{(n)}\bigr)\ (i,n\in \mathbb{N})$
  构成了 $\bigcup_{n\in \mathbb{N}}A_n$ 的一个可数开覆盖，所以
  \[
    \lambda^*\biggl(\bigcup_{n\in \mathbb{N}}A_n\biggr)\leq
    \sum_{n\in \mathbb{N}}\sum_{i\in \mathbb{N}}\bigl(b_i^{(n)}-a_i^{(n)}\bigr)
    \leq \sum_{n\in \mathbb{N}}\lambda^*(A_n)+\varepsilon,
  \]
  由于 $\varepsilon$ 的任意性，所以 $\lambda^*$ 满足 $\sigma$-次可加性。

  (2) 
\end{proof}


\chapter{$L^p$ 空间}

\section{定义与 H\"older 不等式}

在本章中，我们考虑测度空间 $(E,\mathcal{A},\mu)$。对于实数 $p\geq 1$，
我们令 $\mathcal{L}^p(E,\mathcal{A},\mu)$ 表示所有满足
\[
  \int |f|^p\d\mu<\infty  
\]
的可测函数 $f:E\to \mathbb{R}$ 构成的空间。
此外，我们引入 $\mathcal{L}^\infty(E,\mathcal{A},\mu)$ 表示所有
几乎处处有界的可测函数 $f:E\to \mathbb{R}$ 构成的空间，即存在
常数 $C\in \mathbb{R}_+$ 使得
\[
  |f|\leq C,\ \alev{\mu}  
\]

对于每个 $p\in [1,\infty]$，我们可以定义 $\mathcal{L}^p$ 上
的一个等价关系：
\[
  f\sim g\Leftrightarrow f=g,\ \alev{\mu}  
\]
于是我们可以考虑商空间
\[
  L^p(E,\mathcal{A},\mu)=\mathcal{L}^p(E,\mathcal{A},\mu)/\sim.  
\]
也就是说，我们只考虑几乎处处相等意义上的函数，如果两个函数几乎处处
相等，那么我们认为这是同一个函数。

在没有歧义的情况下，我们使用 $L^p(\mu)$ 或者 $L^p$ 表示
$L^p(E,\mathcal{A},\mu)$。注意到 $L^1$ 就是所有可积函数
构成的空间。

对于可测函数 $f:E\to \mathbb{R}$ 和 $p\in [1,\infty)$，我们定义
\[
  \norm{f}_p=\left(\int |f|^p\d\mu\right)^{1/p}  .
\]
约定 $\infty^{1/p}=\infty$。定义
\[
  \norm{f}_\infty=\inf\{C\in[0,\infty]\,|\, |f|\leq C,\ \alev{\mu}\}  .
\]
如果 $f,g$ 是两个几乎处处相等的可测函数，那么有 $\norm{f}_p=\norm{g}_p$，
所以我们可以针对 $f\in L^p(E,\mathcal{A},\mu)$ 良好的定义 $\norm{f}_p$。

对于 $p,q\in [1,\infty]$，我们说 $p$ 和 $q$ 是\emph{共轭指数}，如果
\[
  \frac{1}{p}+\frac{1}{q}=1.  
\]
特别地，$1$ 和 $\infty$ 是共轭的。

\begin{theorem}[H\"older 不等式]
  令 $p,q$ 是共轭指数，$f,g$ 是两个 $E\to \mathbb{R}$ 的可测函数，那么
  \[
    \int|fg|\d\mu\leq \norm{f}_p\norm{g}_q.  
  \]
  特别地，如果 $f\in L^p$ 以及 $g\in L^q$，那么
  $fg\in L^1$。
\end{theorem}
\begin{proof}
  若 $\norm{f}_p=0$，那么 $|f|=0\,\ \alev{\mu}$，这表明 
  $\int |fg|\d\mu=0$，结论显然成立，所以我们不妨假设
  $\norm{f}_p>0$ 以及 $\norm{g}_p>0$。进一步的，我们还可以假设
  $f\in L^p$ 以及 $g\in L^q$，否则右边为 $\infty$ 显然成立。

  先假设 $p=1$ 和 $q=\infty$，那么
  \[
    \int|fg|\d\mu\leq \norm{g}_{\infty}\int |f|\d\mu
    =  \norm{f}_1\norm{g}_\infty.
  \]
  下面假设 $1<p,q<\infty$。

  设 $\alpha\in (0,1)$，那么对于 $x\in [0,\infty)$ 有不等式
  \[
    x^\alpha-\alpha x\leq 1-\alpha,  
  \]
  取 $x=u/v\ (u\geq 0,v>0)$，我们有
  \[
    u^\alpha v^{1-\alpha}\leq \alpha u+(1-\alpha) v,  
  \]
  该不等式在 $v=0$ 时也成立。取 $\alpha=1/p$，$1-\alpha=1/q$，
  以及
  \[
    u=\frac{|f|^p}{\norm{f}_p^p} ,\quad v=\frac{|g|^q}{\norm{g}_q^q},
  \]
  那么
  \[
  \frac{|fg|}{\norm{f}_p^p\norm{g}_q^q}\leq
  \frac{1}{p}\frac{|f|^p}{\norm{f}_p^p}+
  \frac{1}{q}\frac{|g|^q}{\norm{g}_q^q},
  \]
  两边积分，即得
  \[
    \int|fg|\d\mu\leq   \norm{f}_p^p\norm{g}_q^q.\qedhere
  \]
\end{proof}

\begin{corollary}[Cauchy-Schwarz 不等式]
  取 $p=q=2$，即得
  \[
    \int |fg|\d\mu\leq \left(\int |f|^2 \d\mu\right)^{1/2}  
    \left(\int |g|^2 \d\mu\right)^{1/2}  .
  \]
\end{corollary}
 
\begin{corollary}
  假设 $\mu$ 是有限测度，$p,q$ 是共轭指数且 $p>1$，那么对于
  任意可测函数 $f:E\to \mathbb{R}$，有
  \[
    \norm{f}_1\leq \mu(E)^{1/q}\norm{f}_p,  
  \]
  因此，对于任意 $p\in (1,\infty]$，有 $L^p\subseteq L^1$。
  更一般地，对于任意 $1\leq r< r'<\infty$，有
  \[
    \norm{f}_r\leq \mu(E)^{\frac{1}{r}-\frac{1}{r'}}  
    \norm{f}_{r'},
  \]
  因此，对于任意 $1\leq p<q\leq \infty$，有 $L^q\subseteq L^p$，
  特别地，当 $\mu$ 是概率测度的时候，还有 $\norm{f}_p\leq\norm{f}_q$。
\end{corollary}
\begin{proof}
  取 $g=\indicator{E}$，即得
  \[
    \int|f|\d\mu=\int|f \indicator{E}|\d\mu\leq
    \norm{f}_p \norm{\indicator{E}}_q=\mu(E)^{1/q}\norm{f}_p. 
  \]
  用 $f^r$ 替代 $f$，取 $p=r'/r$，$1/q=1-r/r'$，那么
  \[
    \norm{f}_r\leq \mu(E)^{1/r-1/r'}\norm{f^r}_{r'/r}^{1/r}  
    =\mu(E)^{1/r-1/r'}\norm{f}_{r'}.\qedhere
  \]
\end{proof}

\section{Banach 空间 $L^p(E,\mathcal{A},\mu)$}



\chapter{积测度}

\section{积 $\sigma$-域}

令 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$ 是两个可测空间。
回顾第一章，我们定义 $E\times F$ 上的乘积 $\sigma$-域
\[
  \mathcal{A}\otimes \mathcal{B}=\sigma(A\times B\,|\, A\in \mathcal{A},B\in \mathcal{B}).  
\]
不难验证 $\mathcal{A}\otimes \mathcal{B}$ 是使得两个投影映射
$\pi_1:E\times F\to E$ 和 $\pi_2:E\times F\to F$ 都可测的最小的
$\sigma$-域。

如果 $C\subseteq E\times F$，$x\in E$，记
\[
  C_x=\{y\in F\,|\, (x,y)\in C\}\subseteq F,  
\]
如果 $y\in F$，记
\[
  C^y=\{x\in E\,|\, (x,y)\in C\}  \subseteq E.
\]
如果 $f$ 是 $E\times F$ 上的函数，$x\in E$，我们记 $f_x$ 表示
$F$ 上的函数 $f_x(y)=f(x,y)$。类似地，如果 $y\in F$，我们记
$f^y(x)=f(x,y)$ 表示 $E$ 上的函数。

\begin{proposition}
  \mbox{}
  \begin{enumerate}
    \item 令 $C\in \mathcal{A}\otimes \mathcal{B}$，那么
    对于任意 $x\in E$，$C_x\in \mathcal{B}$，
    对于任意 $y\in F$，$C^y\in \mathcal{A}$。
    \item 令 $(G,\mathcal{G})$ 是可测空间，$f:E\times F\to G$
    是可测函数，那么对于任意 $x\in E$，$f_x:F\to G$ 是可测的，
    对于任意 $y\in F$，$f^y:E\to G$ 是可测的。
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 对于 $x\in E$，令
  \[
    \mathcal{C}  =\{C\in \mathcal{A}\otimes \mathcal{B}\,|\, C_x\in \mathcal{B}\},
  \]
  那么不难验证 $\mathcal{C}$ 是一个 $\sigma$-域且包含所有的可测矩形，
  于是 $\mathcal{C}=\mathcal{A}\otimes \mathcal{B}$，
  即表明对于任意 $C\in \mathcal{A}\otimes \mathcal{B}$ 都有 $C_x\in \mathcal{B}$。
  $C^y\in \mathcal{A}$ 同理。

  (2) 对于 $x\in E$，任取 $D\in \mathcal{G}$，有
  \[
    f_x^{-1}(D)=\bigl(f^{-1}(D)\bigr)_x \in \mathcal{B}.\qedhere
  \]
\end{proof}


\section{积测度}

\begin{theorem}\label{thm:product measure}
  令 $\mu$ 和 $\nu$ 分别是 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$
  上的 $\sigma$-有限测度，那么
  \begin{enumerate}
    \item 存在唯一的 $(E\times F,\mathcal{A}\otimes \mathcal{B})$
    上的测度 $m$，使得对于每个 $A\in \mathcal{A},B\in \mathcal{B}$，都有
    \[
      m(A\times B)=\mu(A)\nu(B),  
    \]
    约定 $0\times \infty=0$。测度 $m$ 也是 $\sigma$-有限的，
    记为 $m=\mu\otimes\nu$。
    \item 对于每个 $C\in \mathcal{A}\otimes \mathcal{B}$，函数
    $x\mapsto \nu(C_x)$ 是 $\mathcal{A}$-可测的，
    $y\mapsto \mu(C^y)$ 是 $\mathcal{B}$-可测的，并且我们有
    \[
      \mu\otimes \nu(C)=\int_E \nu(C_x)\mu(\d x)=\int_F\mu(C^y)\nu(\d y).  
    \]
  \end{enumerate}
\end{theorem}
\begin{proof}
  我们首先说明这样的测度 $m$ 一定是唯一的。我们使用 \autoref{coro:uniqueness of measure}
  说明唯一性。若测度 $m'$ 也满足性质 (1)。首先所有可测矩形对有限交封闭且生成 $\mathcal{A}\otimes \mathcal{B}$，
  并且 $m$ 和 $m'$ 在可测矩形上取值相同。$\mu$ 是 $\sigma$-有限的表明存在
  递增的可测子集 $(A_n)_{n\in \mathbb{N}}$ 使得 $\bigcup_{n\in \mathbb{N}}A_n=E$
  并且 $\mu(A_n)$ 有限。同理存在递增的可测子集 $(B_n)_{n\in \mathbb{N}}$ 
  使得 $\bigcup_{n\in \mathbb{N}}B_n=F$ 并且 $\nu(B_n)$ 有限。
  令 $G_n=A_n\times B_n$，那么 $G_n\subseteq G_{n+1}$ 并且
  $E\times F=\bigcup_{n\in \mathbb{N}}G_n$，此时
  \[
    m'(G_n)=\mu(A_n)\nu(B_n)=m(G_n)<\infty,  
  \] 
  所以 \autoref{coro:uniqueness of measure} 表明 $m=m'$。

  然后我们说明存在性。对于 $C\in \mathcal{A}\otimes \mathcal{B}$，定义
  \begin{equation}\label{eq:def of product measure}
    m(C) =\int_E\nu(C_x)\mu(\d x).
  \end{equation}
  对于任意 $x\in E$，有 $C_x\in \mathcal{B}$，所以 $\nu(C_x)$
  是良好定义的。下面我们证明 $x\mapsto \nu(C_x)$ 是可测函数。
  \begin{enumerate}[label=(\arabic*)]
    \item 首先假设 $\nu$ 是有限测度。
    令 $\mathcal{G}=\{C\in \mathcal{A}\otimes \mathcal{B}\,|\, \text{$x\mapsto \nu(C_x)$ 可测}\}$。
    那么对于可测矩形 $A\times B\in \mathcal{A}\otimes \mathcal{B}$，有
    $\nu((A\times B)_x)=\indicator{A}(x)\nu(B)$，此时 $x\mapsto \indicator{A}(x)\nu(B)$
    当然是可测函数。故 $\mathcal{G}$ 包含所有的可测矩形。
    其次，我们证明 $\mathcal{G}$ 是一个单调类。如果 $C,C'\in \mathcal{G}$
    且 $C\subseteq  C'$，那么利用 $\nu$ 的有限性，就有
    \[
      \nu\bigl((C'\smallsetminus C)_x\bigr)  
      =\nu(C'_x \smallsetminus C_x)=\nu(C_x')-\nu(C_x),
    \]
    所以 $x\mapsto \nu\bigl((C'\smallsetminus C)_x\bigr)$ 是可测函数，
    即 $C' \smallsetminus C\in \mathcal{G}$。如果 $(C_n)_{n\in \mathbb{N}}$
    是 $\mathcal{G}$ 中的一个递增序列，那么
    \[
      \nu\biggl(\biggl(\bigcup_{n\in \mathbb{N}}C_n\biggr)_x\biggr)  
      =\nu\biggl(\bigcup_{n\in \mathbb{N}}(C_n)_x\biggr)
      =\ulim[n\to\infty]\nu((C_n)_x),
    \] 
    而 $x\mapsto \ulim \nu((C_n)_x)$ 是可测函数，所以 $\bigcup_{n\in \mathbb{N}}C_n\in \mathcal{G}$。
    这就表明 $\mathcal{G}$ 是单调类。由于 $\mathcal{G}$ 包含可测矩形，可测矩形对有限交封闭，
    根据单调类定理，所以 $\mathcal{G}$ 是 $\sigma$-域，所以 $\mathcal{G}=\mathcal{A}\otimes \mathcal{B}$，
    这表明对于任意 $C\in \mathcal{A}\otimes \mathcal{B}$，$x\mapsto \nu(C_x)$ 都是可测函数。
    \item 然后假设 $\nu$ 是 $\sigma$-有限测度。此时存在 $\mathcal{B}$ 的一列递增
    子集 $(B_n)_{n\in \mathbb{N}}$ 使得 $F=\bigcup_{n\in \mathbb{N}}B_n$
    以及 $\nu(B_n)<\infty$。令 $\nu_n$ 表示测度 $\nu$ 在 $B_n$ 上的限制，那么
    根据上面的叙述，任取 $C\in \mathcal{A}\otimes \mathcal{B}$，函数 $x\mapsto \nu_n(C_x)$ 是可测函数。
    注意到
    \[
      \nu(C_x)=\nu\biggl(\bigcup_{n\in \mathbb{N}}(C_x\cap B_n)\biggr)  
      =\ulim[n\to\infty] \nu_n(C_x),
    \]
    所以 $x\mapsto \ulim \nu(C_x)$ 是可测函数。
  \end{enumerate}

  于是我们证明了 $x\mapsto \nu(C_x)$ 是可测函数，这表明定义 \eqref{eq:def of product measure}
  式是有意义的。下面我们验证 $m$ 满足测度的条件。显然 $m(\emptyset)=0$。
  任取 $(C_n)_{n\in \mathbb{N}}$ 是 $\mathcal{A}\otimes \mathcal{B}$
  中的一列不相交的子集，那么
  \begin{align*}
    m\biggl(\bigcup_{n\in \mathbb{N}}C_n\biggr)&=\int_E
    \nu\biggl(\bigcup_{n\in \mathbb{N}}(C_n)_x\biggr)\mu(\d x)
    =\int_E\sum_{n\in \mathbb{N}}\nu((C_n)_x)\mu(\d x)\\
    &=\sum_{n\in \mathbb{N}}\int_E\nu((C_n)_x)\mu(\d x)
    =\sum_{n\in \mathbb{N}}m(C_n),
  \end{align*}
  其中第三个等号利用了单调收敛定理。这就表明 $m$ 确实是一个测度。

  对于可测矩形 $A\times B\in \mathcal{A}\otimes \mathcal{B}$，有
  \[
    m(A\times B)=\int_E\nu((A\times B)_x)\mu(\d x)
    =\int_E\nu(B)\indicator{A}(x)\mu(\d x)  
    =\mu(A)\nu(B),
  \]
  所以这样的 $m$ 是唯一的。对于 $C\in \mathcal{A}\otimes \mathcal{B}$，定义
  \begin{equation*}
    m'(C) =\int_F\mu(C^y)\nu(\d y),
  \end{equation*}
  重复上面的过程，可以证明 $m'$ 满足和 $m$ 相同的性质，所以 $m=m'$。
\end{proof}

\section{Fubini 定理}

考虑可测空间 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$。

\begin{theorem}[Fubini-Tonelli]\label{thm:Fubini-Tonelli}
  令 $\mu$ 和 $\nu$ 分别是 $(E,\mathcal{A})$ 和 $(F,\mathcal{B})$ 上的两个
  $\sigma$-有限的测度。令 $f:E\times F\to [0,\infty]$ 是可测函数。
  \begin{enumerate}
    \item 函数
    \[
      E\ni x\mapsto \int_F f(x,y)\nu(\d y),\quad 
      F\ni y\mapsto \int_E f(x,y)\mu(\d x)  
    \]
    是值在 $[0,\infty]$ 中的可测函数。
    \item 我们有
    \[
      \int_{E\times F}f\d\mu\otimes\nu 
      =\int_E\left(\int_F f(x,y)\nu(\d y)\right)\mu(\d x)=\int_F
      \left(\int_E f(x,y)\mu(\d x)\right)\nu(\d y).
    \]
  \end{enumerate}
\end{theorem}
\begin{proof}
  (1) 设 $f=\ulim f_n$，$(f_n)_{n\in \mathbb{N}}$ 是一列递增的非负简单函数，
  那么根据单调收敛定理，有
  \[
    \int_F f(x,y)\nu(\d y)=\ulim[n\to\infty]\int_Ff_n(x,y)\nu(\d y)  ,
  \]
  所以我们只需要说明对于任意非负简单函数 $h$，$x\mapsto \int_F h(x,y)\nu(\d y)$
  可测即可。对于示性函数 $\indicator{C}$，有
  $\int_F \indicator{C}(x,y) \nu(\d y)=\nu(C_x)$，\autoref{thm:product measure}
  表明 $x\mapsto \nu(C_x)$ 是可测的，再根据线性性，这就说明了
  $x\mapsto \int_F h(x,y)\nu(\d y)$ 可测。
  对于 $x\mapsto\int_E f(x,y)\mu(\d x)$ 同理。

  (2) 设 $f=\ulim f_n$，$(f_n)_{n\in \mathbb{N}}$ 是一列递增的非负简单函数，
  那么根据单调收敛定理，有
  \[
    \int_{E\times F} f\d\mu\otimes \nu
    =\ulim[n\to\infty]\int_{E\times F}f_n(x,y)\nu(\d y),  
  \]
  所以只需要证明结论对于非负简单函数成立即可。根据线性性，只需要证明结论对
  示性函数成立即可。任取示性函数 $\indicator{C}$，根据 \autoref{thm:product measure}，有
  \[
    \int_{E\times F} \indicator{C}\d\mu\otimes\nu=
    \mu\otimes \nu(C)=\int_E\nu(C_x)\mu(\d x)  
    =\int_E\left(\int_F \indicator{C}(x,y)\nu(\d y)\right)\mu(\d x),
  \]
  另一个等式同理。
\end{proof}

\autoref{thm:Fubini-Tonelli} 也可以推广到任意符号的版本。

\begin{theorem}[Fubini-Lebesgue]
  令 $f\in \mathcal{L}^1(E\times F,\mathcal{A}\otimes \mathcal{B},\mu\otimes\nu)$，那么
  \begin{enumerate}
    \item $\alev{\mu(\d x)}$，函数 $y\mapsto f(x,y)$ 属于 $\mathcal{L}^1(F,\mathcal{B},\nu)$。
    $\alev{\nu(\d y)}$，函数 $x\mapsto f(x,y)$ 属于 $\mathcal{L}^1(E,\mathcal{A},\mu)$。
    \item 函数 $x\mapsto \int_F f(x,y)\nu(\d y)$ 属于 $\mathcal{L}^1(E,\mathcal{A},\mu)$。
    函数 $y\mapsto \int_E f(x,y)\mu(\d x)$ 属于 $\mathcal{L}^1(F,\mathcal{B},\nu)$。
    \item 我们有
    \[
      \int_{E\times F}f\d\mu\otimes\nu 
      =\int_E\left(\int_F f(x,y)\nu(\d y)\right)\mu(\d x)=\int_F
      \left(\int_E f(x,y)\mu(\d x)\right)\nu(\d y).
    \]
  \end{enumerate}
\end{theorem}





\part{概率论}

\chapter{概率论基础}

\section{一般定义}

\subsection{概率空间}

令 $(\Omega,\mathcal{A})$ 是可测空间，$\mathbb{P}$ 是 $(\Omega,\mathcal{A})$
上的概率测度，我们说 $(\Omega,\mathcal{A},\mathbb{P})$ 是\emph{概率空间}。

因此，概率空间是测度空间的一个特例。然而，概率论的观点与测度论有很大不同。在概率论中，
我们的目标是一个“随机实验”的数学模型：
\begin{itemize}[nosep]
  \item $\Omega$ 表示实验的所有可能的结果的集合。
  \item $\mathcal{A}$ 是所有“事件”的集合。这里的事件指的是 $\Omega$ 的一个子集，其概率
  可以被计算(也就是可测集)。我们应当把事件 $A$ 视为满足某一属性的所有 $\omega\in\Omega$ 
  构成的子集。
  \item 对于每个 $A\in \mathcal{A}$，$\mathbb{P}(A)$ 表示事件 $A$ 发生的概率。
\end{itemize}

当然，一个自然的疑问是，为什么需要考虑事件域 $\mathcal{A}$？换句话说，为什么不能对
$\Omega$ 的任意子集都计算一个概率？原因在于，一般不可能在 $\Omega$ 的幂集 $\mathcal{P}(\Omega)$
上定义我们感兴趣的概率测度(除开 $\Omega$ 是可数集这一简单情况)。例如，取 $\Omega=[0,1]$，
配备 Borel $\sigma$-域和 Lebesgue 测度，但是，可以证明不可能将 Lebesgue 测度扩展到
$[0,1]$ 的任意子集上使得其仍然满足测度的定义。

\begin{example}\label{exa:dice model}
  一些常见的概率模型。
  \begin{enumerate}
    \item 考虑扔两次骰子这一实验，那么
    \[
      \Omega=\{1,2,\dots,6\}^2,\quad \mathcal{A}=\mathcal{P}(\Omega),\quad
      \mathbb{P}(A)=\frac{\card(A)}{36}.
    \]
    这里概率 $\mathbb{P}$ 的选取意味着让所有结果都有相同的概率。更一般地，如果 $\Omega$
    是有限集，$\mathcal{A}=\mathcal{P}(\Omega)$，概率测度 $\mathbb{P}(\{\omega\})=1/\card(\Omega)$
    被称为 $\Omega$ 上的\emph{均匀概率测度}。
    \item 现在我们考虑实验：扔骰子，直到出现 $6$ 为止。由于得到 $6$ 所需的投掷次数是无界的
    (即使你扔了 $1000$ 次骰子，仍有可能没有得到 $6$)，所以 $\Omega$ 的正确选择是想象
    我们扔了无限次骰子：
    \[
      \Omega=\{1,2,\dots,6\}^{\mathbb{N}}.
    \]
    $\Omega$ 上的 $\sigma$-域 $\mathcal{A}$ 被定义为包含形如
    \[
      \{\omega\in\Omega\,|\, \omega_1=i_1,\dots,\omega_n=i_n\}
    \]
  \end{enumerate}
\end{example}

与测度论类似，零测集也会出现在概率论的很多叙述中，如果某个
命题对于某个概率为 $1$ 的事件中的每个 $\omega\in\Omega$ 都成立，那么
我们说这个命题\emph{几乎肯定}成立，用缩写 a.s. 表示。


\subsection{随机变量}

在本章的剩余部分，我们都考虑一个概率空间 $(\Omega,\mathcal{A},\mathbb{P})$，并且所有
随机变量都将在这个概率空间上定义。

\begin{definition}
  令 $(E,\mathcal{E})$ 是可测空间，值在 $E$ 中的\emph{随机变量}指的是一个可测映射
  $X:\Omega\to E$。
\end{definition}

\begin{example}
  回顾 \eqref{exa:dice model} 中的模型。
  \begin{enumerate}
    \item $X((i,j))=i+j$ 定义了值在 $\{2,3,\dots,12\}$ 中的随机变量。
    \item $X(\omega)=\inf\{j\,|\, \omega_j=6\}$，约定 $\inf \emptyset=\infty$，
    定义了值在 $\bar{\mathbb{N}}=\mathbb{N}\cup\{\infty\}$ 中的随机变量。为了验证
    $X$ 的可测性，只需要注意到
    \[
      X^{-1}(\{k\})=\{\omega\in\Omega\,|\, \omega_1\neq 6,\dots,\omega_{k-1}\neq 6,\omega_k=6\}.
    \]
  \end{enumerate}
\end{example}

\begin{definition}
  令 $X$ 是值在 $(E,\mathcal{E})$ 中的随机变量，定义随机变量 $X$ 的
  \emph{分布律} $\mathbb{P}_X$ 是概率测度 $\mathbb{P}$ 在 $X$ 下的推前。
  也就是说，$\mathbb{P}_X$ 是 $(E,\mathcal{E})$ 上的概率测度，满足
  \[
    \mathbb{P}_X(B)=\mathbb{P}(X^{-1}(B)),\quad \forall B\in \mathcal{E}.
  \]
  两个值在 $(E,\mathcal{E})$ 中的随机变量 $Y,Y'$ 如果有相同的分布
  $\mathbb{P}_Y=\mathbb{P}_{Y'}$，那么我们说 $Y$ 和 $Y'$ 是\emph{同分布}的。
\end{definition}

在概率论中，我们通常将 $\mathbb{P}_X(B)$ 写为 $\mathbb{P}(X\in B)$
而不是 $\mathbb{P}(X^{-1}(B))$。这里 $X\in B$ 是集合
$\{\omega\in\Omega\,|\, X(\omega)\in B\}$ 的简写，这是一个一般性
的简写规则，在概率论中参数 $\omega$ 通常被隐藏。

\paragraph{离散型随机变量}
当 $E$ 是有限或者可数($\mathcal{E}=\mathcal{P}(E)$)的时候，
$X$ 的分布是点测度，这是因为
\[
  \mathbb{P}_X(B)=\mathbb{P}(X\in B)=\mathbb{P}\biggl(\bigcup_{x\in B}\{X=x\}\biggr)
  =\sum_{x\in B}\mathbb{P}(X=x)=\sum_{x\in E}p_x\delta_x(B),
\]
其中 $p_x=\mathbb{P}(X=x)$。这就表明
\[
  \mathbb{P}_X=\sum_{x\in E}p_x\delta_x 
\]
是 $E$ 上的点测度。

\begin{example}
  我们考虑 \eqref{exa:dice model} 中的第二个例子，随机变量
  为 $X(\omega)=\inf\{j\,|\,\omega_j=6\}$。那么
  \begin{align*}
    \mathbb{P}(X=k)&=\mathbb{P}
    \biggl(\bigcup_{1\leq i_1,\dots,i_k\leq 5}\{\omega\,|\, 
    \omega_1=i_1,\dots,\omega_{k-1}=i_{k-1},\omega_k=6\}\biggr)\\
    &=5^{k-1}\left(\frac{1}{6}\right)^k=\frac{1}{6}\left(\frac{5}{6}\right)^{k-1}.
  \end{align*}
  注意到
  \[
    \sum_{k=1}^\infty \mathbb{P}(X=k)=\frac{1}{6}\frac{1}{1-\frac{5}{6}}=1
  \]
  并且 $\{X=\infty\}\cup\bigcup_{k=1}^\infty \{X=k\}=\Omega$，所以
  \[
    \mathbb{P}(X=\infty)=1-\sum_{k=1}^\infty \mathbb{P}(X=k)=0,
  \]  
  但是 $\{X=\infty\}\neq\emptyset$。
\end{example}

\paragraph{具有密度的随机变量} $\mathbb{R}^d$ 上的密度函数是一个非负的 Borel 函数
$p:\mathbb{R}^d\to \mathbb{R}_+$，其满足 
\[
  \int_{\mathbb{R}^d} p(x)\d x=1.
\]
对于一个值在 $\mathbb{R}^d$ 中的随机变量 $X$，如果存在密度 $p$ 使得
\[
  \mathbb{P}_X(B)=\int_B p(x)\d x
\]
对于任意 Borel 子集 $B$ 都成立，那么我们说 $X$ 有密度函数 $p$。
换句话说，$p$ 是 $\mathbb{P}_X$ 相对于 Lebesgue 测度 $\lambda$ 的密度
(\autoref{coro:density of measure})，
也记为 $\mathbb{P}_X(\d x)=p(x)\lambda(\d x)=p(x)\d x$。

注意到密度 $p$ 实际上是在相差一个 Lebesgue 零测集的意义下由 $\mathbb{P}_X$ 确定的。
在我们遇到的大多数例子中，$p$ 在 $\mathbb{R}^d$ 上连续，在这种情况下，$p$ 由
$\mathbb{P}_X$ 唯一确定。

在 $d=1$ 的时候，我们有
\[
  \mathbb{P}(\alpha\leq X\leq \beta)=\int_{\alpha}^\beta p(x)\d x.
\]

\subsection{数学期望}

\begin{definition}
  令 $X$ 是定义在 $(\Omega,\mathcal{A},\mathbb{P})$ 上的实随机变量，我们定义
  \[
    \mathbb{E}[X]=\int_\Omega X(\omega)\mathbb{P}(\d\omega)=\int X\d \mathbb{P},
  \]
  只要上述积分有意义，我们就说 $\mathbb{E}[X]$ 是 $X$ 的\emph{期望}。
\end{definition}

根据前面的内容，上述积分有意义的条件为下列二者之一：
\begin{itemize}[nosep]
  \item $X\geq 0$，此时 $\mathbb{E}[X]\in [0,\infty]$。
  \item $X$ 符号任意，但是 $\mathbb{E}[|X|]=\int|X| \d \mathbb{P}<\infty$。
\end{itemize}


上面的定义可以拓展到多元随机变量 $X=(X_1,\dots,X_d)\in \mathbb{R}^d$，
此时我们定义 $\mathbb{E}[X]=\bigl(\mathbb{E}[X_1],\dots,\mathbb{E}[X_d]\bigr)$。
类似的，如果 $M$ 是随机矩阵(值在实矩阵空间中的随机变量)，我们可以定义
矩阵 $\mathbb{E}[M]$ 为对 $M$ 的每个分量求期望构成的矩阵。

注意到若 $X=\mathbold 1_B$，那么
\[
  \mathbb{E}[X]=\int\mathbold 1_B \d \mathbb{P}=\mathbb{P}(B).
\]

对于一些特殊的随机变量，下面的命题被频繁地使用。

\begin{proposition}
  令 $X$ 是值在 $[0,\infty]$ 中的随机变量，那么
  \[
    \mathbb{E}[X]=\int_0^\infty \mathbb{P}(X\geq x) \d x.
  \]
  令 $Y$ 是值在 $\mathbb{Z}_+$ 中的随机变量，那么
  \[
    \mathbb{E}[Y]=\sum_{k=0}^\infty k \mathbb{P}(X=k)=\sum_{k=1}^\infty \mathbb{P}(Y\geq k).
  \]
\end{proposition}
\begin{proof}
  根据 Fubini 定理，我们有
  \[
    \mathbb{E}[X]=\mathbb{E}\left[
      \int_0^\infty \mathbold 1_{\{x\leq X\}}\d x
    \right]=\int_0^\infty \mathbb{E}[\mathbold 1_{\{x\leq X\}}] \d x
    =\int_0^\infty \mathbb{P}(X\geq x) \d x.
  \]
  对于随机变量 $Y$，我们有
  \[
    \mathbb{E}[Y]=\mathbb{E}\left[
      \sum_{k=0}^\infty k\mathbold 1_{\{Y=k\}}
    \right]=\int \biggl(\sum_{k=0}^\infty k\mathbold 1_{\{Y=k\}}\biggr)\d \mathbb{P}
    =\sum_{k=0}^\infty k \mathbb{P}(Y=k).
  \]
  对于第二个等式，只需注意到
  \[
    Y=\sum_{k=1}^\infty \mathbold 1_{\{Y\geq k\}}.\qedhere
  \]
\end{proof}

下面的命题是 \autoref{prop:change variable} 的特例，由于其结果十分重要，所以我们再次叙述一遍。

\begin{proposition}\label{prop:use law to calculate exception}
  令 $X$ 是值在 $(E,\mathcal{E})$ 中的随机变量，对于任意可测函数 $f:E\to [0,\infty]$，
  我们有
  \[
    \mathbb{E}[f(X)]=\int_\Omega f(X(\omega)) \mathbb{P}(\d\omega)=\int_E f(x) \mathbb{P}_X(\d x).
  \]
\end{proposition}

如果可测函数 $f:E\to \mathbb{R}$，上面的命题在两端有意义的情况下也是成立的，
即 $\mathbb{E}[|f(X)|]<\infty$ 的时候。特别地，如果 $X$ 是实值随机变量
且使得 $\mathbb{E}[|X|]<\infty$，那么有
\[
  \mathbb{E}[X]  =\int_{\Omega} X(\omega)\mathbb{P}(\d\omega)
  =\int_{\mathbb{R}} x \mathbb{P}_X(\d x).
\]

\autoref{prop:use law to calculate exception} 告诉我们可以使用
分布 $\mathbb{P}_X$ 来计算 $f(X)$ 的期望。实际上这个过程可以倒过来，
如果我们能找到 $E$ 上的测度 $\nu$ 使得
\[
  \mathbb{E}[f(X)]=\int f\d\nu,  
\]
其中 $f:E\to \mathbb{R}$ 是任意示性函数，此时对于任意
$E$ 的可测子集 $A$，有
\[
  \mathbb{P}_X(A)=\int \indicator{A} \d \mathbb{P}_X=\mathbb{E}[\indicator{A}(X)]=  \int \indicator{A}\d\nu=\nu(A),
\]
所以分布 $\mathbb{P}_X=\nu$。下面的命题应用了这样的思想。

\begin{proposition}\label{prop:margin pdf}
  令 $X=(X_1,\dots,X_d)$ 是值在 $\mathbb{R}^d$ 中的随机变量，假设
  $X$ 有密度 $p(x_1,\dots,x_d)$。那么，对于任意 $1\leq j\leq d$，
  $X_j$ 的密度为
  \[
    p_j(x)=\int_{\mathbb{R}^{d-1}}p(x_1,\dots,x_{j-1},x,x_{j+1},\dots,x_d)
    \d x_1\cdots \d x_{j-1}\d x_{j+1}\cdots \d x_d.  
  \]
\end{proposition}
\begin{proof}
  记 $\pi_j$ 是投影函数 $\pi_j(x_1,\dots,x_d)=x_j$。对于任意的
  Borel 函数 $f:\mathbb{R}\to \mathbb{R}_+$，根据 Fubini 定理，有
  \begin{align*}
    \mathbb{E}[f(X_j)]&=\mathbb{E}[f\circ\pi_j(X)]\\
    &=\int_{\mathbb{R}^d}f(\pi_j(x)) \mathbb{P}_X(\d x)\\
    &=\int_{\mathbb{R}^d}f(x_j)p(x_1,\dots,x_d) \d x_1\cdots\d x_d \\
    &=\int_{\mathbb{R}}f(x_j)\left(
      \int_{\mathbb{R}^{d-1}}p(x_1,\dots,x_d)\d x_1\cdots
      \d x_{j-1}\d x_{j+1}\cdots \d x_d
    \right)\d x_j\\
    &=\int_{\mathbb{R}}f(x_j)p_j(x_j)\d x_j
    =\int_{\mathbb{R}}f(x_j) \mathbb{P}_{X_j}(\d x_j),
  \end{align*}
  这就表明对于任意 Borel 子集 $A$ 有
  \[
    \mathbb{P}_{X_j}(A)=\int_A p_j(x_j)\d x_j,  
  \]
  即 $X_j$ 有密度函数 $p_j$。 
\end{proof}

如果 $X=(X_1,\dots,X_d)$ 是值在 $\mathbb{R}^d$ 中的随机变量，那么
概率测度 $\mathbb{P}_{X_j}$ 被称为 $X$ 的\emph{边缘分布}，分布律
$\mathbb{P}_{X_j}$ 由 $\mathbb{P}_X$ 完全决定：$\mathbb{P}_{X_j}$
就是 $\mathbb{P}_X$ 在投影 $\pi_j$ 下的推前。需要注意反之不是正确的，
也就是说即使确定了所有的边缘分布 $\mathbb{P}_{X_1},\dots,\mathbb{P}_{X_j}$，
也不能确定 $\mathbb{P}_X$。
 

\subsection{经典分布}

本小节我们列举一些重要的概率分布。

\paragraph{离散分布}
\begin{enumerate}
  \item \emph{均匀分布}。如果 $E$ 是有限集，值在 $E$ 中的随机变量
  $X$ 如果满足
  \[
    \mathbb{P}(X=x)=\frac{1}{\card(E)},\quad \forall x\in E,  
  \]
  那么我们说 $X$ 是 $E$ 上的均匀分布。
  \item \emph{参数 $\mathbold{p\in[0,1]}$ 的 Bernoulli 分布}。如果值在
  $\{0,1\}$ 中的随机变量 $X$ 满足
  \[
    \mathbb{P}(X=1)=p,\quad \mathbb{P}(X=0)=1-p,  
  \]
  那么我们说 $X$ 是 $E$ 上参数 $p$ 的 Bernoulli 分布。
  \item \emph{二项分布 $\mathbold{\mathcal{B}(n,p)\ (n\in \mathbb{N},p\in[0,1])}$}。
  如果值在 $\{0,1,\dots,n\}$ 中的随机变量 $X$ 满足
  \[
    \mathbb{P}(X=k)=\binom{n}{k}p^k(1-p)^{n-k} ,\quad \forall k\in\{0,1,\dots,n\} ,
  \]
  那么我们说 $X$ 是 $E$ 上的二项分布。
  \item \emph{参数 $\mathbold{p\in(0,1)}$ 的几何分布}。如果
  值在 $\mathbb{Z}_+$ 中的随机变量 $X$ 使得
  \[
    \mathbb{P}(X=k)=(1-p)p^k  ,\quad k\in \mathbb{Z}_+,
  \]
  那么我们说 $X$ 是 $E$ 上参数 $p$ 的几何分布。
  \item \emph{参数 $\mathbold{\lambda>0}$ 的 Poisson 分布}。
  如果值在 $\mathbb{Z}_+$ 中的随机变量 $X$ 使得
  \[
    \mathbb{P}(X=k)=\frac{\lambda^k}{k!}e^{-\lambda},\quad\forall k\in \mathbb{Z}_+,  
  \]
  那么我们说 $X$ 是 $E$ 上参数 $\lambda$ 的 Poisson 分布。容易计算
  \[
    \mathbb{E}[X]=\sum_{k=0}^\infty k \mathbb{P}(X=k)=
    \sum_{k=1}  ^\infty \frac{\lambda^k}{(k-1)!}e^{-\lambda}=\lambda,
  \]
  Poisson 分布在实际应用中非常重要，通常被用于建模某个“罕见事件”
  在长时间段内发生的次数。准确的数学叙述是 Poisson 分布是
  二项分布的近似。对于每个 $n\geq 1$，记 $X_n$ 为服从二项分布
  $\mathcal{B}(n,p_n)$ 的随机变量，如果在 $n\to\infty$ 的时候
  有 $np_n\to\lambda$，那么对于每个 $k\in \mathbb{N}$，有
  \[
    \lim_{n\to\infty} \mathbb{P}(X_n=k)=
    \frac{\lambda^k}{k!}e^{-\lambda}.
  \]
  这可以解释为，如果每天有很小的概率 $p_n\approx\lambda/n$
  发生地震，那么地震在 $n$ 天内发生的次数将近似服从泊松分布。
\end{enumerate}

\paragraph{连续分布}
在下面的五个例子中，$X$ 都指的是一个有密度 $p$ 的实值随机变量。
\begin{enumerate}
  \item \emph{$\mathbold{[a,b]}$ 上的均匀分布}：
  \[
    p(x)=\frac{1}{b-a}\indicator{[a,b]}(x).  
  \]
  \item \emph{参数 $\mathbold{\lambda>0}$ 的指数分布}：
  \[
    p(x)=\lambda e^{-\lambda x}\indicator{\mathbb{R}_+}(x),  
  \]
  此时对于 $a\geq 0$，有
  \[
    \mathbb{P}(X\geq a)=\int_a^\infty p(x)\d x=
    e^{-\lambda a}.  
  \]
  这表明指数分布有下面的重要性质：对于 $a,b\geq 0$，有
  \begin{equation}
    \mathbb{P}(X\geq a+b)=\mathbb{P}(X\geq a)\mathbb{P}(X\geq b).
  \end{equation}
  \item \emph{Gamma 分布 $\mathbold{\Gamma(a,\lambda)\ (a>0,\lambda>0)}$}：
  \[
    p(x)=\frac{\lambda^a}{\Gamma(a)}x^{a-1}e^{-\lambda x}\indicator{\mathbb{R}_+}(x),  
  \]
  这是指数分布的推广，$a=1$ 时即指数分布。
  \item \emph{参数 $\mathbold{a>0}$ 的 Cauchy 分布}：
  \[
    p(x)=\frac{1}{\pi}\frac{a}{a^2+x^2} , 
  \]
  注意到服从 Cauchy 分布的随机变量的数学期望是不存在的，因为
  \[
    \mathbb{E}[|X|]=\int_{-\infty}^{\infty}\frac{1}{\pi}\frac{a|x|}{a^2+x^2}\d x=\infty.  
  \]
  \item \emph{正态分布 $\mathbold{\mathcal{N}(m,\sigma^2)\ (m\in \mathbb{R},\sigma>0)}$}：
  \[
    p(x)=\frac{1}{\sigma\sqrt{2\pi}}\exp\left(-\frac{(x-m)^2}{2\sigma^2}\right)  .
  \]
  正态分布与 Poisson 分布一起成为概率论中最重要的两个分布。正态分布
  的密度曲线呈著名的钟形曲线。按定义很容易验证
  \[
    m=\mathbb{E}[X],\quad \sigma^2 =\mathbb{E}[(X-m)^2]. 
  \]

  对于 $a,b\in \mathbb{R}$，考虑随机变量 $Y=aX+b$，那么
  对于任意的 Borel 函数 $f:\mathbb{R}\to \mathbb{R}_+$，有
  \begin{align*}
    \mathbb{E}[f(Y)]&=\mathbb{E}[f(aX+b)]=\int_{\mathbb{R}}f(ax+b)\mathbb{P}_X(\d x)\\
    &=\int_{\mathbb{R}}f(ax+b)p(x)\d x
    =\frac{1}{a}\int_{\mathbb{R}}f(y)p\left(\frac{y-b}{a}\right)\d y\\
    &=\int_{\mathbb{R}}f(y)\frac{1}{a}p\left(\frac{y-b}{a}\right)\d y, 
  \end{align*}
  这表明
  \[
    p(y)=\frac{1}{a\sigma\sqrt{2\pi}}\exp\left(-\frac{(y-(am+b))^2}{2(a\sigma)^2}\right),
  \]
  即 $aX+b$ 服从分布 $\mathcal{N}(am+b,a^2\sigma^2)$。
\end{enumerate}

\subsection{实值随机变量的分布函数}

令 $X$ 是实值随机变量，定义 $X$ 的\emph{分布函数}为 $F_X:\mathbb{R}\to [0,1]$，
其满足
\[
  F_X(t)=\mathbb{P}(X\leq t)=\mathbb{P}_X((-\infty,t]),\quad \forall t\in \mathbb{R}.  
\]
根据 \autoref{coro:uniqueness of measure}，$F_X$ 实际上完全刻画了分布 $\mathbb{P}_X$。
确切的说，如果知道了 $F_X$，即相当于知道了所有 $\mathbb{P}_X((-\infty,t])$ 的值，
而所有区间 $(-\infty,t]$ 构成的子集族对有限交封闭，又因为 $\mathbb{P}_X$
为有限测度，所以 $\mathbb{P}_X$ 在所有区间 $(-\infty,t]$ 上的值可以完全
确定 $\mathbb{P}_X$ 在 $\mathcal{B}(\mathbb{R})$ 上的值。

显然函数 $F_X$ 是递增的、右连续的并且在 $-\infty$ 处极限为 $0$、
在 $+\infty$ 处极限为 $1$。反之，如果 $F:\mathbb{R}\to [0,1]$ 满足
上面的性质，定理 ？表明存在(唯一的) $\mathbb{R}$ 上的概率测度
$\mu$ 使得 $\mu((-\infty,t])=F(t)$。即这样的函数 $F$ 总能
解释为某个实值随机变量的分布函数。

令 $F_X(a-)$ 表示 $F_X$ 在 $a\in \mathbb{R}$ 处的左极限。那么
容易验证
\begin{align*}
  \mathbb{P}(a\leq X\leq b)&=F_X(b)-F_X(a-),\\
  \mathbb{P}(a<X<b)&=F_X(b-)-F_X(a).
\end{align*}
特别的，$\mathbb{P}(X=a)=F_X(a)-F_X(a-)$。这表明 $F_X$ 的间断点的个数
恰为 $\mathbb{P}_X$ 的原子个数。

\subsection{由随机变量生成的 $\sigma$-域}

\begin{proposition}\label{prop:sigmaX-measurable}
  令 $X$ 是值在 $(E,\mathcal{E})$ 中的随机变量，$Y$ 是实值随机变量，
  那么下面的说法等价：
  \begin{enumerate}
    \item $Y$ 是 $\sigma(X)$-可测的；
    \item 存在 $(E,\mathcal{E})$ 到 $(\mathbb{R},\mathcal{B}(\mathbb{R}))$
    的可测函数 $f$ 使得 $Y=f(X)$。
  \end{enumerate}
\end{proposition}


\section{随机变量的矩}

\subsection{矩和方差}

令 $X$ 是实值随机变量，$p\in \mathbb{N}$。定义 $X$ 的\emph{$p$-阶矩}
为 $\mathbb{E}[X^p]$，其仅在 $X\geq 0$ 或者 $\mathbb{E}[|X|^p]<\infty$
的时候有定义。

因为期望是相对于测度 $\mathbb{P}_X$ 的一种积分，所以我们有下面的结果。
如果 $X$ 是值在 $[0,\infty]$ 中的随机变量，那么我们有
\begin{itemize}[nosep]
  \item $\mathbb{E}[X]<\infty\Rightarrow X<\infty,\ \alsu{\mathbb{P}_X}$
  \item $\mathbb{E}[X]=0\Rightarrow X=0\,\ \alsu{\mathbb{P}_X}$
\end{itemize}
此外，各种极限与积分交换次序的定理也可以直接改写为期望的形式：
\begin{itemize}[nosep]
  \item \emph{单调收敛定理}。如果 $(X_n)_{n\in \mathbb{N}}$ 是一列
  值在 $[0,\infty]$ 中递增的随机变量，那么
  \[
    \ulim[n\to\infty]  \mathbb{E}[X_n]=\mathbb{E}\left[\ulim[n\to\infty]X_n\right].
  \]
  \item \emph{Fatou 引理}。如果 $(X_n)_{n\in \mathbb{N}}$ 是一列
  值在 $[0,\infty]$ 中的随机变量，那么
  \[
    \mathbb{E}[\liminf X_n]\leq \liminf \mathbb{E}[X_n].  
  \]
  \item \emph{控制收敛定理}。如果 $(X_n)_{n\in \mathbb{N}}$ 是一列
  实值随机变量，并且存在值在 $[0,\infty]$ 中的随机变量 $Z$ 使得
  \[
    |X_n|\leq Z,\quad \mathbb{E}[Z]<\infty, \quad X_n\to X,\ 
    \alsu{\mathbb{P}_X}  
  \]
  那么
  \[
    \lim_{n\to\infty}\mathbb{E}[X_n]=\mathbb{E}\left[\lim_{n\to\infty}X_n\right]=\mathbb{E}[X],
    \quad \lim_{n\to\infty}\mathbb{E}[|X_n-X|]=0.
  \]
\end{itemize}

对于每个 $p\in[1,\infty]$，考虑空间 $L^p(\Omega,\mathcal{A},\mathbb{P})$。
H\"older 不等式表明对于任意实值随机变量 $X,Y$，如果 $p,q\in (1,\infty)$
使得 $1/p+1/q=1$，那么
\[
  \mathbb{E}[|XY|]\leq \mathbb{E}[|X|^p]^{1/p}\mathbb{E}[|Y|^q]^{1/q}. 
\]
取 $Y=1$，我们得到 $\norm{X}_1\leq\norm{X}_p$。此外，
如果 $1\leq p<q\leq \infty$，有 $\norm{X}_p\leq \norm{X}_q$，
这也表明 $L^q(\Omega, \mathcal{A},\mathbb{P})\subseteq L^p(\Omega,\mathcal{A},\mathbb{P})$。

Hilbert 空间 $L^2(\Omega,\mathcal{A},\mathbb{P})$ 上的内积定义为
$\langle X,Y\rangle_{L^2}=\mathbb{E}[XY]$，Cauchy-Schwarz 不等式表明
\[
  \mathbb{E}[|XY|]\leq \mathbb{E}[X^2]  ^{1/2}\mathbb{E}[Y^2]^{1/2}.
\]
特别地，我们有
\[
  \mathbb{E}[|X|]^2\leq \mathbb{E}[X^2].  
\]

如果 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，$f:\mathbb{R}\to \mathbb{R}_+$
是凸函数，那么 Jensen 不等式表明 
\[
  \mathbb{E}[f(X)]\geq f(\mathbb{E}[X]).
\]

\begin{definition}
  令 $X\in L^2(\Omega,\mathcal{A},\mathbb{P})$，定义 $X$
  的\emph{方差}为
  \[
    \var(X)=\mathbb{E}\bigl[(X-\mathbb{E}[X])^2\bigr]\geq 0,
  \]
  $X$ 的\emph{标准差}为
  \[
    \sigma_X=\sqrt{\var(X)}.  
  \]
\end{definition}

\begin{proposition}
  令 $X\in L^2(\Omega, \mathcal{A},\mathbb{P})$，方差
  $\var(X)=\mathbb{E}[X^2]-\bigl(\mathbb{E}[X]\bigr)^2$。
  对于任意的 $a\in \mathbb{R}$，有
  \[
    \mathbb{E}[(X-a)^2]=\var(X)+\bigl(\mathbb{E}[X]-a\bigr)  ^2.
  \]
\end{proposition}



\chapter{独立性}

\section{独立事件}

在本章中，我们考虑概率空间 $(\Omega,\mathcal{A},\mathbb{P})$。如果 
$A,B\in \mathcal{A}$ 且
\[
  \mathbb{P}(A\cap B)=\mathbb{P}(A)\mathbb{P}(B),  
\]
那么我们说 $A$ 和 $B$ 是\emph{独立的}。

\section{$\sigma$-域和随机变量的独立性}

如果 $\mathcal{B}\subseteq \mathcal{A}$ 是一个 $\sigma$-域，那么我们说
$\mathcal{B}$ 是 $\mathcal{A}$ 的\emph{子 $\mathbold{\sigma}$-域}。我们可以认为
子 $\sigma$-域 $\mathcal{B}$ 反映了概率空间的部分信息，即 $\mathcal{B}$ 中
发生的事件。例如，如果 $\mathcal{B}=\sigma(X)$，$X$ 是随机变量，那么
$\mathcal{B}$ 反映了 $X$ 的值的信息。这暗示了子 $\sigma$-域的独立性的概念：
我们希望两个子 $\sigma$-域 $\mathcal{B}$ 和 $\mathcal{B}'$ 是独立的当且仅当
它们中的任意两个事件都是独立的。

\begin{definition}
  令 $\mathcal{B}_1,\dots,\mathcal{B}_n$ 是 $\mathcal{A}$ 的 $n$ 个
  $\sigma$-子域，我们说 $\mathcal{B}_1,\dots,\mathcal{B}_n$ 是独立的，如果
  对于任意 $A_1\in \mathcal{B}_1,\dots,A_n\in \mathcal{B}_n$，都有
  \[
    \mathbb{P}(A_1\cap\cdots\cap A_n)=\mathbb{P}(A_1)\cdots \mathbb{P}(A_n).  
  \]
\end{definition}

令 $X_1,\dots,X_n$ 分别是值在 $(E_1,\mathcal{E}_1),\dots,(E_n,\mathcal{E}_n)$
中的随机变量，我们说 $X_1,\dots,X_n$ 是独立的当且仅当
$\sigma(X_1),\dots,\sigma(X_n)$ 是独立的。这等价于
任取 $F_1\in \mathcal{E}_1,\dots,F_n\in \mathcal{E}_n$ 有
\[
  \mathbb{P}(\{X_1\in F_1\}\cap\cdots\cap\{X_n\in F_n\})  
  =\mathbb{P}(X_1\in F_1)\cdots \mathbb{P}(X_n\in F_n).
\]

\begin{theorem}
  令 $X_1,\dots,X_n$ 分别是值在 $(E_1,\mathcal{E}_1),\dots,(E_n,\mathcal{E}_n)$
  中的随机变量。那么 $X_1,\dots,X_n$ 是独立的当且仅当 $(X_1,\dots,X_n)$
  的分布是 $X_1,\dots,X_n$ 的分布的乘积测度，即
  \[
    \mathbb{P}_{(X_1,\dots,X_n)}=\mathbb{P}_{X_1}\otimes\cdots
    \otimes \mathbb{P}_{X_n}.  
  \]
  此外，我们有
  \[
    \mathbb{E}\biggl[\prod_{i=1}^n f_i(X_i)\biggr] =\prod_{i=1}^n \mathbb{E}[f_i(X_i)],
  \]
  其中 $f_i$ 是 $(E_i,\mathcal{E}_i)$ 上的非负可测函数。
\end{theorem}
\begin{proof}
  令 $F_i\in \mathcal{E}_i$，$X_1,\dots,X_n$ 独立当且仅当
  \[
    \mathbb{P}(\{X_1\in F_1\}\cap\cdots\cap\{X_n\in F_n\})  
    =\mathbb{P}(X_1\in F_1)\cdots \mathbb{P}(X_n\in F_n),
  \]
  这表明
  \[ 
    \mathbb{P}_{(X_1,\dots,X_n)}(F_1\times\cdots\times F_n)
    =\mathbb{P}_{X_1}(F_1)\cdots \mathbb{P}_{X_n}(F_n).
  \]
  所以 $\mathbb{P}_{(X_1,\dots,X_n)}$ 就是乘积测度 
  $\mathbb{P}_{X_1}\otimes\cdots\otimes \mathbb{P}_{X_n}$。

  记 $\pi_i:E_1\times \cdots\times E_n\to E_i$ 为投影，根据 Fubini 定理，有
  \begin{align*}
    \mathbb{E}\biggl[\prod_{i=1}^n f_i(X_i)\biggr]&=
    \int_{E_1\times\cdots \times E_n}\prod_{i=1}^n f_i\circ\pi_i
    \d\mathbb{P}_{(X_1,\dots,X_n)}\\
    &=\prod_{i=1}^n \int_{E_i} f_i(x_i) \mathbb{P}_{X_i}(\d x_i)\\
    &=\prod_{i=1}^n \mathbb{E}[f_i(X_i)].\qedhere
  \end{align*}
\end{proof}
\begin{remark}
  该定理中 $f_i$ 也可以是任意符号，此时如果 $\mathbb{E}[|f_i(X_i)|]<\infty$，
  也即 $f_i\in \mathcal{L}^1(E_i,\mathcal{E}_i,\mathbb{P}_{X_i})$，那么
  定理的结论依然成立。
\end{remark}

\begin{corollary}\label{coro:independence by pdf}
  令 $X_1,\dots,X_n$ 是实值随机变量。
  \begin{enumerate}
    \item 假设 $X_i$ 有密度 $p_i$ 并且 $X_1,\dots,X_n$ 是独立的，那么
    $(X_1,\dots,X_n)$ 有密度
    \[
      p(x_1,\dots,x_n)=\prod_{i=1}^n p_i(x_i).  
    \]
    \item 反之，假设 $(X_1,\dots,X_n)$ 有密度 $p$，并且
    $p$ 可以表达为
    \[
    p(x_1,\dots,x_n)=\prod_{i=1}^n q_i(x_i),  
    \]
    其中 $q_i$ 是 $\mathbb{R}$ 上的非负可测函数。那么 $X_1,\dots,X_n$
    是独立的并且 $X_i$ 有密度 $p_i=C_iq_i$，其中 $C_i>0$ 为常数。
  \end{enumerate}
\end{corollary}
\begin{proof}
  (1) $X_i$ 有密度 $p_i$ 表明 $\mathbb{P}_{X_i}(\d x)=p_i(x)\d x$，
  $X_1,\dots,X_n$ 独立表明
  \begin{align*}
    \mathbb{P}_{(X_1,\dots,X_n)}(A)&=
    \mathbb{P}_{X_1}\otimes\cdots\otimes \mathbb{P}_{X_n}(A)
    =\int_{\mathbb{R}^n} \indicator{A} \d \mathbb{P}_{X_1}\otimes\cdots\otimes \mathbb{P}_{X_n}
    \\
    &=\int_{\mathbb{R}}\cdots \int_{\mathbb{R}}\indicator{A}(x_1,\dots,x_n)
    \mathbb{P}_{X_1}(\d x_1)\cdots \mathbb{P}_{X_n}(\d x_n) \\
    &=\int_{\mathbb{R}}\cdots \int_{\mathbb{R}}\indicator{A}(x_1,\dots,x_n)
    \prod_{i=1}^n p_i(x_i)
    \d x_1\cdots \d x_n\\
    &=\int_{\mathbb{R}^n} \indicator{A}\prod_{i=1}^n p_i \d \lambda
    =\int_A \prod_{i=1}^np_i(x_i) \d x_1\cdots\d x_n,
  \end{align*}
  这就表明 
  \[
    p(x_1,\dots,x_n)=\prod_{i=1}^n p_i(x_i).  
  \]

  (2) 根据 \autoref{prop:margin pdf}，有
  \[
    p_i(x_i)=\int_{\mathbb{R}^{n-1}}p(x_1,\dots,x_n)\d x_1\cdots \d x_{i-1}
    \d x_{i+1}\cdots\d x_n
    =q_i(x_i)\prod_{j\neq i}\int_{\mathbb{R}}q_j(x_j)\d x_j,
  \]
  故 $p_i=C_iq_i$。此时
  \begin{align*}
    p(x_1,\dots,x_n)=\prod_{i=1}^n q_i(x_i)
    =\prod_{i=1}^n \frac{1}{C_i}p_i(x_i),
  \end{align*}
  两边积分可知 $\prod_{i=1}^n C_i=1$，所以
  \[
    p(x_1,\dots,x_n)=\prod_{i=1}^n p_i(x_i),  
  \]
  这就表明 $\mathbb{P}_{(X_1,\dots,X_n)}=\mathbb{P}_{X_1}\otimes\cdots \mathbb{P}_{X_n}$，
  即 $X_1,\dots,X_n$ 独立。
\end{proof} 

\begin{example}
  令 $U$ 是服从参数 $1$ 的指数分布的随机变量，$V$ 是服从 $[0,1]$ 上
  的均匀分布的随机变量，假设 $U,V$ 是独立的，记
  \[
    X=\sqrt{U}\cos(2\pi V),\quad Y=\sqrt{U}\sin(2\pi V),  
  \]
  证明 $X,Y$ 是独立的随机变量。
\end{example}
\begin{proof}
  任取非负可测函数 $\varphi:\mathbb{R}^2\to \mathbb{R}$，有
  \begin{align*}
    \mathbb{E}[\varphi(X,Y)]
    &=\mathbb{E}
    \bigl[\varphi\bigl(\sqrt{U}\cos(2\pi V),\sqrt{U}\sin(2\pi V)\bigr)\bigr]\\
    &=\int_{\mathbb{R}^2}\varphi\bigl(\sqrt{u}\cos(2\pi v),\sqrt{u}\sin(2\pi v)\bigr)
    \d \mathbb{P}_{(U,V)}\\
    &=\int_{\mathbb{R}}\int_{\mathbb{R}}\varphi\bigl(\sqrt{u}\cos(2\pi v),\sqrt{u}\sin(2\pi v)\bigr)
      e^{-u}\indicator{[0,\infty)}(u)\indicator{[0,1]}(v)\d u\d v\\
    &=\int_{0}^\infty\int_0^1\varphi\bigl(\sqrt{u}\cos(2\pi v),\sqrt{u}\sin(2\pi v)\bigr)
    e^{-u}\d u\d v \\
    &=\frac{1}{\pi}\int_0^\infty\int_0^{2\pi}
    \varphi(r\cos\theta,r\sin\theta)re^{-r^2}\d r\d\theta\\
    &=\frac{1}{\pi}\int_{\mathbb{R}^2}\varphi(x,y)e^{-x^2-y^2}\d x\d y.
  \end{align*}
  这表明 $(X,Y)$ 有概率密度 $p(x,y)=\pi^{-1}\exp(-x^2-y^2)=\pi^{-1}\exp(-x^2)\exp(-y^2)$，
  根据 \autoref{coro:independence by pdf}，这表明 $X,Y$
  是独立的。
\end{proof}

\section{Borel-Cantelli 引理}

回顾集合极限的定义：如果 $(A_n)_{n\in \mathbb{N}}$ 是一列集合，
我们记
\[
  \limsup A_n=\bigcap_{n=1}^\infty \bigcup_{k=n}^\infty A_k,  
\]
不难发现点 $\omega\in\limsup A_n$ 当且仅当存在无限多个
$n$ 使得 $\omega\in A_n$。注意到
\ref{lemma:liminf and limsup ineq} 告诉我们
$\mathbb{P}(\limsup A_n)\geq \limsup \mathbb{P}(A_n)$。

\begin{lemma}
  令 $(A_n)_{n\in \mathbb{N}}$ 是一列事件。
  \begin{enumerate}
    \item 如果 $\sum_{n\in \mathbb{N}}\mathbb{P}(A_n)<\infty$，那么
    \[
      \mathbb{P}(\limsup A_n)=0,  
    \]
    \item 如果 $\sum_{n\in \mathbb{N}}\mathbb{P}(A_n)=\infty$，
    事件 $A_n$ 是独立的，那么
    \[
      \mathbb{P}(\limsup A_n)=1.  
    \]
  \end{enumerate}
\end{lemma}

\paragraph{两个应用}
(2) 我们令
\[
  (\Omega,\mathcal{A},\mathbb{P})=\bigl([0,1),\mathcal{B}([0,1)),\lambda\bigr) ,
\]
其中 $\lambda$ 表示 Lebesgue 测度。对于每个 $n\in \mathbb{N}$，令
\[
  X_n(\omega)=\lfloor 2^n\omega\rfloor-2\lfloor 2^{n-1}\omega\rfloor,
\]
其中 $\lfloor x\rfloor$ 表示向下取整。那么 $X_n(\omega)\in\{0,1\}$
并且容易验证对于任意 $\omega\in [0,1)$ 有
\[
  0\leq\omega-\sum_{k=1}^nX_k(\omega)2^{-k}<2^{-n}.  
\]
这表明
\[
  \omega=\sum_{k=1}^\infty X_k(\omega)2^{-k}.  
\]

\section{独立随机变量的和}

\begin{proposition}[强大数定律]\label{prop:strong law}
  令 $(X_n)_{n\in \mathbb{N}}$ 是一列独立同分布的实值随机变量，
  若 $\mathbb{E}[X_1^4]<\infty$，那么我们几乎肯定有
  \[
    \frac{1}{n}(X_1+\cdots+X_n)\xrightarrow[n\to\infty]{} \mathbb{E}[X_1].
  \]
\end{proposition}


\section{Poisson 过程}\label{sec:poisson}

在本节，我们固定一个参数 $\lambda>0$，令 $U_1,U_2,\dots$ 是
一列独立同分布的随机变量，它们都服从参数 $\lambda$ 的指数分布，
即有概率密度 $\lambda e^{-\lambda x}\indicator{\mathbb{R}_+}$。
令
\[
  T_n=U_1+U_2+\cdots+U_n.  
\]
对于任意实数 $t\geq 0$，令
\[
  N_t=\sum_{n=1}^\infty \indicator{\{T_n\leq t\}}=\sup\{n\in \mathbb{N}\,|\,T_n\leq t\}  .
\]
约定 $\sup\emptyset =0 $。\autoref{prop:strong law}
告诉我们在 $n\to\infty$ 的时候，$T_n\to\infty \alsu{}$。
因此，使得 $(T_n)_{n\in \mathbb{N}}$ 有界的 $\omega\in\Omega$ 的集合构成一个零测集，
除开这个零测集，对于任意 $t\geq 0$，我们都有 $N_t<\infty$。类似地，因为
随机变量 $U_i$ 几乎处处是正值，我们可以假设对于每个 $\omega\in\Omega$ 都有
$0<T_1(\omega)<T_2(\omega)<\cdots$。

固定 $\omega$，函数 $t\mapsto N_t(\omega)$ 在 $0$ 处为零、单调递增且右连续，此外
其每次以大小为 $1$ 的幅度增加。这个函数我们称为计数函数。在 $t\to\infty$
的时候有 $N_t\to\infty$。

\begin{definition}
  随机变量族 $(N_t)_{t\geq 0}$ 被称为参数 $\lambda$ 的 Poisson 过程。
\end{definition}

泊松过程经常用于应用概率模型中，例如在排队论中，$N_t$ 表示在时间 $t$ 之前到达
服务器的客户数量。选择指数分布来模拟两个连续到达的客户之间的时间段与指数分布缺乏记忆的特性有关。
粗略地说，该属性表示，对于任何给定时间 $t \geq 0$，$t$ 与客户下一次到达之间的时间始终
具有相同的分布，与时间 $t$ 之前发生的情况无关。

\begin{proposition}
  对于每个 $n\geq 1$，$T_n$ 服从 Gamma 分布 $\Gamma(n,\lambda)$，
  密度为
  \[
    p(x)=\frac{\lambda^n}{(n-1)!}x^{n-1}e^{-\lambda x}\indicator{\mathbb{R}_+}(x).  
  \]
  对于每个 $t> 0$，$N_t$ 服从参数 $\lambda t$ 的 Poisson 分布：
  \[
    \mathbb{P}(N_t=k)=\frac{(\lambda t)^k}{k!}e^{-\lambda t},
    \quad \forall k\in \mathbb{N} . 
  \]
\end{proposition}
\begin{proof}
  注意到参数 $\lambda$ 的指数分布就是 Gamma 分布 $\Gamma(1,\lambda)$。
  我们首先证明若 $X$ 服从分布 $\Gamma(a,\lambda)$，$Y$
  服从分布 $\Gamma(b,\lambda)$，且 $X,Y$ 独立，那么 $X+Y$
  服从分布 $\Gamma(a+b,\lambda)$。
  那么
  \begin{align*}
    \mathbb{E}[\varphi(X+Y)]&=\int_{\mathbb{R}^2}
    \varphi(x+y)p_a(x)p_b(y)\d x\d y\\
    &=\int_{\mathbb{R}}\varphi(z)\left(\int_{\mathbb{R}}p_a(x)p_b(z-x)\d x\right)\d z\\
    &=\int_0^\infty\varphi(z)\left(\int_{0}^z
    \frac{\lambda^{a+b}}{\Gamma(a)\Gamma(b)}x^{a-1}
    (z-x)^{b-1}e^{-\lambda z}\d x\right) \d z\\
    &=\int_0^\infty \frac{\lambda^{a+b}e^{-\lambda z}z^{a+b-1}}{\Gamma(a)\Gamma(b)}
    \varphi(z)\left(\int_0^1 x^{a-1}(1-x)^{b-1}\d x\right)\d z\\
    &=\int_0^\infty \varphi(z)\frac{\lambda^{a+b}}{\Gamma(a+b)}
    z^{a+b-1}e^{-\lambda z}\d z,
  \end{align*}
  这就表明 $X+Y$ 服从分布 $\Gamma(a+b,\lambda)$。由于
  $T_n=U_1+\cdots+U_n$，所以 $T_n$ 服从分布 $\Gamma(n,\lambda)$。

  对于 $k\geq 1$，有
  \begin{align*}
    \mathbb{P}(N_t=k)&=\mathbb{P}(T_k\leq t< T_{k+1})\\
    &=\mathbb{P}(T_{k}\leq t)-\mathbb{P}(T_{k+1}\leq t)\\
    &=\int_0^t \frac{\lambda^k}{(n-1)!}x^{k-1}e^{-\lambda x}\d x
    -\int_0^t \frac{\lambda^{k+1}}{k!}x^{k}e^{-\lambda x}\d x\\
    &=\frac{(\lambda t)^k}{k!}e^{-\lambda t}.
  \end{align*}
  对于 $k=0$ 的时候，有
  $\mathbb{P}(N_t=0)=\mathbb{P}(T_1>t)=e^{-\lambda t}$。
  这就表明 $N_t$ 服从参数 $\lambda t$ 的 Poisson 分布。
\end{proof}

我们现在将陈述有关 Poisson 过程的第一个重要结果。我们需要引入
给定事件的条件概率的概念（更多关于条件的内容将在 \autoref{chap:condition} 中找到）。
如果 $B\in \mathcal{A}$ 使得 $\mathbb{P}(B)>0$，我们定义 $(\Omega,\mathcal{A})$
上的一个新的概率测度：已知 $B$ 的条件概率，记为 $\mathbb{P}(\cdot\,|\, B)$。
对于每个 $A\in \mathcal{A}$，其满足
\[
  \mathbb{P}(A|B)=\frac{\mathbb{P}(A\cap B)}{\mathbb{P}(B)}.  
\]
对于每个非负随机变量 $X$，$X$ 在 $\mathbb{P}(\cdot\,|\, B)$ 下的期望
记为 $\mathbb{E}[X|B]$，容易看出
\[
  \mathbb{P}(A|B)=  \frac{\mathbb{P}(A\cap B)}{\mathbb{P}(B)}
  =\int_{A}\frac{\indicator{B}}{\mathbb{P}(B)}\d \mathbb{P},
\]
所以 $\mathbb{P}(\cdot\,|\, B)$ 相对于 $\mathbb{P}$ 有密度 $\indicator{B}/\mathbb{P}(B)$，
故
\[
  \mathbb{E}[X|B]=\int_{\Omega} X(\omega) \mathbb{P}(\d\omega|B)
  = \int_\Omega X(\omega)\frac{\indicator{B}(\omega)}{\mathbb{P}(B)}
  \mathbb{P}(\d\omega)=\frac{\mathbb{E}[X\indicator{B}]}{\mathbb{P}(B)}. 
\]

\begin{proposition}
  令 $t>0$，$n\in \mathbb{N}$。在条件概率 $\mathbb{P}(\cdot\,|\, N_t=n)$
  下，随机变量 $(T_1,\dots,T_n)$ 有密度
  \[
    \frac{n!}{t^n}\indicator{\{0<s_1<s_2<\cdots<s_n<t\}}  .
  \]
  此外，在条件概率 $\mathbb{P}(\cdot\,|\, N_t=n)$ 下，随机变量
  $T_{n+1}-t$ 服从参数 $\lambda$ 的指数分布并且独立于 $(T_1,\dots,T_n)$。
\end{proposition}

现在我们陈述关于 Poisson 过程的一个非常重要的定理。

\begin{theorem}
  令 $t>0$，对于每个 $r\geq 0$，令
  \[
    N_r^{(t)}=N_{t+r}-N_t.  
  \]
  随机变量族 $(N_r^{(t)})_{r\geq 0}$ 仍然是参数 $\lambda$
  的 Poisson 过程，并且与 $(N_r)_{0\leq r\leq t}$ 独立。
\end{theorem}
\begin{remark}[直观解释]
  如果我们将 Poisson 过程的跳跃时间解释为客户到达服务器的时间，
  则该定理意味着如果有一个在时间 $t > 0$ 到达的观察者，其记录 $t$
  之后客户的到达时间，看到（在分布的意义下）的情况与他在时间 $0$ 到达
  的时候一样，并且了解时间 $0$ 和 $t$ 之间客户的到达时间不会给他提供
  有关时间 $t$ 之后客户到达情况的信息。这可以被视为所谓“Markov 性质”的
  一个方面。
\end{remark}

\begin{corollary}
  令 $t_0=0\leq t_1\leq\cdots\leq t_k$，随机变量 $N_{t_1},N_{t_2}-N_{t_1},
  \dots,N_{t_k}-N_{t_{k-1}}$ 是独立的，并且，对于每个 $1\leq j\leq k$，
  $N_{t_j}-N_{t_{j-1}}$ 服从参数 $\lambda(t_j-t_{j-1})$ 的 Poisson 分布。
\end{corollary}


\chapter{随机变量的收敛}


\chapter{条件}\label{chap:condition}

\section{离散条件}

本章中考虑概率空间 $(\Omega,\mathcal{A},\mathbb{P})$。我们已经在
\autoref{sec:poisson} 中提到了，如果 $B\in \mathcal{A}$ 是
一个概率为正的事件，我们可以定义 $(\Omega,\mathcal{A})$ 上的一个
新的概率测度：对于 $A\in \mathcal{A}$，定义
\[
  \mathbb{P}(A|B)=\frac{\mathbb{P}(A\cap B)}{\mathbb{P}(B)}.  
\]
概率测度 $A\mapsto \mathbb{P}(A|B)$ 被称为给定 $B$ 下的条件概率。
类似地，对于每个非负随机变量 $X$，或者 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，
定义给定 $B$ 下的 $X$ 的\emph{条件期望}为
\[
  \mathbb{E}[X|B]=\frac{\mathbb{E}[X\indicator{B}]}{\mathbb{P}(B)}.  
\]

现在我们定义已知一个离散随机变量下的条件期望。考虑一个离散随机变量
$Y$，取值在可数空间 $E$ 中（$\sigma$-域为幂集）。令
$E'=\{y\in E\,|\, \mathbb{P}(Y=y)>0\}$。如果 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，
那么对于每个 $y\in E'$，有
\[
  \mathbb{E}[X|Y=y]=\frac{\mathbb{E}[X\indicator{\{Y=y\}}]}{\mathbb{P}(Y=y)}.
\]

\begin{definition}
  令 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，定义已知 $Y$ 下
  的 $X$ 的条件期望为一个\emph{随机变量}
  \[
    \mathbb{E}[X|Y]=\varphi(Y),  
  \]
  其中 $\varphi:E\to \mathbb{R}$ 为
  \[
    \varphi(y)=\begin{cases}
      \mathbb{E}[X|Y=y] & y\in E',\\
      0 & y\in E\smallsetminus E'.
    \end{cases}
  \] 
\end{definition}
\begin{remark}
  定义中 $y\in E \smallsetminus E'$ 时 $\varphi(y)$ 的取值
  是无关紧要的，因为我们可以证明这样的情况仅仅构成一个零测集：
  \[
    \mathbb{P}(Y\in E \smallsetminus E')=
    \sum_{y\in E \smallsetminus E'}\mathbb{P}(Y=y)
    =0.
  \]
\end{remark}

与相对于一个事件的条件期望相比，需要注意 $\mathbb{E}[X|Y]$
是一个 $\Omega\to \mathbb{R}$ 的\emph{随机变量}，其几乎肯定满足
\[
  \mathbb{E}[X|Y](\omega)=\mathbb{E}[X|Y=Y(\omega)].  
\]

\begin{proposition}
  令 $X\in L^1(\Omega, \mathcal{A},\mathbb{P})$，我们有
  $\mathbb{E}\bigl[\bigl|\mathbb{E}[X|Y]\bigr|\bigr]\leq \mathbb{E}[|X|]$，
  这表明 $\mathbb{E}[X|Y]\in L^1(\Omega,\mathcal{A},\mathbb{P})$。
  此外，对于任意有界的 $\sigma(Y)$-可测的实值随机变量 $Z$，
  有
  \[
    \mathbb{E}[ZX]=\mathbb{E}\bigl[Z \mathbb{E}[X|Y]\bigr]  .
  \]
\end{proposition}

\section{条件期望的定义}

\subsection{可积随机变量}

下面的定理提供了关于一个子 $\sigma$-域的可积随机变量的条件期望
的定义。

\begin{theorem}\label{thm:conditioning variable}
  令 $\mathcal{B}$ 是 $\mathcal{A}$ 的一个子 $\sigma$-域，$X\in L^1(\Omega,\mathcal{A},\mathbb{P})$。
  那么 $L^1(\Omega,\mathcal{A},\mathbb{P})$ 中存在唯一的随机变量
  $\mathbb{E}[X| \mathcal{B}]$，使得
  \[
    \forall B\in \mathcal{B},\quad
    \mathbb{E}[X \indicator{B}]=\mathbb{E}\bigl[\mathbb{E}[X| \mathcal{B}]\indicator{B}\bigr]  .
  \]
  更一般地，对于每个有界的 $\mathcal{B}$-可测的实值随机变量 $Z$，
  有
  \[
    \mathbb{E}[XZ]=\mathbb{E}\bigl[\mathbb{E}[X| \mathcal{B}]Z\bigr]  .
  \]
  如果 $X\geq 0$，那么我们几乎肯定有 $\mathbb{E}[X| \mathcal{B}]\geq 0$。
\end{theorem}

特别地，如果 $\mathcal{B}=\sigma(Y)$ 是随机变量 $Y$ 生成的 $\sigma$-域，
我们在写法上不区分
\[
  \mathbb{E}[X| \mathcal{B}] = \mathbb{E}[X|\sigma(Y)]
  =\mathbb{E}[X|Y].
\]
这与前文离散情况下的定义是不冲突的。

\begin{proposition}[条件期望的性质]
  \mbox{}
  \begin{enumerate}
    \item 如果 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$
    并且 $X$ 是 $\mathcal{B}$-可测的，那么
    $\mathbb{E}[X|\mathcal{B}]=X$。
    \item $L^1(\Omega,\mathcal{A},\mathbb{P})$
    上的映射 $X\mapsto \mathbb{E}[X| \mathcal{B}]$
    是线性映射。
    \item 如果 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，
    那么 $\mathbb{E}\bigl[\mathbb{E}[X| \mathcal{B}]\bigr]=\mathbb{E}[X]$。
    \item 如果 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$，那么
    $|\mathbb{E}[X|\mathcal{B}]|\leq \mathbb{E}\bigl[|X|\bigm| \mathcal{B}\bigr]\alsu{}$，
    因此 $\mathbb{E}\bigl[\bigl|\mathbb{E}[X|\mathcal{B}]\bigr|\bigr]\leq \mathbb{E}[|X|]$。
    因此映射 $X\mapsto \mathbb{E}[X|\mathcal{B}]$ 是 $L^1(\Omega,\mathcal{A},\mathbb{P})$
    上的压缩映射。
    \item 如果 $X,X'\in L^1(\Omega,\mathcal{A},\mathbb{P})$ 并且
    $X\geq X'$，那么 $\mathbb{E}[X|\mathcal{B}]\geq \mathbb{E}[X'|\mathcal{B}]\alsu{}$。
  \end{enumerate}
\end{proposition}

\section{条件期望的具体性质}

\begin{proposition}[嵌套 $\sigma$-域]\label{prop:nested sigma field}
  令 $\mathcal{B}_1,\mathcal{B}_2$ 是 $\mathcal{A}$ 的两个子 $\sigma$-域且
  $\mathcal{B}_1\subseteq \mathcal{B}_2$。那么对于任意非负（可积）随机变量 $X$，我们有
  \[
    \mathbb{E}\bigl[\mathbb{E}[X|\mathcal{B}_2]\bigm| \mathcal{B}_1\bigr]=
    \mathbb{E}[X|\mathcal{B}_1].
  \]
\end{proposition}


\section{条件期望的计算}

\subsection{离散条件}

如果 $Y$ 是值在可数空间 $E$ 中的随机变量，令 $X\in L^1(\Omega,\mathcal{A},\mathbb{P})$。
那么我们有
\[
  \mathbb{E}[X|Y]=\varphi(Y),  
\]
其中 $y\in E$ 且 $\mathbb{P}(Y=y)>0$ 的时候有
\[
  \varphi(y)=\frac{\mathbb{E}[X\indicator{\{Y=y\}}]}{\mathbb{P}(Y=y)}.
\]

\subsection{带有密度的随机变量}

令 $X,Y$ 分别是值在 $\mathbb{R}^m$ 和 $\mathbb{R}^n$ 中的随机变量，
假设 $(X,Y)$ 有相对于 Lebesgue 测度的密度，记为 $p(x,y)$。
那么对于任意 Borel 可测函数 $f:\mathbb{R}^m\times \mathbb{R}^n\to \mathbb{R}_+$，有
\[
  \mathbb{E}[f(X,Y)]=\int_{\mathbb{R}^m\times \mathbb{R}^n}
  f(x,y)p(x,y)\d x\d y.  
\]
注意此时 $Y$ 有密度
\[
  q(y)=\int_{\mathbb{R}^m}p(x,y)\d x.
\]

令 $h:\mathbb{R}^m\to \mathbb{R}_+$ 是可测函数，我们计算
$\mathbb{E}[h(X)|Y]$。对于任意可测函数 $g:\mathbb{R}^n\to \mathbb{R}_+$，
我们有
\begin{align*}
  \mathbb{E}[h(X)g(Y)]&=\int_{\mathbb{R}^m\times \mathbb{R}^n}
  h(x)g(y)p(x,y)\d x\d y\\
  &=\int_{\mathbb{R}^n}\left(\int_{\mathbb{R}^m}h(x)p(x,y)\d x\right)g(y)\d y\\
  &=\int_{\mathbb{R}^n}\left(\int_{\mathbb{R}^m}h(x)p(x,y)\d x\right)
  g(y)\indicator{\{q(y)>0\}}\d y,
\end{align*}
最后一个等式是因为若 $y$ 使得 $q(y)=0$，那么对于 $x$ 而言几乎处处有 $p(x,y)=0$，
所以 $\int h(x)p(x,y)\d x=0$。于是 
\begin{align*}
  \mathbb{E}[h(X)g(Y)]&=\int_{\mathbb{R}^n}
  \frac{\int_{\mathbb{R}^m}h(x)p(x,y)\d x}{q(y)}
  g(y)q(y)\indicator{\{q(y)>0\}}\d y\\
  &=\int_{\mathbb{R}^n}\varphi(y)g(y)q(y)\indicator{\{q(y)>0\}}\d y\\
  &=\mathbb{E}[\varphi(Y)g(Y)],
\end{align*}
其中
\[
  \varphi(y)=\begin{dcases}
    \frac{1}{q(y)}\int_{\mathbb{R}^m}h(x)p(x,y)\d x & q(y)>0,\\
    h(0) & q(y)=0.
  \end{dcases}  
\]

由于 $g$ 的任意性，根据 \autoref{prop:sigmaX-measurable}，这就表明
对于每个有界的 $\sigma^{-1}(Y)$-可测的实值随机变量 $Z$ 有
\[
  \mathbb{E}[h(X)Z]=\mathbb{E}[\varphi(Y)Z],  
\]
即
\[
  \mathbb{E}[h(X)|Y]=\varphi(Y).  
\]
故我们得到了下面的命题。

\begin{proposition}
  对于每个 $y\in \mathbb{R}^n$，令 $\nu(y,\d x)$ 为
  $\mathbb{R}^m$ 上的概率测度，定义为
  \[
    \nu(y,\d x)=\begin{dcases}
      \frac{1}{q(y)}p(x,y)\d x & q(y)>0,\\
      \delta_0(\d x) & q(y)=0,
    \end{dcases}  
  \]
  那么对于任意可测函数 $h:\mathbb{R}^m\to \mathbb{R}_+$，我们有
  \[
    \mathbb{E}[h(X)|Y]=\int h(x)\nu(Y,\d x).  
  \]
\end{proposition}

对于使得 $q(y)>0$ 的 $y$，我们有
\[
  \mathbb{E}[h(X)|Y=y]=\int h(x)\nu(y,\d x)
  =\frac{1}{q(y)}\int h(x)p(x,y)\d x,  
\]
我们通常说
\[
  x\mapsto\frac{p(x,y)}{q(y)}  
\]
是已知 $Y=y$ 下 $X$ 的条件密度函数。

\section{转移概率和条件分布}

\begin{definition}
  令 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$ 是两个可测空间，
  $E$ 到 $F$ 的一个\emph{转移概率}指的是映射
  \[
    \nu:E\times \mathcal{F}\to [0,1],  
  \]
  其满足：
  \begin{enumerate}
    \item 对于每个 $x\in E$，$A\mapsto \nu(x,A)$ 是
    $(F,\mathcal{F})$ 上的概率测度。
    \item 对于每个 $A\in \mathcal{F}$，$x\mapsto \nu(x,A)$
    是 $\mathcal{E}$-可测的。
  \end{enumerate}
\end{definition}

从直观上，每固定一个“起点” $x\in E$，概率测度 $\nu(x,\cdot)$
给出了一种随机的选择一个“到达点” $y\in F$ 的方法，这个概念将在
Markov 链中发挥重要作用。

\begin{definition}
  令 $X$ 和 $Y$ 分别是值在 $(E,\mathcal{E})$ 和 $(F,\mathcal{F})$
  中的随机变量。如果 $E$ 到 $F$ 的转移概率 $\nu$ 使得：
  对于任意 $F$ 上的非负可测函数 $h$，有
  \[
    \mathbb{E}[h(Y)|X]=\int\nu(X,\d y) h(y),\quad 
    \alsu{},  
  \]
  那么我们说 $\nu$ 是已知 $X$ 下 $Y$ 的条件分布。
\end{definition}

根据定义，如果 $\nu$ 是已知 $X$ 下 $Y$ 的条件分布，那么对于每个
$A\in \mathcal{F}$，有
\[
  \mathbb{P}(Y\in A|X)=\mathbb{E}[\indicator{\{Y\in A\}}|X]
  =\nu(X,A),\quad \alsu{}
\]
也可以写为对于任意 $x\in E$，有
\[
  \mathbb{P}(Y\in A| X=x)=\nu(x,A).  
\]

\part{随机过程}

\chapter{Markov 链}

\section{定义和首要性质}

在本章中，$E$ 表示一个有限或者可数空间，配备 $\sigma$-域
$\mathcal{P}(E)$。$E$ 上的随机矩阵指的是一族实数 
$(Q(x,y))_{(x,y)\in E\times E}$，其满足：
\begin{enumerate}
  \item 对于任意 $x,y\in E$，$0\leq Q(x,y)\leq 1$；
  \item 对于每个 $x\in E$，$\sum_{y\in E}Q(x,y)=1$。
\end{enumerate}

这个概念等价于从 $E$ 到 $E$ 的转移概率。实际上，如果我们令
\[
  \nu(x,A)=\sum_{y\in A}Q(x,y),\quad x\in E,A\subseteq E,  
\]
那么 $\nu$ 就是一个从 $E$ 到 $E$ 的转移概率。反之，给定一个
转移概率 $\nu$，定义 $Q(x,y)=\nu(x,\{y\})$，这就给出了 
$E$ 上的一个随机矩阵。

对于每个 $n\geq 1$，我们定义 $Q_n=Q^n$ 为通常的矩阵乘法：
定义 $Q_1=Q$，然后递归定义
\[
  Q_{n+1}(x,y)=\sum_{z\in E}Q_n(x,z)Q(z,y).  
\]
不难验证 $Q_n$ 仍然是 $E$ 上的一个随机矩阵。我们同时定义
$Q_0(x,y)=\indicator{\{x=y\}}$（类似单位阵）。
那么对于任意 $m,n\geq 0$，我们有 $Q_{m+n}=Q_mQ_n$：
\[
  Q_{m+n}(x,y)=\sum_{z\in E}Q_m(x,z)Q_n(z,y).  
\]

对于每个函数 $f:E\to \mathbb{R}_+$，用 $Qf$ 表示 $E$
上的函数，满足
\[
  Qf(x)=\sum_{y\in E}Q(x,y)f(y),  
\]
取值在 $[0,\infty]$ 中。如果 $\nu$ 是 $E$ 上的测度，我们
同时定义
\[
  \nu Q(y)=\sum_{x\in E}\nu(x)Q(x,y),\quad y\in E.  
\]

\begin{definition}
  令 $Q$ 是 $E$ 上的随机矩阵，$(X_n)_{n\in \mathbb{Z}_+}$
  是定义在 $(\Omega,\mathcal{A},\mathbb{P})$ 上值在 $E$ 中的随机过程。
  如果对于每个 $n\geq 0$，已知 $(X_0,X_1,\dots,X_n)$ 下的
  $X_{n+1}$ 的条件分布是 $Q(X_n,\cdot)$，那么 
  我们说 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$
  是 Markov 链。这等价于说对于每个 $x_0,\dots,x_n,y\in E$
  使得 $\mathbb{P}(X_0=x_0,\dots,X_n=x_n)>0$，都有
  \[
    \mathbb{P}(X_{n+1}=y|X_0=x_0,\dots,X_n=x_n)=Q(x_n,y).  
  \]
\end{definition}

已知 $(X_0,X_1,\dots,X_n)$ 下的 $X_{n+1}$ 的条件分布是 $Q(X_n,\cdot)$ 还意味着
对于每个 $y\in E$，有
\[
  \mathbb{P}(X_{n+1}=y|X_0,\dots,X_n)=Q(X_n,y).
\]
注意这是随机变量的等式。

利用 \autoref{prop:nested sigma field}，对于 $\{0,1,\dots,n-1\}$ 的任意子集
$\{i_1,\dots,i_k\}$，我们有
\begin{align*}
  &\hphantom{={}}\mathbb{P}(X_{n+1}=y|X_{i_1},\dots,X_{i_k},X_n)\\
  &=\mathbb{E}\bigl[\mathbb{P}(X_{n+1}=y|X_{0},X_1,\dots,X_n)\bigm| X_{i_1},\dots,X_{i_k},X_n\bigr]\\
  &=\mathbb{E}[Q(X_{n},y)|X_{i_1},\dots,X_{i_k},X_n]\\
  &=Q(X_n,y)
\end{align*}
特别地，有
\[
  \mathbb{P}(X_{n+1}=y|X_n)=Q(X_n,y).
\]
这等价于，对于每个使得 $\mathbb{P}(X_n=x)>0$ 的 $x\in E$，有
\[
  \mathbb{P}(X_{n+1}=y|X_n=x)=Q(x,y).
\]
这个式子提供了一种直观理解，即如果 Markov 链在 $n$ 时间处于点 $x\in E$ 处，那么
可以根据概率测度 $Q(x,\cdot)$ 衡量其在 $n+1$ 时间到达点的位置。

\begin{remark}
  \mbox{}
  \begin{enumerate}
    \item 对于一般的随机过程 $(X_n)_{n\in \mathbb{Z}_+}$，已知 $(X_0,X_1,\dots,X_n)$
    下 $X_{n+1}$ 的条件分布可以写为 $\nu((X_0,X_1,\dots,X_n),\cdot)$ 的形式，其中
    $\nu$ 表示从 $E^{n+1}$ 到 $E$ 的转移概率，此时条件分布依赖于所有 $X_0,X_1,\dots,X_n$
    而不仅仅是 $X_n$。而 Markov 链的定义要求已知 $(X_0,X_1,\dots,X_n)$
    下 $X_{n+1}$ 的条件分布仅仅依赖于 $X_n$，这被称为\emph{Markov 属性}：
    为了预测 $X_{n+1}$，过去的所有 $(X_0,X_1,\dots,X_n)$ 的知识并不能提供比 $X_n$
    更多的信息。  
    \item 函数 $Q(x,\cdot)$ 给出了在不依赖 $n$ 的情况下，已知 $X_n=x$ 下 $X_{n+1}$
    的条件分布。这就是“转移机制”的\emph{时齐性}。人们还可以考虑非齐次 Markov 链，
    其中时间 $n$ 和 $n + 1$ 之间的转移机制取决于 $n$，但在本课程中我们仅考虑齐次 Markov 链。
  \end{enumerate}
\end{remark}

\begin{proposition}\label{prop:law of X0 to Xn}
  一个值在 $E$ 中的随机过程 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链当且仅当
  对于每个 $n\geq 0$ 和 $x_0,x_1,\dots,x_n\in E$，我们有
  \[
    \mathbb{P}(X_0=x_0,X_1=x_1,\dots,X_n=x_n)=\mathbb{P}(X_0=x_0)
    Q(x_0,x_1)\cdots Q(x_{n-1},x_n).
  \]
\end{proposition}
\begin{proof}
  若 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链，那么依据
  \begin{align*}
    &\mathbb{P}(X_0=x_0,X_1=x_1,\dots,X_n=x_n,X_{n+1}=x_{n+1})\\
    &=\mathbb{P}(X_0=x_0,\dots,X_n=x_n)\mathbb{P}(X_{n+1}=x_{n+1}|X_0=x_0,\dots,X_n=x_n)
  \end{align*}
  进行归纳即可。

  反之，假设上式成立，那么
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y|X_0=x_0,\dots,X_n=x_n)\\
    &=\frac{\mathbb{P}(X_0=x_0,\dots,X_n=x_n,X_{n+1}=y)}{\mathbb{P}(X_0=x_0,\dots,X_n=x_n)}
    =Q(x_n,y),
  \end{align*}
  即 $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链。
\end{proof}

\begin{remark}
  这表明对于 Markov 链 $(X_n)_{n\in \mathbb{Z}_+}$，$(X_0,X_1,\dots,X_n)$
  的分布完全由初始分布和转移矩阵 $Q$ 确定。
\end{remark}

\begin{proposition}
  $(X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 的 Markov 链。
  \begin{enumerate}
    \item 对于每个 $n\geq 0$ 和可测函数 $f:E\to \mathbb{R}_+$，
    \[
      \mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]=\mathbb{E}[f(X_{n+1})|X_n]=Qf(X_n).
    \]
    更一般地，对于 $\{0,1,\dots,n-1\}$ 的任意子集 $\{i_1,\dots,i_k\}$，我们有
    \[
      \mathbb{E}[f(X_{n+1})|X_{i_1},\dots,X_{i_k},X_n]=Qf(X_n).
    \]
    \item 对于每个 $n\geq 0$，$p\geq 1$ 以及 $y_1,\dots,y_p\in E$，有
    \begin{align*}
      &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0,\dots,X_n)\\
      &=Q(X_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p).
    \end{align*}
    因此，有
    \[
      \mathbb{P}(X_{n+p}=y_p|X_n)=\mathbb{P}(X_{n+p}=y_p|X_0,\dots,X_n)=
      Q_p(X_n,y_p).
    \]
    如果我们固定 $n\geq 0$，对于每个 $p\in \mathbb{Z}_+$，令 $Y_p=X_{n+p}$，
    那么随机过程 $(Y_p)_{p\in \mathbb{Z}_+}$ 仍然是带有转移矩阵 $Q$ 的 Markov 链。
  \end{enumerate}
\end{proposition}
\begin{proof}
  (1) 注意到 $f(X_{n+1})=\sum_{y\in E}f(y)\indicator{\{X_{n+1}=y\}}$，那么
  \begin{align*}
    \mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]
    &=\sum_{y\in E}f(y)\mathbb{P}(X_{n+1}=y|X_0,X_1,\dots,X_n)\\
    &=\sum_{y\in E}f(y)Q(X_n,y)\\
    &=Qf(X_n).
  \end{align*}
  对于 $\{0,1,\dots,n-1\}$ 的任意子集 $\{i_1,\dots,i_k\}$，我们有
  \begin{align*}
    &\mathbb{E}[f(X_{n+1})|X_{i_1},\dots,X_{i_k},X_n]\\
    &=\mathbb{E}\bigl[\mathbb{E}[f(X_{n+1})|X_0,X_1,\dots,X_n]\bigm| X_{i_1},\dots,X_{i_k},X_n\bigr]\\
    &=\mathbb{E}[Qf(X_n)|X_{i_1},\dots,X_{i_k},X_n]\\
    &=Qf(X_n).
  \end{align*}

  (2) 根据 \autoref{prop:law of X0 to Xn}，有
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0=x_0,\dots,X_n=x_n)\\
    &=\frac{\mathbb{P}(X_0=x_0)Q(x_0,x_1)\cdots Q(x_n,y_1)\cdots Q(y_{p-1},y_p)}{
      \mathbb{P}(X_0=x_0)Q(x_0,x_1)\cdots Q(x_{n-1},x_n)
    }\\
    &=Q(x_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p),
  \end{align*}
  即 
  \begin{align*}
    &\mathbb{P}(X_{n+1}=y_1,\dots,X_{n+p}=y_p|X_0,\dots,X_n)\\
    &=Q(X_n,y_1)Q(y_1,y_2)\cdots Q(y_{p-1},y_p).
  \end{align*}

  对于 $p=2$ 的情况，有
  \begin{align*}
    \mathbb{P}(X_{n+2}=y_2|X_0,\dots,X_n)
    &=\sum_{y_1\in E}\mathbb{P}(X_{n+1}=y_1,X_{n+2}=y_2|X_0,\dots,X_n)\\
    &=\sum_{y_1\in E} Q(X_n,y_1)Q(y_1,y_2)\\
    &=Q_2(X_n,y_2),
  \end{align*}
  一般的情况由此归纳即可。于是
  \begin{align*}
    \mathbb{P}(X_{n+p}=y_p|X_n)
    &=\mathbb{E}\bigl[\mathbb{P}(X_{n+p}=y_p|X_0,\dots,X_n)\bigm| X_n\bigr]\\
    &=\mathbb{E}[Q_p(X_n,y_p)|X_n]=Q_p(X_n,y_p).
  \end{align*}

  最后我们验证 $(Y_p)_{p\in \mathbb{Z}_+}$ 是带有转移矩阵 $Q$ 的 Markov 链。
  根据定义，有
  \begin{align*}
    &\mathbb{P}(Y_{p+1}=y_{p+1}|Y_0,\dots,Y_p)\\
    &=\mathbb{P}(X_{n+p+1}=y_{p+1}|X_n,\dots,X_{n+p})\\
    &=\mathbb{E}\bigl[\mathbb{P}(X_{n+p+1}=y_{p+1}|X_0,\dots,X_{n+p})\bigm| X_n,\dots,X_{n+p}\bigr]\\
    &=\mathbb{E}[Q(X_{n+p},y_{p+1})|X_n,\dots,X_{n+p}]\\
    &=Q(X_{n+p},y_{p+1})=Q(Y_p,y_{p+1}),
  \end{align*}
  这就表明 $(Y_p)_{p\in \mathbb{Z}_+}$ 是带有转移矩阵 $Q$ 的 Markov 链。
\end{proof}


\section{例子}

\subsection{$\mathbb{Z}^d$ 上的随机游走}


\section{典范的 Markov 链}

在本节中，我们解释如何对概率空间（和随机过程）进行典范的选择，以获得具有给定转移矩阵的 Markov 链。
这与前面的章节形成对比，前面的章节没有指定潜在的概率空间。在 Markov 链的背景下，这种典范的选择
将有几个优点。特别是，它将使我们能够同时考虑给定的 Markov 链和所有可能的初始点。

\begin{proposition}
  令 $Q$ 是 $E$ 上的随机矩阵，我们可以找到一个概率空间 $(\Omega,\mathcal{A},\mathbb{P})$ 使得对于
  每个 $x\in E$，都可以构建一个带有转移矩阵 $Q$ 的 Markov 链 $(X_n^x)_{n\in \mathbb{Z}_+}$ 且
  $X_0^x=x$。
\end{proposition}

下面我们解释这个概率空间的选择，我们令
\[
  \mat\Omega=E^{\mathbb{Z}_+},
\]
即 $\mat\Omega$ 的元素形如 $\omega=(\omega_0,\omega_1,\omega_2,\dots)$。定义坐标映射
$\mat X_n$ 为 $\mat X_n(\omega)=\omega_n$。我们给 $\mat\Omega$ 配备使得所有坐标映射
$\mat X_n$ 都可测的最小的 $\sigma$-域，记为 $\mathfrak{F}$。

\begin{lemma}
  令 $(G,\mathcal{G})$ 是可测空间，映射$\psi:G\to \mat\Omega$，那么
  $\psi$ 可测当且仅当 $\mat X_n\circ\psi$ 可测。
\end{lemma}

\begin{theorem}
  令 $Q$ 是 $E$ 上的随机矩阵，对于每个 $x\in E$，存在唯一的 $(\mat\Omega,\mathfrak F)$ 上
  的概率测度 $\matup P_x$ 使得坐标过程 $(\mat X_n)_{n\in \mathbb{Z}_+}$ 是带有
  转移矩阵 $Q$ 的 Markov 链并且 $\matup P_x(\mat X_0=x)=1$。
\end{theorem}
\begin{remark}
  我们将说在概率空间 $(\mat\Omega,\mathfrak F,\matup P_x)$ 上的坐标过程
  $(\mat X_n)_{n\in \mathbb{Z}_+}$ 是具有转移矩阵 $Q$ 和初值 $x$ 的\emph{典范 Markov 链}。
\end{remark}

\begin{remark}\label{rmk:canonical Markov}
  令 $(Y_n)_{n\in \mathbb{Z}_+}$ 是概率测度 $\mathbb{P}$ 下具有转移矩阵 $Q$ 的 Markov 链
  且 $Y_0=x$。那么对于 $\mat\Omega=E^{\mathbb{Z}_+}$ 的任意可测子集 $B$，有
  \[
    \mathbb{P}\bigl((Y_n)_{n\in \mathbb{Z}_+}\in B\bigr)=\matup P_x(B).
  \]
  事实上，当 $B$ 是圆柱集（cylinder set）时，这个等式成立，然后依据单调类给出一般情况。
  这个等式表明，我们后面为典范 Markov 链建立的所有结果都可以转移到具有相同转移矩阵的任何
  Markov 链上（无论它是在哪个概率空间上定义的）。
\end{remark}

\section{状态分类}

从现在开始，除非另有说明，否则我们将考虑上一节中针对 $E$ 上给定随机矩阵 $Q$ 引入的典范 Markov 链。
如 \autoref{rmk:canonical Markov} 所述，我们可以将得出的所有结果都转移到
在任何概率空间上定义的具有相同转移矩阵的 Markov 链。

回顾记号
\[
  H_x=\inf\{n\geq 1| \mat X_n=x\}, N_x=\sum_{n=0}^\infty \indicator{\{\mat X_n=x\}}.
\]
在 Markov 链中，$H_x$ 可以解释为状态第一次回到起点 $x$ 时需要的步数，
$N_x$ 可以解释为状态经过起点 $x$ 的次数。

\begin{proposition}
  令 $x\in E$，那么
  \begin{itemize}
    \item 要么 $\matup P_x(H_x<\infty)=1$，此时
    \[
      N_x=\infty,\ \alsu{\matup P_x}
    \]
    这种情况下 $x$ 被称为\emph{常返的}。
    \item 要么 $\matup P_x(H_x<\infty)<1$，此时
    \[
      N_x<\infty,\ \alsu{\matup P_x}
    \]
    更准确地，对于每个 $k\geq 1$ 有 $\matup P_x(N_x=k)=\matup P_x(H_x=\infty)\matup P_x(H_x<\infty)^{k-1}$，
    并且 $\matup E_x[N_x]=1/\matup P_x(H_x=\infty)<\infty$，在这种情况下 $x$
    被称为是\emph{暂留的}。
  \end{itemize}
\end{proposition}
\begin{remark}
  直观上来说，$\matup P_x(H_x<\infty)=1$ 的情况表明如果状态几乎肯定能够回到起点 $x$，那么
  其几乎肯定能够无数次经过起点 $x$。$\matup P_x(H_x<\infty)<1$ 的情况表明
  如果状态不一定能回到起点 $x$，那么其经过起点 $x$ 的次数几乎肯定是有限次，且期望也是有限次。
\end{remark}

\begin{definition}
  Markov 链的潜在核定义为 $E\times E$ 上的函数 
  \[
    U(x,y)=\matup E_x[N_y].
  \]
\end{definition}

注意到 $U(x,y)>0$ 当且仅当从 $x$ 出发的链能够到达 $y$ 的概率是正的。







\end{document}
